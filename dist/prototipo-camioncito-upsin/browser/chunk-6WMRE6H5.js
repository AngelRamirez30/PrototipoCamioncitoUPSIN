import{A as St,b as Vp,d as Mp,e as pi,j as oc,k as kp,l as Op,n as ac,p as ve,q as Lp,r as ct,s as Fp,t as Up,u as jp,v as qp,w as Bp,x as vo,y as _o,z as Rt}from"./chunk-MF5AIBGI.js";import{$ as qt,$a as ap,$b as ao,A as At,Aa as Yf,Ac as mo,Ba as _n,Bb as pp,C as Jn,Ca as ut,D as Ut,Da as io,Ea as Xu,F as Ku,Fa as Xf,G as Zn,Ga as ci,Gb as gp,H as jf,Ha as Ju,Hc as Dp,Ia as tr,Ib as mp,Ic as xp,J as vn,Ja as nr,Jb as yp,K as jt,Ka as Jf,Kc as sc,L as Qu,La as Zf,Lc as Np,M as qf,Ma as ep,Mc as yo,Na as tp,O as Bf,Oa as np,Pa as rp,Qa as ip,Ra as wn,S as zf,T as qe,Ta as sp,Ua as li,Ub as vp,V as $f,W as he,Wa as Ze,X as te,Xa as op,Y as er,Z as Wu,_ as ui,_b as oo,a as Vf,aa as eo,ab as Zu,ac as uo,b as Mf,ba as Gf,bc as _p,c as si,ca as ot,cb as so,cc as co,d as qu,da as to,db as de,dc as lo,e as Bu,eb as up,ec as tc,f as Ft,fb as cp,fc as wp,g as Ke,gc as nc,h as kf,hb as lp,hc as rc,i as Of,ia as Hu,ib as hp,ic as ho,j as yn,jb as ec,jc as fo,k as zu,ka as Kf,kb as hi,kc as Tp,l as $u,la as q,lc as ic,m as Pe,ma as at,mb as dp,mc as Ep,n as x,na as Qf,nc as Ip,o as oi,oa as Q,oc as po,p as Lf,pa as no,q as Ff,qa as Wf,qc as Ap,r as K,ra as Je,rc as go,s as Zs,sc as Rp,t as je,ta as Yu,tc as Sp,u as ai,ub as fp,uc as Fe,v as Uf,va as k,vc as bp,w as Gu,wa as P,wc as di,xa as Bt,xc as Cp,ya as Hf,yc as Pp,za as ro,zc as fi}from"./chunk-OGKX6EU7.js";import{a as D,b as Me,e as ju,f as m}from"./chunk-CQCHLVVT.js";var mi=class{},To=class{},Tn=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var cc=class{encodeKey(e){return zp(e)}encodeValue(e){return zp(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function fw(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[o,a]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],u=t.get(o)||[];u.push(a),t.set(o,u)}),t}var pw=/%(\d[a-f0-9])/gi,gw={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function zp(n){return encodeURIComponent(n).replace(pw,(e,t)=>gw[t]??e)}function wo(n){return`${n}`}var zt=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new cc,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=fw(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(wo):[wo(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(wo(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(wo(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var lc=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function mw(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function $p(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Gp(n){return typeof Blob<"u"&&n instanceof Blob}function Kp(n){return typeof FormData<"u"&&n instanceof FormData}function yw(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var gi=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(mw(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Tn,this.context??=new lc,!this.params)this.params=new zt,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),u=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+u+o}}}serializeBody(){return this.body===null?null:$p(this.body)||Gp(this.body)||Kp(this.body)||yw(this.body)||typeof this.body=="string"?this.body:this.body instanceof zt?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Kp(this.body)?null:Gp(this.body)?this.body.type||null:$p(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof zt?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.body!==void 0?e.body:this.body,o=e.withCredentials!==void 0?e.withCredentials:this.withCredentials,a=e.reportProgress!==void 0?e.reportProgress:this.reportProgress,u=e.headers||this.headers,c=e.params||this.params,l=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((h,d)=>h.set(d,e.setHeaders[d]),u)),e.setParams&&(c=Object.keys(e.setParams).reduce((h,d)=>h.set(d,e.setParams[d]),c)),new n(t,r,s,{params:c,headers:u,context:l,reportProgress:a,responseType:i,withCredentials:o})}},rr=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(rr||{}),yi=class{constructor(e,t=Ao.Ok,r="OK"){this.headers=e.headers||new Tn,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},hc=class n extends yi{constructor(e={}){super(e),this.type=rr.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Eo=class n extends yi{constructor(e={}){super(e),this.type=rr.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Io=class extends yi{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Ao=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(Ao||{});function uc(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var vw=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let o;if(r instanceof gi)o=r;else{let c;s.headers instanceof Tn?c=s.headers:c=new Tn(s.headers);let l;s.params&&(s.params instanceof zt?l=s.params:l=new zt({fromObject:s.params})),o=new gi(r,i,s.body!==void 0?s.body:null,{headers:c,context:s.context,params:l,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let a=x(o).pipe(Ut(c=>this.handler.handle(c)));if(r instanceof gi||s.observe==="events")return a;let u=a.pipe(At(c=>c instanceof Eo));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(K(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return c.body}));case"blob":return u.pipe(K(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new Error("Response is not a Blob.");return c.body}));case"text":return u.pipe(K(c=>{if(c.body!==null&&typeof c.body!="string")throw new Error("Response is not a string.");return c.body}));case"json":default:return u.pipe(K(c=>c.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new zt().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,uc(s,i))}post(r,i,s={}){return this.request("POST",r,uc(s,i))}put(r,i,s={}){return this.request("PUT",r,uc(s,i))}};e.\u0275fac=function(i){return new(i||e)(k(mi))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function Yp(n,e){return e(n)}function _w(n,e){return(t,r)=>e.intercept(t,{handle:i=>n(i,r)})}function ww(n,e,t){return(r,i)=>ut(t,()=>e(r,s=>n(s,i)))}var Tw=new Q(""),dc=new Q(""),Ew=new Q(""),Iw=new Q("");function Aw(){let n=null;return(e,t)=>{n===null&&(n=(P(Tw,{optional:!0})??[]).reduceRight(_w,Yp));let r=P(hi),i=r.add();return n(e,t).pipe(vn(()=>r.remove(i)))}}var Qp=(()=>{let e=class e extends mi{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=P(hi);let s=P(Iw,{optional:!0});this.backend=s??r}handle(r){if(this.chain===null){let s=Array.from(new Set([...this.injector.get(dc),...this.injector.get(Ew,[])]));this.chain=s.reduceRight((o,a)=>ww(o,a,this.injector),Yp)}let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(vn(()=>this.pendingTasks.remove(i)))}};e.\u0275fac=function(i){return new(i||e)(k(To),k(_n))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();var Rw=/^\)\]\}',?\n/;function Sw(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var Wp=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new te(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?Pe(i.\u0275loadImpl()):x(null)).pipe(qe(()=>new si(o=>{let a=i.build();if(a.open(r.method,r.urlWithParams),r.withCredentials&&(a.withCredentials=!0),r.headers.forEach((y,R)=>a.setRequestHeader(y,R.join(","))),r.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let y=r.detectContentTypeHeader();y!==null&&a.setRequestHeader("Content-Type",y)}if(r.responseType){let y=r.responseType.toLowerCase();a.responseType=y!=="json"?y:"text"}let u=r.serializeBody(),c=null,l=()=>{if(c!==null)return c;let y=a.statusText||"OK",R=new Tn(a.getAllResponseHeaders()),N=Sw(a)||r.url;return c=new hc({headers:R,status:a.status,statusText:y,url:N}),c},h=()=>{let{headers:y,status:R,statusText:N,url:M}=l(),F=null;R!==Ao.NoContent&&(F=typeof a.response>"u"?a.responseText:a.response),R===0&&(R=F?Ao.Ok:0);let X=R>=200&&R<300;if(r.responseType==="json"&&typeof F=="string"){let $=F;F=F.replace(Rw,"");try{F=F!==""?JSON.parse(F):null}catch(le){F=$,X&&(X=!1,F={error:le,text:F})}}X?(o.next(new Eo({body:F,headers:y,status:R,statusText:N,url:M||void 0})),o.complete()):o.error(new Io({error:F,headers:y,status:R,statusText:N,url:M||void 0}))},d=y=>{let{url:R}=l(),N=new Io({error:y,status:a.status||0,statusText:a.statusText||"Unknown Error",url:R||void 0});o.error(N)},f=!1,T=y=>{f||(o.next(l()),f=!0);let R={type:rr.DownloadProgress,loaded:y.loaded};y.lengthComputable&&(R.total=y.total),r.responseType==="text"&&a.responseText&&(R.partialText=a.responseText),o.next(R)},w=y=>{let R={type:rr.UploadProgress,loaded:y.loaded};y.lengthComputable&&(R.total=y.total),o.next(R)};return a.addEventListener("load",h),a.addEventListener("error",d),a.addEventListener("timeout",d),a.addEventListener("abort",d),r.reportProgress&&(a.addEventListener("progress",T),u!==null&&a.upload&&a.upload.addEventListener("progress",w)),a.send(u),o.next({type:rr.Sent}),()=>{a.removeEventListener("error",d),a.removeEventListener("abort",d),a.removeEventListener("load",h),a.removeEventListener("timeout",d),r.reportProgress&&(a.removeEventListener("progress",T),u!==null&&a.upload&&a.upload.removeEventListener("progress",w)),a.readyState!==a.DONE&&a.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(k(yo))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),Xp=new Q(""),bw="XSRF-TOKEN",Cw=new Q("",{providedIn:"root",factory:()=>bw}),Pw="X-XSRF-TOKEN",Dw=new Q("",{providedIn:"root",factory:()=>Pw}),Ro=class{},xw=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=mo(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(k(Fe),k(Je),k(Cw))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function Nw(n,e){let t=n.url.toLowerCase();if(!P(Xp)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=P(Ro).getToken(),i=P(Dw);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}var Jp=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(Jp||{});function Vw(n,e){return{\u0275kind:n,\u0275providers:e}}function Mw(...n){let e=[vw,Wp,Qp,{provide:mi,useExisting:Qp},{provide:To,useExisting:Wp},{provide:dc,useValue:Nw,multi:!0},{provide:Xp,useValue:!0},{provide:Ro,useClass:xw}];for(let t of n)e.push(...t.\u0275providers);return ro(e)}var Hp=new Q("");function kw(){return Vw(Jp.LegacyInterceptors,[{provide:Hp,useFactory:Aw},{provide:dc,useExisting:Hp,multi:!0}])}var MR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ot({type:e}),e.\u0275inj=at({providers:[Mw(kw())]});let n=e;return n})();var gc=class extends Sp{constructor(){super(...arguments),this.supportsDOMEvents=!0}},mc=class n extends gc{static makeCurrent(){Rp(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=Lw();return t==null?null:Fw(t)}resetBaseElement(){_i=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return mo(document.cookie,e)}},_i=null;function Lw(){return _i=_i||document.querySelector("base"),_i?_i.getAttribute("href"):null}function Fw(n){return new URL(n,document.baseURI).pathname}var yc=class{addToWindow(e){qt.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new te(5103,!1);return s},qt.getAllAngularTestabilities=()=>e.getAllTestabilities(),qt.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=qt.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};qt.frameworkStabilizers||(qt.frameworkStabilizers=[]),qt.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?go().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},Uw=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),vc=new Q(""),ng=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new te(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(k(vc),k(de))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),So=class{constructor(e){this._doc=e}},fc="ng-app-id",rg=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=sc(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${fc}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(fc),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(fc,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(k(Fe),k(no),k(Yu,8),k(Je))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),pc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},wc=/%COMP%/g,ig="%COMP%",jw=`_nghost-${ig}`,qw=`_ngcontent-${ig}`,Bw=!0,zw=new Q("",{providedIn:"root",factory:()=>Bw});function $w(n){return qw.replace(wc,n)}function Gw(n){return jw.replace(wc,n)}function sg(n,e){return e.map(t=>t.replace(wc,n))}var Zp=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=sc(u),this.defaultRenderer=new wi(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===ui.ShadowDom&&(i=Me(D({},i),{encapsulation:ui.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof bo?s.applyToHost(r):s instanceof Ti&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case ui.Emulated:o=new bo(c,l,i,this.appId,h,a,u,d);break;case ui.ShadowDom:return new _c(c,l,r,i,a,u,this.nonce,d);default:o=new Ti(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(k(ng),k(rg),k(no),k(zw),k(Fe),k(Je),k(de),k(Yu))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),wi=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(pc[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(eg(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(eg(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new te(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=pc[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=pc[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(li.DashCase|li.Important)?e.style.setProperty(t,r,i&li.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&li.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=go().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function eg(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var _c=class extends wi{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=sg(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Ti=class extends wi{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?sg(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},bo=class extends Ti{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=$w(c),this.hostAttr=Gw(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},Kw=(()=>{let e=class e extends So{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(k(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),tg=["alt","control","meta","shift"],Qw={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ww={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Hw=(()=>{let e=class e extends So{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>go().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),tg.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=Qw[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),tg.forEach(a=>{if(a!==s){let u=Ww[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(k(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function Yw(){mc.makeCurrent()}function Xw(){return new Ju}function Jw(){return Kf(document),document}var Zw=[{provide:Je,useValue:xp},{provide:Wf,useValue:Yw,multi:!0},{provide:Fe,useFactory:Jw,deps:[]}],QR=Tp(Ep,"browser",Zw),eT=new Q(""),tT=[{provide:co,useClass:yc,deps:[]},{provide:_p,useClass:lo,deps:[de,tc,co]},{provide:lo,useClass:lo,deps:[de,tc,co]}],nT=[{provide:Yf,useValue:"root"},{provide:Ju,useFactory:Xw,deps:[]},{provide:vc,useClass:Kw,multi:!0,deps:[Fe,de,Je]},{provide:vc,useClass:Hw,multi:!0,deps:[Fe]},Zp,rg,ng,{provide:ap,useExisting:Zp},{provide:yo,useClass:Uw,deps:[]},[]],WR=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:no,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(k(eT,12))},e.\u0275mod=ot({type:e}),e.\u0275inj=at({providers:[...nT,...tT],imports:[Dp,Ip]});let n=e;return n})();var og=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(k(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var rT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:function(i){let s=null;return i?s=new(i||e):s=k(iT),s},providedIn:"root"});let n=e;return n})(),iT=(()=>{let e=class e extends rT{constructor(r){super(),this._doc=r}sanitize(r,i){if(i==null)return null;switch(r){case wn.NONE:return i;case wn.HTML:return nr(i,"HTML")?tr(i):ip(this._doc,String(i)).toString();case wn.STYLE:return nr(i,"Style")?tr(i):i;case wn.SCRIPT:if(nr(i,"Script"))return tr(i);throw new te(5200,!1);case wn.URL:return nr(i,"URL")?tr(i):rp(String(i));case wn.RESOURCE_URL:if(nr(i,"ResourceURL"))return tr(i);throw new te(5201,!1);default:throw new te(5202,!1)}}bypassSecurityTrustHtml(r){return Jf(r)}bypassSecurityTrustStyle(r){return Zf(r)}bypassSecurityTrustScript(r){return ep(r)}bypassSecurityTrustUrl(r){return tp(r)}bypassSecurityTrustResourceUrl(r){return np(r)}};e.\u0275fac=function(i){return new(i||e)(k(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var U="primary",Oi=Symbol("RouteTitle"),Rc=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function ur(n){return new Rc(n)}function oT(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function aT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!lt(n[t],e[t]))return!1;return!0}function lt(n,e){let t=n?Sc(n):void 0,r=e?Sc(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!mg(n[i],e[i]))return!1;return!0}function Sc(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function mg(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function yg(n){return n.length>0?n[n.length-1]:null}function Qt(n){return Lf(n)?n:wp(n)?Pe(Promise.resolve(n)):x(n)}var uT={exact:_g,subset:wg},vg={exact:cT,subset:lT,ignored:()=>!0};function ag(n,e,t){return uT[t.paths](n.root,e.root,t.matrixParams)&&vg[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function cT(n,e){return lt(n,e)}function _g(n,e,t){if(!In(n.segments,e.segments)||!Do(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!_g(n.children[r],e.children[r],t))return!1;return!0}function lT(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>mg(n[t],e[t]))}function wg(n,e,t){return Tg(n,e,e.segments,t)}function Tg(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!In(i,t)||e.hasChildren()||!Do(i,t,r))}else if(n.segments.length===t.length){if(!In(n.segments,t)||!Do(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!wg(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!In(n.segments,i)||!Do(n.segments,i,r)||!n.children[U]?!1:Tg(n.children[U],e,s,r)}}function Do(n,e,t){return e.every((r,i)=>vg[t](n[i].parameters,r.parameters))}var $t=class{constructor(e=new W([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=ur(this.queryParams),this._queryParamMap}toString(){return fT.serialize(this)}},W=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return xo(this)}},En=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=ur(this.parameters),this._parameterMap}toString(){return Ig(this)}};function hT(n,e){return In(n,e)&&n.every((t,r)=>lt(t.parameters,e[r].parameters))}function In(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function dT(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===U&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==U&&(t=t.concat(e(i,r)))}),t}var Li=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>new Ci,providedIn:"root"});let n=e;return n})(),Ci=class{parse(e){let t=new Cc(e);return new $t(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Ei(e.root,!0)}`,r=mT(e.queryParams),i=typeof e.fragment=="string"?`#${pT(e.fragment)}`:"";return`${t}${r}${i}`}},fT=new Ci;function xo(n){return n.segments.map(e=>Ig(e)).join("/")}function Ei(n,e){if(!n.hasChildren())return xo(n);if(e){let t=n.children[U]?Ei(n.children[U],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==U&&r.push(`${i}:${Ei(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=dT(n,(r,i)=>i===U?[Ei(n.children[U],!1)]:[`${i}:${Ei(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[U]!=null?`${xo(n)}/${t[0]}`:`${xo(n)}/(${t.join("//")})`}}function Eg(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Co(n){return Eg(n).replace(/%3B/gi,";")}function pT(n){return encodeURI(n)}function bc(n){return Eg(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function No(n){return decodeURIComponent(n)}function ug(n){return No(n.replace(/\+/g,"%20"))}function Ig(n){return`${bc(n.path)}${gT(n.parameters)}`}function gT(n){return Object.entries(n).map(([e,t])=>`;${bc(e)}=${bc(t)}`).join("")}function mT(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Co(t)}=${Co(i)}`).join("&"):`${Co(t)}=${Co(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var yT=/^[^\/()?;#]+/;function Tc(n){let e=n.match(yT);return e?e[0]:""}var vT=/^[^\/()?;=#]+/;function _T(n){let e=n.match(vT);return e?e[0]:""}var wT=/^[^=?&#]+/;function TT(n){let e=n.match(wT);return e?e[0]:""}var ET=/^[^&#]+/;function IT(n){let e=n.match(ET);return e?e[0]:""}var Cc=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new W([],{}):new W([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[U]=new W(e,t)),r}parseSegment(){let e=Tc(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new te(4009,!1);return this.capture(e),new En(No(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=_T(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=Tc(this.remaining);i&&(r=i,this.capture(r))}e[No(t)]=No(r)}parseQueryParam(e){let t=TT(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=IT(this.remaining);o&&(r=o,this.capture(r))}let i=ug(t),s=ug(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Tc(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new te(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=U);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[U]:new W([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new te(4011,!1)}};function Ag(n){return n.segments.length>0?new W([],{[U]:n}):n}function Rg(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=Rg(i);if(r===U&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new W(n.segments,e);return AT(t)}function AT(n){if(n.numberOfChildren===1&&n.children[U]){let e=n.children[U];return new W(n.segments.concat(e.segments),e.children)}return n}function cr(n){return n instanceof $t}function RT(n,e,t=null,r=null){let i=Sg(n);return bg(i,e,t,r)}function Sg(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new W(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=Ag(r);return e??i}function bg(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Ec(i,i,i,t,r);let s=ST(e);if(s.toRoot())return Ec(i,i,new W([],{}),t,r);let o=bT(s,i,n),a=o.processChildren?Ri(o.segmentGroup,o.index,s.commands):Pg(o.segmentGroup,o.index,s.commands);return Ec(i,o.segmentGroup,a,t,r)}function Vo(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Pi(n){return typeof n=="object"&&n!=null&&n.outlets}function Ec(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=Cg(n,e,t);let a=Ag(Rg(o));return new $t(a,s,i)}function Cg(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Cg(s,e,t)}),new W(n.segments,r)}var Mo=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Vo(r[0]))throw new te(4003,!1);let i=r.find(Pi);if(i&&i!==yg(r))throw new te(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ST(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Mo(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Mo(t,e,r)}var or=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function bT(n,e,t){if(n.isAbsolute)return new or(e,!0,0);if(!t)return new or(e,!1,NaN);if(t.parent===null)return new or(t,!0,0);let r=Vo(n.commands[0])?0:1,i=t.segments.length-1+r;return CT(t,i,n.numberOfDoubleDots)}function CT(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new te(4005,!1);i=r.segments.length}return new or(r,!1,i-s)}function PT(n){return Pi(n[0])?n[0].outlets:{[U]:n}}function Pg(n,e,t){if(n??=new W([],{}),n.segments.length===0&&n.hasChildren())return Ri(n,e,t);let r=DT(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new W(n.segments.slice(0,r.pathIndex),{});return s.children[U]=new W(n.segments.slice(r.pathIndex),n.children),Ri(s,0,i)}else return r.match&&i.length===0?new W(n.segments,{}):r.match&&!n.hasChildren()?Pc(n,e,t):r.match?Ri(n,0,i):Pc(n,e,t)}function Ri(n,e,t){if(t.length===0)return new W(n.segments,{});{let r=PT(t),i={};if(Object.keys(r).some(s=>s!==U)&&n.children[U]&&n.numberOfChildren===1&&n.children[U].segments.length===0){let s=Ri(n.children[U],e,t);return new W(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Pg(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new W(n.segments,i)}}function DT(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Pi(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!lg(u,c,o))return s;r+=2}else{if(!lg(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Pc(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Pi(s)){let u=xT(s.outlets);return new W(r,u)}if(i===0&&Vo(t[0])){let u=n.segments[e];r.push(new En(u.path,cg(t[0]))),i++;continue}let o=Pi(s)?s.outlets[U]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Vo(a)?(r.push(new En(o,cg(a))),i+=2):(r.push(new En(o,{})),i++)}return new W(r,{})}function xT(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Pc(new W([],{}),0,r))}),e}function cg(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function lg(n,e,t){return n==t.path&&lt(e,t.parameters)}var Si="imperative",we=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(we||{}),We=class{constructor(e,t){this.id=e,this.url=t}},lr=class extends We{constructor(e,t,r="imperative",i=null){super(e,t),this.type=we.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},et=class extends We{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=we.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Qe=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Qe||{}),ko=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(ko||{}),Gt=class extends We{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=we.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Kt=class extends We{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=we.NavigationSkipped}},Di=class extends We{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=we.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Oo=class extends We{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Dc=class extends We{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xc=class extends We{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=we.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Nc=class extends We{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Vc=class extends We{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Mc=class{constructor(e){this.route=e,this.type=we.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},kc=class{constructor(e){this.route=e,this.type=we.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Oc=class{constructor(e){this.snapshot=e,this.type=we.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Lc=class{constructor(e){this.snapshot=e,this.type=we.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Fc=class{constructor(e){this.snapshot=e,this.type=we.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Uc=class{constructor(e){this.snapshot=e,this.type=we.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Lo=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=we.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},xi=class{},Ni=class{constructor(e){this.url=e}};var jc=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Fi,this.attachRef=null}},Fi=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new jc,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Fo=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=qc(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=qc(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Bc(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Bc(e,this._root).map(t=>t.value)}};function qc(n,e){if(n===e.value)return e;for(let t of e.children){let r=qc(n,t);if(r)return r}return null}function Bc(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Bc(n,t);if(r.length)return r.unshift(e),r}return[]}var Be=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function sr(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Uo=class extends Fo{constructor(e,t){super(e),this.snapshot=t,Jc(this,e)}toString(){return this.snapshot.toString()}};function Dg(n){let e=NT(n),t=new Ke([new En("",{})]),r=new Ke({}),i=new Ke({}),s=new Ke({}),o=new Ke(""),a=new An(t,r,s,o,i,U,n,e.root);return a.snapshot=e.root,new Uo(new Be(a,[]),e)}function NT(n){let e={},t={},r={},i="",s=new Vi([],e,r,i,t,U,n,null,{});return new jo("",new Be(s,[]))}var An=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(K(c=>c[Oi]))??x(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(K(e=>ur(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(K(e=>ur(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Xc(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:D(D({},e.params),n.params),data:D(D({},e.data),n.data),resolve:D(D(D(D({},n.data),e.data),i?.data),n._resolvedData)}:r={params:D({},n.params),data:D({},n.data),resolve:D(D({},n.data),n._resolvedData??{})},i&&Ng(i)&&(r.resolve[Oi]=i.title),r}var Vi=class{get title(){return this.data?.[Oi]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=ur(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=ur(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},jo=class extends Fo{constructor(e,t){super(t),this.url=e,Jc(this,t)}toString(){return xg(this._root)}};function Jc(n,e){e.value._routerState=n,e.children.forEach(t=>Jc(n,t))}function xg(n){let e=n.children.length>0?` { ${n.children.map(xg).join(", ")} } `:"";return`${n.value}${e}`}function Ic(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,lt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),lt(e.params,t.params)||n.paramsSubject.next(t.params),aT(e.url,t.url)||n.urlSubject.next(t.url),lt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function zc(n,e){let t=lt(n.params,e.params)&&hT(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||zc(n.parent,e.parent))}function Ng(n){return typeof n.title=="string"||n.title===null}var VT=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=U,this.activateEvents=new er,this.deactivateEvents=new er,this.attachEvents=new er,this.detachEvents=new er,this.parentContexts=P(Fi),this.location=P(cp),this.changeDetector=P(so),this.environmentInjector=P(_n),this.inputBinder=P(Go,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new te(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new te(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new te(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new te(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new $c(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=to({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[io]});let n=e;return n})(),$c=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===An?this.route:e===Fi?this.childContexts:this.parent.get(e,t)}},Go=new Q(""),hg=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=Zs([i.queryParams,i.params,i.data]).pipe(qe(([o,a,u],c)=>(u=D(D(D({},o),a),u),c===0?x(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=Ap(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function MT(n,e,t){let r=Mi(n,e._root,t?t._root:void 0);return new Uo(r,e)}function Mi(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=kT(n,e,t);return new Be(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Mi(n,a)),o}}let r=OT(e.value),i=e.children.map(s=>Mi(n,s));return new Be(r,i)}}function kT(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Mi(n,r,i);return Mi(n,r)})}function OT(n){return new An(new Ke(n.url),new Ke(n.params),new Ke(n.queryParams),new Ke(n.fragment),new Ke(n.data),n.outlet,n.component,n)}var Vg="ngNavigationCancelingError";function Mg(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=cr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=kg(!1,Qe.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function kg(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[Vg]=!0,t.cancellationCode=e,t}function LT(n){return Og(n)&&cr(n.url)}function Og(n){return!!n&&n[Vg]}var FT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Gf({type:e,selectors:[["ng-component"]],standalone:!0,features:[vp],decls:1,vars:0,template:function(i,s){i&1&&fp(0,"router-outlet")},dependencies:[VT],encapsulation:2});let n=e;return n})();function UT(n,e){return n.providers&&!n._injector&&(n._injector=ec(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Zc(n){let e=n.children&&n.children.map(Zc),t=e?Me(D({},n),{children:e}):D({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==U&&(t.component=FT),t}function ht(n){return n.outlet||U}function jT(n,e){let t=n.filter(r=>ht(r)===e);return t.push(...n.filter(r=>ht(r)!==e)),t}function Ui(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var qT=(n,e,t,r)=>K(i=>(new Gc(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Gc=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Ic(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=sr(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=sr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=sr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=sr(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Uc(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Lc(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Ic(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Ic(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Ui(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},qo=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ar=class{constructor(e,t){this.component=e,this.route=t}};function BT(n,e,t){let r=n._root,i=e?e._root:null;return Ii(r,i,t,[r.value])}function zT(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function dr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!Qf(n)?n:e.get(n):r}function Ii(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=sr(e);return n.children.forEach(o=>{$T(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>bi(a,t.getContext(o),i)),i}function $T(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=GT(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new qo(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ii(n,e,a?a.children:null,r,i):Ii(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new ar(a.outlet.component,o))}else o&&bi(e,a,i),i.canActivateChecks.push(new qo(r)),s.component?Ii(n,null,a?a.children:null,r,i):Ii(n,null,t,r,i);return i}function GT(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!In(n.url,e.url);case"pathParamsOrQueryParamsChange":return!In(n.url,e.url)||!lt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!zc(n,e)||!lt(n.queryParams,e.queryParams);case"paramsChange":default:return!zc(n,e)}}function bi(n,e,t){let r=sr(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?bi(o,e.children.getContext(s),t):bi(o,null,t):bi(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new ar(e.outlet.component,i)):t.canDeactivateChecks.push(new ar(null,i)):t.canDeactivateChecks.push(new ar(null,i))}function ji(n){return typeof n=="function"}function KT(n){return typeof n=="boolean"}function QT(n){return n&&ji(n.canLoad)}function WT(n){return n&&ji(n.canActivate)}function HT(n){return n&&ji(n.canActivateChild)}function YT(n){return n&&ji(n.canDeactivate)}function XT(n){return n&&ji(n.canMatch)}function Lg(n){return n instanceof Ff||n?.name==="EmptyError"}var Po=Symbol("INITIAL_VALUE");function hr(){return qe(n=>Zs(n.map(e=>e.pipe(Zn(1),zf(Po)))).pipe(K(e=>{for(let t of e)if(t!==!0){if(t===Po)return Po;if(t===!1||t instanceof $t)return t}return!0}),At(e=>e!==Po),Zn(1)))}function JT(n,e){return je(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?x(Me(D({},t),{guardsResult:!0})):ZT(o,r,i,n).pipe(je(a=>a&&KT(a)?eE(r,s,n,e):x(a)),K(a=>Me(D({},t),{guardsResult:a})))})}function ZT(n,e,t,r){return Pe(n).pipe(je(i=>sE(i.component,i.route,t,e,r)),jt(i=>i!==!0,!0))}function eE(n,e,t,r){return Pe(e).pipe(Ut(i=>Uf(nE(i.route.parent,r),tE(i.route,r),iE(n,i.path,t),rE(n,i.route,t))),jt(i=>i!==!0,!0))}function tE(n,e){return n!==null&&e&&e(new Fc(n)),x(!0)}function nE(n,e){return n!==null&&e&&e(new Oc(n)),x(!0)}function rE(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return x(!0);let i=r.map(s=>Gu(()=>{let o=Ui(e)??t,a=dr(s,o),u=WT(a)?a.canActivate(e,n):ut(o,()=>a(e,n));return Qt(u).pipe(jt())}));return x(i).pipe(hr())}function iE(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>zT(o)).filter(o=>o!==null).map(o=>Gu(()=>{let a=o.guards.map(u=>{let c=Ui(o.node)??t,l=dr(u,c),h=HT(l)?l.canActivateChild(r,n):ut(c,()=>l(r,n));return Qt(h).pipe(jt())});return x(a).pipe(hr())}));return x(s).pipe(hr())}function sE(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return x(!0);let o=s.map(a=>{let u=Ui(e)??i,c=dr(a,u),l=YT(c)?c.canDeactivate(n,e,t,r):ut(u,()=>c(n,e,t,r));return Qt(l).pipe(jt())});return x(o).pipe(hr())}function oE(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return x(!0);let s=i.map(o=>{let a=dr(o,n),u=QT(a)?a.canLoad(e,t):ut(n,()=>a(e,t));return Qt(u)});return x(s).pipe(hr(),Fg(r))}function Fg(n){return Mf(he(e=>{if(cr(e))throw Mg(n,e)}),K(e=>e===!0))}function aE(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return x(!0);let s=i.map(o=>{let a=dr(o,n),u=XT(a)?a.canMatch(e,t):ut(n,()=>a(e,t));return Qt(u)});return x(s).pipe(hr(),Fg(r))}var ki=class{constructor(e){this.segmentGroup=e||null}},Bo=class extends Error{constructor(e){super(),this.urlTree=e}};function ir(n){return oi(new ki(n))}function uE(n){return oi(new te(4e3,!1))}function cE(n){return oi(kg(!1,Qe.GuardRejected))}var Kc=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return x(r);if(i.numberOfChildren>1||!i.children[U])return uE(e.redirectTo);i=i.children[U]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Bo(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new $t(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new W(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new te(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Qc={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function lE(n,e,t,r,i){let s=el(n,e,t);return s.matched?(r=UT(e,r),aE(r,e,t,i).pipe(K(o=>o===!0?s:D({},Qc)))):x(s)}function el(n,e,t){if(e.path==="**")return hE(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?D({},Qc):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||oT)(t,n,e);if(!i)return D({},Qc);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?D(D({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function hE(n){return{matched:!0,parameters:n.length>0?yg(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function dg(n,e,t,r){return t.length>0&&pE(n,t,r)?{segmentGroup:new W(e,fE(r,new W(t,n.children))),slicedSegments:[]}:t.length===0&&gE(n,t,r)?{segmentGroup:new W(n.segments,dE(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new W(n.segments,n.children),slicedSegments:t}}function dE(n,e,t,r){let i={};for(let s of t)if(Ko(n,e,s)&&!r[ht(s)]){let o=new W([],{});i[ht(s)]=o}return D(D({},r),i)}function fE(n,e){let t={};t[U]=e;for(let r of n)if(r.path===""&&ht(r)!==U){let i=new W([],{});t[ht(r)]=i}return t}function pE(n,e,t){return t.some(r=>Ko(n,e,r)&&ht(r)!==U)}function gE(n,e,t){return t.some(r=>Ko(n,e,r))}function Ko(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function mE(n,e,t,r){return ht(n)!==r&&(r===U||!Ko(e,t,n))?!1:el(e,n,t).matched}function yE(n,e,t){return e.length===0&&!n.children[t]}var Wc=class{};function vE(n,e,t,r,i,s,o="emptyOnly"){return new Hc(n,e,t,r,i,o,s).recognize()}var _E=31,Hc=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Kc(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new te(4002,`'${e.segmentGroup}'`)}recognize(){let e=dg(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(K(t=>{let r=new Vi([],Object.freeze({}),Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,{},U,this.rootComponentType,null,{}),i=new Be(r,t),s=new jo("",i),o=RT(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,U).pipe(Jn(r=>{if(r instanceof Bo)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ki?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Xc(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(K(s=>s instanceof Be?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Pe(i).pipe(Ut(s=>{let o=r.children[s],a=jT(t,s);return this.processSegmentGroup(e,a,o,s)}),Bf((s,o)=>(s.push(...o),s)),Ku(null),qf(),je(s=>{if(s===null)return ir(r);let o=Ug(s);return wE(o),x(o)}))}processSegment(e,t,r,i,s,o){return Pe(t).pipe(Ut(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Jn(u=>{if(u instanceof ki)return x(null);throw u}))),jt(a=>!!a),Jn(a=>{if(Lg(a))return yE(r,i,s)?x(new Wc):ir(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return mE(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):ir(i):ir(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=el(t,i,s);if(!a)return ir(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>_E&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(je(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=lE(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(qe(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(qe(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new Vi(l,d,Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,EE(r),ht(r),r.component??r._loadedComponent??null,r,IE(r)),{segmentGroup:T,slicedSegments:w}=dg(t,l,h,u);if(w.length===0&&T.hasChildren())return this.processChildren(c,u,T).pipe(K(R=>R===null?null:new Be(f,R)));if(u.length===0&&w.length===0)return x(new Be(f,[]));let y=ht(r)===s;return this.processSegment(c,u,T,w,y?U:s,!0).pipe(K(R=>new Be(f,R instanceof Be?[R]:[])))}))):ir(t)))}getChildConfig(e,t,r){return t.children?x({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?x({routes:t._loadedRoutes,injector:t._loadedInjector}):oE(e,t,r,this.urlSerializer).pipe(je(i=>i?this.configLoader.loadChildren(e,t).pipe(he(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):cE(t))):x({routes:[],injector:e})}};function wE(n){n.sort((e,t)=>e.value.outlet===U?-1:t.value.outlet===U?1:e.value.outlet.localeCompare(t.value.outlet))}function TE(n){let e=n.value.routeConfig;return e&&e.path===""}function Ug(n){let e=[],t=new Set;for(let r of n){if(!TE(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=Ug(r.children);e.push(new Be(r.value,i))}return e.filter(r=>!t.has(r))}function EE(n){return n.data||{}}function IE(n){return n.resolve||{}}function AE(n,e,t,r,i,s){return je(o=>vE(n,e,t,r,o.extractedUrl,i,s).pipe(K(({state:a,tree:u})=>Me(D({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function RE(n,e){return je(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return x(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of jg(u))o.add(c);let a=0;return Pe(o).pipe(Ut(u=>s.has(u)?SE(u,r,n,e):(u.data=Xc(u,u.parent,n).resolve,x(void 0))),he(()=>a++),Qu(1),je(u=>a===o.size?x(t):yn))})}function jg(n){let e=n.children.map(t=>jg(t)).flat();return[n,...e]}function SE(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!Ng(i)&&(s[Oi]=i.title),bE(s,n,e,r).pipe(K(o=>(n._resolvedData=o,n.data=Xc(n,n.parent,t).resolve,null)))}function bE(n,e,t,r){let i=Sc(n);if(i.length===0)return x({});let s={};return Pe(i).pipe(je(o=>CE(n[o],e,t,r).pipe(jt(),he(a=>{s[o]=a}))),Qu(1),jf(s),Jn(o=>Lg(o)?yn:oi(o)))}function CE(n,e,t,r){let i=Ui(e)??r,s=dr(n,i),o=s.resolve?s.resolve(e,t):ut(i,()=>s(e,t));return Qt(o)}function Ac(n){return qe(e=>{let t=n(e);return t?Pe(t).pipe(K(()=>e)):x(e)})}var qg=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===U);return i}getResolvedTitleForRoute(r){return r.data[Oi]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(PE),providedIn:"root"});let n=e;return n})(),PE=(()=>{let e=class e extends qg{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(k(og))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),qi=new Q("",{providedIn:"root",factory:()=>({})}),zo=new Q(""),tl=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=P(fo)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return x(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=Qt(r.loadComponent()).pipe(K(Bg),he(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),vn(()=>{this.componentLoaders.delete(r)})),s=new Bu(i,()=>new Ft).pipe(qu());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return x({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=DE(i,this.compiler,r,this.onLoadEndListener).pipe(vn(()=>{this.childrenLoaders.delete(i)})),a=new Bu(o,()=>new Ft).pipe(qu());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function DE(n,e,t,r){return Qt(n.loadChildren()).pipe(K(Bg),je(i=>i instanceof hp||Array.isArray(i)?x(i):Pe(e.compileModuleAsync(i))),K(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(zo,[],{optional:!0,self:!0}).flat()),{routes:o.map(Zc),injector:s}}))}function xE(n){return n&&typeof n=="object"&&"default"in n}function Bg(n){return xE(n)?n.default:n}var nl=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(NE),providedIn:"root"});let n=e;return n})(),NE=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),zg=new Q(""),$g=new Q("");function VE(n,e,t){let r=n.get($g),i=n.get(Fe);return n.get(de).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),ME(n))),{onViewTransitionCreated:u}=r;return u&&ut(n,()=>u({transition:a,from:e,to:t})),o})}function ME(n){return new Promise(e=>{up(e,{injector:n})})}var rl=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ft,this.transitionAbortSubject=new Ft,this.configLoader=P(tl),this.environmentInjector=P(_n),this.urlSerializer=P(Li),this.rootContexts=P(Fi),this.location=P(fi),this.inputBindingEnabled=P(Go,{optional:!0})!==null,this.titleStrategy=P(qg),this.options=P(qi,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=P(nl),this.createViewTransition=P(zg,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>x(void 0),this.rootComponentType=null;let r=s=>this.events.next(new Mc(s)),i=s=>this.events.next(new kc(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(Me(D(D({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new Ke({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Si,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(At(o=>o.id!==0),K(o=>Me(D({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),qe(o=>{this.currentTransition=o;let a=!1,u=!1;return x(o).pipe(he(c=>{this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?Me(D({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),qe(c=>{let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new Kt(c.id,this.urlSerializer.serialize(c.rawUrl),d,ko.IgnoredSameUrlNavigation)),c.resolve(null),yn}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return x(c).pipe(qe(d=>{let f=this.transitions?.getValue();return this.events.next(new lr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?yn:Promise.resolve(d)}),AE(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),he(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=Me(D({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Oo(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:T,restoredState:w,extras:y}=c,R=new lr(d,this.urlSerializer.serialize(f),T,w);this.events.next(R);let N=Dg(this.rootComponentType).snapshot;return this.currentTransition=o=Me(D({},c),{targetSnapshot:N,urlAfterRedirects:f,extras:Me(D({},y),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,x(o)}else{let d="";return this.events.next(new Kt(c.id,this.urlSerializer.serialize(c.extractedUrl),d,ko.IgnoredByUrlHandlingStrategy)),c.resolve(null),yn}}),he(c=>{let l=new Dc(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),K(c=>(this.currentTransition=o=Me(D({},c),{guards:BT(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),JT(this.environmentInjector,c=>this.events.next(c)),he(c=>{if(o.guardsResult=c.guardsResult,cr(c.guardsResult))throw Mg(this.urlSerializer,c.guardsResult);let l=new xc(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),At(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",Qe.GuardRejected),!1)),Ac(c=>{if(c.guards.canActivateChecks.length)return x(c).pipe(he(l=>{let h=new Nc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),qe(l=>{let h=!1;return x(l).pipe(RE(this.paramsInheritanceStrategy,this.environmentInjector),he({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",Qe.NoDataFromResolver)}}))}),he(l=>{let h=new Vc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),Ac(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(he(f=>{h.component=f}),K(()=>{})));for(let f of h.children)d.push(...l(f));return d};return Zs(l(c.targetSnapshot.root)).pipe(Ku(null),Zn(1))}),Ac(()=>this.afterPreactivation()),qe(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?Pe(h).pipe(K(()=>o)):x(o)}),K(c=>{let l=MT(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=Me(D({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),he(()=>{this.events.next(new xi)}),qT(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Zn(1),he({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new et(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),$f(this.transitionAbortSubject.pipe(he(c=>{throw c}))),vn(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",Qe.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Jn(c=>{if(u=!0,Og(c))this.events.next(new Gt(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),LT(c)?this.events.next(new Ni(c.url)):o.resolve(!1);else{this.events.next(new Di(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return yn}))}))}cancelNavigationTransition(r,i,s){let o=new Gt(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function kE(n){return n!==Si}var OE=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(LE),providedIn:"root"});let n=e;return n})(),Yc=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},LE=(()=>{let e=class e extends Yc{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Xu(e)))(s||e)}})(),e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Gg=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(FE),providedIn:"root"});let n=e;return n})(),FE=(()=>{let e=class e extends Gg{constructor(){super(...arguments),this.location=P(fi),this.urlSerializer=P(Li),this.options=P(qi,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=P(nl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new $t,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Dg(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof lr)this.stateMemento=this.createStateMemento();else if(r instanceof Kt)this.rawUrlTree=i.initialUrl;else if(r instanceof Oo){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof xi?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Gt&&(r.code===Qe.GuardRejected||r.code===Qe.NoDataFromResolver)?this.restoreHistory(i):r instanceof Di?this.restoreHistory(i,!0):r instanceof et&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=D(D({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=D(D({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Xu(e)))(s||e)}})(),e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ai=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Ai||{});function Kg(n,e){n.events.pipe(At(t=>t instanceof et||t instanceof Gt||t instanceof Di||t instanceof Kt),K(t=>t instanceof et||t instanceof Kt?Ai.COMPLETE:(t instanceof Gt?t.code===Qe.Redirect||t.code===Qe.SupersededByNewNavigation:!1)?Ai.REDIRECTING:Ai.FAILED),At(t=>t!==Ai.REDIRECTING),Zn(1)).subscribe(()=>{e()})}function UE(n){throw n}var jE={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},qE={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},bt=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=P(uo),this.stateManager=P(Gg),this.options=P(qi,{optional:!0})||{},this.pendingTasks=P(hi),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=P(rl),this.urlSerializer=P(Li),this.location=P(fi),this.urlHandlingStrategy=P(nl),this._events=new Ft,this.errorHandler=this.options.errorHandler||UE,this.navigated=!1,this.routeReuseStrategy=P(OE),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=P(zo,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!P(Go,{optional:!0}),this.eventsSubscription=new Vf,this.isNgZoneEnabled=P(de)instanceof de&&de.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Gt&&i.code!==Qe.Redirect&&i.code!==Qe.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof et)this.navigated=!0;else if(i instanceof Ni){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||kE(s.source)};this.scheduleNavigation(a,Si,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}zE(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Si,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=D({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Zc),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=D(D({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=Sg(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return bg(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=cr(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Si,null,i)}navigate(r,i={skipLocationChange:!1}){return BE(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=D({},jE):i===!1?s=D({},qE):s=i,cr(r))return ag(this.currentUrlTree,r,s);let o=this.parseUrl(r);return ag(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return Kg(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function BE(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new te(4008,!1)}function zE(n){return!(n instanceof xi)&&!(n instanceof Ni)}var fg=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Ft,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof et&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:sp(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Ze(bt),Ze(An),Xf("tabindex"),Ze(Zu),Ze(Hu),Ze(di))},e.\u0275dir=to({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&pp("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&dp("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[eo.HasDecoratorInputTransform,"preserveFragment","preserveFragment",po],skipLocationChange:[eo.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",po],replaceUrl:[eo.HasDecoratorInputTransform,"replaceUrl","replaceUrl",po],routerLink:"routerLink"},standalone:!0,features:[lp,io]});let n=e;return n})(),fS=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new er,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof et&&this.update()})}ngAfterContentInit(){x(this.links.changes,x(null)).pipe(ai()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Pe(r).pipe(ai()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(r))})}isLinkActive(r){let i=$E(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(Ze(bt),Ze(Hu),Ze(Zu),Ze(so),Ze(fg,8))},e.\u0275dir=to({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&gp(o,fg,5),i&2){let a;mp(a=yp())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[io]});let n=e;return n})();function $E(n){return!!n.paths}var $o=class{};var GE=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(At(r=>r instanceof et),Ut(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=ec(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return Pe(s).pipe(ai())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=x(null);let o=s.pipe(je(a=>a===null?x(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return Pe([o,a]).pipe(ai())}else return o})}};e.\u0275fac=function(i){return new(i||e)(k(bt),k(fo),k(_n),k($o),k(tl))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Qg=new Q(""),KE=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof lr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof et?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Kt&&r.code===ko.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Lo&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Lo(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){op()},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function QE(n){return n.routerState.root}function Bi(n,e){return{\u0275kind:n,\u0275providers:e}}function WE(){let n=P(ci);return e=>{let t=n.get(ho);if(e!==t.components[0])return;let r=n.get(bt),i=n.get(Wg);n.get(il)===1&&r.initialNavigation(),n.get(Hg,null,Wu.Optional)?.setUpPreloading(),n.get(Qg,null,Wu.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var Wg=new Q("",{factory:()=>new Ft}),il=new Q("",{providedIn:"root",factory:()=>1});function HE(){return Bi(2,[{provide:il,useValue:0},{provide:nc,multi:!0,deps:[ci],useFactory:e=>{let t=e.get(bp,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(bt),s=e.get(Wg);Kg(i,()=>{r(!0)}),e.get(rl).afterPreactivation=()=>(r(!0),s.closed?x(void 0):s),i.initialNavigation()}))}}])}function YE(){return Bi(3,[{provide:nc,multi:!0,useFactory:()=>{let e=P(bt);return()=>{e.setUpLocationChangeListener()}}},{provide:il,useValue:2}])}var Hg=new Q("");function XE(n){return Bi(0,[{provide:Hg,useExisting:GE},{provide:$o,useExisting:n}])}function JE(){return Bi(8,[hg,{provide:Go,useExisting:hg}])}function ZE(n){let e=[{provide:zg,useValue:VE},{provide:$g,useValue:D({skipNextTransition:!!n?.skipInitialTransition},n)}];return Bi(9,e)}var pg=new Q("ROUTER_FORROOT_GUARD"),eI=[fi,{provide:Li,useClass:Ci},bt,Fi,{provide:An,useFactory:QE,deps:[bt]},tl,[]],pS=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[eI,[],{provide:zo,multi:!0,useValue:r},{provide:pg,useFactory:iI,deps:[[bt,new Bt,new Hf]]},{provide:qi,useValue:i||{}},i?.useHash?nI():rI(),tI(),i?.preloadingStrategy?XE(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?sI(i):[],i?.bindToComponentInputs?JE().\u0275providers:[],i?.enableViewTransitions?ZE().\u0275providers:[],oI()]}}static forChild(r){return{ngModule:e,providers:[{provide:zo,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(k(pg,8))},e.\u0275mod=ot({type:e}),e.\u0275inj=at({});let n=e;return n})();function tI(){return{provide:Qg,useFactory:()=>{let n=P(Np),e=P(de),t=P(qi),r=P(rl),i=P(Li);return t.scrollOffset&&n.setOffset(t.scrollOffset),new KE(i,r,n,e,t)}}}function nI(){return{provide:di,useClass:Pp}}function rI(){return{provide:di,useClass:Cp}}function iI(n){return"guarded"}function sI(n){return[n.initialNavigation==="disabled"?YE().\u0275providers:[],n.initialNavigation==="enabledBlocking"?HE().\u0275providers:[]]}var gg=new Q("");function oI(){return[{provide:gg,useFactory:WE},{provide:rc,multi:!0,useExisting:gg}]}var aI="firebase",uI="10.10.0";Rt(aI,uI,"app");var pr=new oo("ANGULARFIRE2_VERSION");function RS(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var cI=(n,e)=>{let t=e?[e]:_o(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Yg=class{constructor(){return cI(lI)}},lI="app-check";function fr(){}var Qo=class{zone;delegate;constructor(e,t=Of){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},sl=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",fr,{},fr,fr)),t.pipe(he({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Xg=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Qo(Zone.current)),this.insideAngular=t.run(()=>new Qo(Zone.current,kf)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(k(de))};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Wo(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function hI(n){return Wo().ngZone.runOutsideAngular(()=>n())}function Rn(n){return Wo().ngZone.run(()=>n())}function dI(n){return fI(Wo())(n)}function fI(n){return function(t){return t=t.lift(new sl(n.ngZone)),t.pipe($u(n.outsideAngular),zu(n.insideAngular))}}var pI=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Rn(()=>n.apply(void 0,r))},Jg=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=Rn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",fr,{},fr,fr))),r[s]=pI(r[s],t));let i=hI(()=>n.apply(this,r));if(!e)if(i instanceof si){let s=Wo();return i.pipe($u(s.outsideAngular),zu(s.insideAngular))}else return Rn(()=>i);return i instanceof si?i.pipe(dI):i instanceof Promise?Rn(()=>new Promise((s,o)=>i.then(a=>Rn(()=>s(a)),a=>Rn(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Rn(()=>i)};var zi=class{constructor(e){return e}},ol=class{constructor(){return _o()}};function gI(n){return n&&n.length===1?n[0]:new zi(vo())}var al=new Q("angularfire2._apps"),mI={provide:zi,useFactory:gI,deps:[[new Bt,al]]},yI={provide:ol,deps:[[new Bt,al]]};function vI(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new zi(r)}}var _I=(()=>{class n{constructor(t){Rt("angularfire",pr.full,"core"),Rt("angularfire",pr.full,"app"),Rt("angular",ao.full,t.toString())}static \u0275fac=function(r){return new(r||n)(k(Je))};static \u0275mod=ot({type:n});static \u0275inj=at({providers:[mI,yI]})}return n})();function kS(n,...e){return{ngModule:_I,providers:[{provide:al,useFactory:vI(n),multi:!0,deps:[de,ci,Xg,...e]}]}}var OS=Jg(Bp,!0);var wI="firebase",TI="10.10.0";St.registerVersion(wI,TI,"app-compat");var EI=["ngOnDestroy"],QS=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(EI.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var Ho=class{constructor(e){return e}},em=new Q("angularfire2.app.options"),tm=new Q("angularfire2.app.name");function II(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=St.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>St.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;AI("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Ho(o)}var AI=(n,...e)=>{ic()&&typeof console<"u"&&console[n](...e)},RI={provide:Ho,useFactory:II,deps:[em,de,[new Bt,tm]]},WS=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:em,useValue:t},{provide:tm,useValue:r}]}}constructor(t){St.registerVersion("angularfire",pr.full,"core"),St.registerVersion("angularfire",pr.full,"app-compat"),St.registerVersion("angular",ao.full,t.toString())}static \u0275fac=function(r){return new(r||n)(k(Je))};static \u0275mod=ot({type:n});static \u0275inj=at({providers:[RI]})}return n})();function HS(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return SI(i,o)||(Zg("error",`${e} was already initialized on the ${t} Firebase App with different settings.${bI?" You may need to reload as Firebase is not HMR aware.":""}`),Zg("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function SI(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var bI=typeof module<"u"&&!!module.hot,Zg=(n,...e)=>{ic()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var CI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nt={},I,Pl=Pl||{},V=CI||self;function ca(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function rs(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function PI(n){return Object.prototype.hasOwnProperty.call(n,ul)&&n[ul]||(n[ul]=++DI)}var ul="closure_uid_"+(1e9*Math.random()>>>0),DI=0;function xI(n,e,t){return n.call.apply(n.bind,arguments)}function NI(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function De(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?De=xI:De=NI,De.apply(null,arguments)}function Yo(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ee(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Wt(){this.s=this.s,this.o=this.o}var VI=0;Wt.prototype.s=!1;Wt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),VI!=0)&&PI(this)};Wt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var pm=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Dl(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function nm(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(ca(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function xe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var MI=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};V.addEventListener("test",t,e),V.removeEventListener("test",t,e)}catch{}return n}();function Hi(n){return/^[\s\xa0]*$/.test(n)}function la(){var n=V.navigator;return n&&(n=n.userAgent)?n:""}function dt(n){return la().indexOf(n)!=-1}function xl(n){return xl[" "](n),n}xl[" "]=function(){};function kI(n,e){var t=IA;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var OI=dt("Opera"),vr=dt("Trident")||dt("MSIE"),gm=dt("Edge"),fl=gm||vr,mm=dt("Gecko")&&!(la().toLowerCase().indexOf("webkit")!=-1&&!dt("Edge"))&&!(dt("Trident")||dt("MSIE"))&&!dt("Edge"),LI=la().toLowerCase().indexOf("webkit")!=-1&&!dt("Edge");function ym(){var n=V.document;return n?n.documentMode:void 0}var pl;e:{if(Xo="",Jo=function(){var n=la();if(mm)return/rv:([^\);]+)(\)|;)/.exec(n);if(gm)return/Edge\/([\d\.]+)/.exec(n);if(vr)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(LI)return/WebKit\/(\S+)/.exec(n);if(OI)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Jo&&(Xo=Jo?Jo[1]:""),vr&&(Zo=ym(),Zo!=null&&Zo>parseFloat(Xo))){pl=String(Zo);break e}pl=Xo}var Xo,Jo,Zo,gl;V.document&&vr?(cl=ym(),gl=cl||parseInt(pl,10)||void 0):gl=void 0;var cl,FI=gl;function Yi(n,e){if(xe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(mm){e:{try{xl(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:UI[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Yi.$.h.call(this)}}Ee(Yi,xe);var UI={2:"touch",3:"pen",4:"mouse"};Yi.prototype.h=function(){Yi.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var is="closure_listenable_"+(1e6*Math.random()|0),jI=0;function qI(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++jI,this.fa=this.ia=!1}function ha(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Nl(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function BI(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function vm(n){let e={};for(let t in n)e[t]=n[t];return e}var rm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _m(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<rm.length;s++)t=rm[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function da(n){this.src=n,this.g={},this.h=0}da.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=yl(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new qI(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function ml(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=pm(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ha(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function yl(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Vl="closure_lm_"+(1e6*Math.random()|0),ll={};function wm(n,e,t,r,i){if(r&&r.once)return Em(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)wm(n,e[s],t,r,i);return null}return t=Ol(t),n&&n[is]?n.O(e,t,rs(r)?!!r.capture:!!r,i):Tm(n,e,t,!1,r,i)}function Tm(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=rs(i)?!!i.capture:!!i,a=kl(n);if(a||(n[Vl]=a=new da(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=zI(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)MI||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Am(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function zI(){function n(t){return e.call(n.src,n.listener,t)}let e=$I;return n}function Em(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Em(n,e[s],t,r,i);return null}return t=Ol(t),n&&n[is]?n.P(e,t,rs(r)?!!r.capture:!!r,i):Tm(n,e,t,!0,r,i)}function Im(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Im(n,e[s],t,r,i);else r=rs(r)?!!r.capture:!!r,t=Ol(t),n&&n[is]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=yl(s,t,r,i),-1<t&&(ha(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=kl(n))&&(e=n.g[e.toString()],n=-1,e&&(n=yl(e,t,r,i)),(t=-1<n?e[n]:null)&&Ml(t))}function Ml(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[is])ml(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Am(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=kl(e))?(ml(t,n),t.h==0&&(t.src=null,e[Vl]=null)):ha(n)}}}function Am(n){return n in ll?ll[n]:ll[n]="on"+n}function $I(n,e){if(n.fa)n=!0;else{e=new Yi(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Ml(n),n=t.call(r,e)}return n}function kl(n){return n=n[Vl],n instanceof da?n:null}var hl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ol(n){return typeof n=="function"?n:(n[hl]||(n[hl]=function(e){return n.handleEvent(e)}),n[hl])}function Te(){Wt.call(this),this.i=new da(this),this.S=this,this.J=null}Ee(Te,Wt);Te.prototype[is]=!0;Te.prototype.removeEventListener=function(n,e,t,r){Im(this,n,e,t,r)};function Se(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new xe(e,n);else if(e instanceof xe)e.target=e.target||n;else{var i=e;e=new xe(r,n),_m(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=ea(o,r,!0,e)&&i}if(o=e.g=n,i=ea(o,r,!0,e)&&i,i=ea(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=ea(o,r,!1,e)&&i}Te.prototype.N=function(){if(Te.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)ha(t[r]);delete n.g[e],n.h--}}this.J=null};Te.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Te.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function ea(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&ml(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Ll=V.JSON.stringify,vl=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function GI(){var n=Fl;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var _l=class{constructor(){this.h=this.g=null}add(e,t){let r=Rm.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Rm=new vl(()=>new wl,n=>n.reset()),wl=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function KI(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function QI(n){V.setTimeout(()=>{throw n},0)}var Xi,Ji=!1,Fl=new _l,Sm=()=>{let n=V.Promise.resolve(void 0);Xi=()=>{n.then(WI)}},WI=()=>{for(var n;n=GI();){try{n.h.call(n.g)}catch(t){QI(t)}var e=Rm;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ji=!1};function fa(n,e){Te.call(this),this.h=n||1,this.g=e||V,this.j=De(this.qb,this),this.l=Date.now()}Ee(fa,Te);I=fa.prototype;I.ga=!1;I.T=null;I.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Se(this,"tick"),this.ga&&(Ul(this),this.start()))}};I.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ul(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}I.N=function(){fa.$.N.call(this),Ul(this),delete this.g};function jl(n,e,t){if(typeof n=="function")t&&(n=De(n,t));else if(n&&typeof n.handleEvent=="function")n=De(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:V.setTimeout(n,e||0)}function bm(n){n.g=jl(()=>{n.g=null,n.i&&(n.i=!1,bm(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Tl=class extends Wt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:bm(this)}N(){super.N(),this.g&&(V.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Zi(n){Wt.call(this),this.h=n,this.g={}}Ee(Zi,Wt);var im=[];function Cm(n,e,t,r){Array.isArray(t)||(t&&(im[0]=t.toString()),t=im);for(var i=0;i<t.length;i++){var s=wm(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Pm(n){Nl(n.g,function(e,t){this.g.hasOwnProperty(t)&&Ml(e)},n),n.g={}}Zi.prototype.N=function(){Zi.$.N.call(this),Pm(this)};Zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function pa(){this.g=!0}pa.prototype.Ea=function(){this.g=!1};function HI(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function YI(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function mr(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+JI(n,t)+(r?" "+r:"")})}function XI(n,e){n.info(function(){return"TIMEOUT: "+e})}pa.prototype.info=function(){};function JI(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Ll(t)}catch{return e}}var Pn={},sm=null;function ga(){return sm=sm||new Te}Pn.Ta="serverreachability";function Dm(n){xe.call(this,Pn.Ta,n)}Ee(Dm,xe);function es(n){let e=ga();Se(e,new Dm(e))}Pn.STAT_EVENT="statevent";function xm(n,e){xe.call(this,Pn.STAT_EVENT,n),this.stat=e}Ee(xm,xe);function ke(n){let e=ga();Se(e,new xm(e,n))}Pn.Ua="timingevent";function Nm(n,e){xe.call(this,Pn.Ua,n),this.size=e}Ee(Nm,xe);function ss(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){n()},e)}var ma={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Vm={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ql(){}ql.prototype.h=null;function om(n){return n.h||(n.h=n.i())}function Mm(){}var os={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Bl(){xe.call(this,"d")}Ee(Bl,xe);function zl(){xe.call(this,"c")}Ee(zl,xe);var El;function ya(){}Ee(ya,ql);ya.prototype.g=function(){return new XMLHttpRequest};ya.prototype.i=function(){return{}};El=new ya;function as(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Zi(this),this.P=ZI,n=fl?125:void 0,this.V=new fa(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new km}function km(){this.i=null,this.g="",this.h=!1}var ZI=45e3,Om={},Il={};I=as.prototype;I.setTimeout=function(n){this.P=n};function Al(n,e,t){n.L=1,n.A=_a(Pt(e)),n.u=t,n.S=!0,Lm(n,null)}function Lm(n,e){n.G=Date.now(),us(n),n.B=Pt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Gm(t.i,"t",r),n.o=0,t=n.l.J,n.h=new km,n.g=dy(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Tl(De(n.Pa,n,n.g),n.O)),Cm(n.U,n.g,"readystatechange",n.nb),e=n.I?vm(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),es(),HI(n.j,n.v,n.B,n.m,n.W,n.u)}I.nb=function(n){n=n.target;let e=this.M;e&&ft(n)==3?e.l():this.Pa(n)};I.Pa=function(n){try{if(n==this.g)e:{let l=ft(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||fl||this.g&&(this.h.h||this.g.ja()||lm(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?es(3):es(2)),va(this);var t=this.g.da();this.ca=t;t:if(Fm(this)){var r=lm(this.g);n="";var i=r.length,s=ft(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Sn(this),Wi(this);var o="";break t}this.h.i=new V.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,YI(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hi(a)){var c=a;break t}}c=null}if(t=c)mr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rl(this,t);else{this.i=!1,this.s=3,ke(12),Sn(this),Wi(this);break e}}this.S?(Um(this,l,o),fl&&this.i&&l==3&&(Cm(this.U,this.V,"tick",this.mb),this.V.start())):(mr(this.j,this.m,o,null),Rl(this,o)),l==4&&Sn(this),this.i&&!this.J&&(l==4?uy(this.l,this):(this.i=!1,us(this)))}else wA(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Sn(this),Wi(this)}}}catch{}finally{}};function Fm(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Um(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=eA(n,t),i==Il){e==4&&(n.s=4,ke(14),r=!1),mr(n.j,n.m,null,"[Incomplete Response]");break}else if(i==Om){n.s=4,ke(15),mr(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else mr(n.j,n.m,i,null),Rl(n,i);Fm(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,ke(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Hl(e),e.M=!0,ke(11))):(mr(n.j,n.m,t,"[Invalid Chunked Response]"),Sn(n),Wi(n))}I.mb=function(){if(this.g){var n=ft(this.g),e=this.g.ja();this.o<e.length&&(va(this),Um(this,n,e),this.i&&n!=4&&us(this))}};function eA(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Il:(t=Number(e.substring(t,r)),isNaN(t)?Om:(r+=1,r+t>e.length?Il:(e=e.slice(r,r+t),n.o=r+t,e)))}I.cancel=function(){this.J=!0,Sn(this)};function us(n){n.Y=Date.now()+n.P,jm(n,n.P)}function jm(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=ss(De(n.lb,n),e)}function va(n){n.C&&(V.clearTimeout(n.C),n.C=null)}I.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(XI(this.j,this.B),this.L!=2&&(es(),ke(17)),Sn(this),this.s=2,Wi(this)):jm(this,this.Y-n)};function Wi(n){n.l.H==0||n.J||uy(n.l,n)}function Sn(n){va(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Ul(n.V),Pm(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Rl(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Sl(t.i,n))){if(!n.K&&Sl(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)sa(t),Ea(t);else break e;Wl(t),ke(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=ss(De(t.ib,t),6e3));if(1>=Wm(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else bn(t,11)}else if((n.K||t.g==n)&&sa(t),!Hi(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let T=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(T){var s=r.i;s.g||T.indexOf("spdy")==-1&&T.indexOf("quic")==-1&&T.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&($l(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,Z(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=hy(r,r.J?r.pa:null,r.Y),o.K){Hm(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(va(a),us(a)),r.g=o}else oy(r);0<t.j.length&&Ia(t)}else c[0]!="stop"&&c[0]!="close"||bn(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?bn(t,7):Ql(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}es(4)}catch{}}function tA(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(ca(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function nA(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ca(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function qm(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(ca(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=nA(n),r=tA(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var Bm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rA(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Cn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Cn){this.h=n.h,ra(this,n.j),this.s=n.s,this.g=n.g,ia(this,n.m),this.l=n.l;var e=n.i,t=new ts;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),am(this,t),this.o=n.o}else n&&(e=String(n).match(Bm))?(this.h=!1,ra(this,e[1]||"",!0),this.s=Ki(e[2]||""),this.g=Ki(e[3]||"",!0),ia(this,e[4]),this.l=Ki(e[5]||"",!0),am(this,e[6]||"",!0),this.o=Ki(e[7]||"")):(this.h=!1,this.i=new ts(null,this.h))}Cn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Qi(e,um,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Qi(e,um,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Qi(t,t.charAt(0)=="/"?oA:sA,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Qi(t,uA)),n.join("")};function Pt(n){return new Cn(n)}function ra(n,e,t){n.j=t?Ki(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ia(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function am(n,e,t){e instanceof ts?(n.i=e,cA(n.i,n.h)):(t||(e=Qi(e,aA)),n.i=new ts(e,n.h))}function Z(n,e,t){n.i.set(e,t)}function _a(n){return Z(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ki(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Qi(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,iA),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function iA(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var um=/[#\/\?@]/g,sA=/[#\?:]/g,oA=/[#\?]/g,aA=/[#\?@]/g,uA=/#/g;function ts(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Ht(n){n.g||(n.g=new Map,n.h=0,n.i&&rA(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}I=ts.prototype;I.add=function(n,e){Ht(this),this.i=null,n=_r(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function zm(n,e){Ht(n),e=_r(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function $m(n,e){return Ht(n),e=_r(n,e),n.g.has(e)}I.forEach=function(n,e){Ht(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};I.ta=function(){Ht(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};I.Z=function(n){Ht(this);let e=[];if(typeof n=="string")$m(this,n)&&(e=e.concat(this.g.get(_r(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};I.set=function(n,e){return Ht(this),this.i=null,n=_r(this,n),$m(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};I.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Gm(n,e,t){zm(n,e),0<t.length&&(n.i=null,n.g.set(_r(n,e),Dl(t)),n.h+=t.length)}I.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function _r(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function cA(n,e){e&&!n.j&&(Ht(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(zm(this,r),Gm(this,i,t))},n)),n.j=e}var lA=class{constructor(n,e){this.g=n,this.map=e}};function Km(n){this.l=n||hA,V.PerformanceNavigationTiming?(n=V.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(V.g&&V.g.Ka&&V.g.Ka()&&V.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var hA=10;function Qm(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Wm(n){return n.h?1:n.g?n.g.size:0}function Sl(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function $l(n,e){n.g?n.g.add(e):n.h=e}function Hm(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}Km.prototype.cancel=function(){if(this.i=Ym(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Ym(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Dl(n.i)}var dA=class{stringify(n){return V.JSON.stringify(n,void 0)}parse(n){return V.JSON.parse(n,void 0)}};function fA(){this.g=new dA}function pA(n,e,t){let r=t||"";try{qm(n,function(i,s){let o=i;rs(i)&&(o=Ll(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function gA(n,e){let t=new pa;if(V.Image){let r=new Image;r.onload=Yo(ta,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Yo(ta,t,r,"TestLoadImage: error",!1,e),r.onabort=Yo(ta,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Yo(ta,t,r,"TestLoadImage: timeout",!1,e),V.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function ta(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function cs(n){this.l=n.ec||null,this.j=n.ob||!1}Ee(cs,ql);cs.prototype.g=function(){return new wa(this.l,this.j)};cs.prototype.i=function(n){return function(){return n}}({});function wa(n,e){Te.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Gl,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ee(wa,Te);var Gl=0;I=wa.prototype;I.open=function(n,e){if(this.readyState!=Gl)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ns(this)};I.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||V).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ls(this)),this.readyState=Gl};I.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ns(this)),this.g&&(this.readyState=3,ns(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof V.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xm(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function Xm(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}I.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ls(this):ns(this),this.readyState==3&&Xm(this)}};I.Za=function(n){this.g&&(this.response=this.responseText=n,ls(this))};I.Ya=function(n){this.g&&(this.response=n,ls(this))};I.ka=function(){this.g&&ls(this)};function ls(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ns(n)}I.setRequestHeader=function(n,e){this.v.append(n,e)};I.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};I.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function ns(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(wa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var mA=V.JSON.parse;function re(n){Te.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Jm,this.L=this.M=!1}Ee(re,Te);var Jm="",yA=/^https?$/i,vA=["POST","PUT"];I=re.prototype;I.Oa=function(n){this.M=n};I.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():El.g(),this.C=this.u?om(this.u):om(El),this.g.onreadystatechange=De(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){cm(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=V.FormData&&n instanceof V.FormData,!(0<=pm(vA,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ty(this),0<this.B&&((this.L=_A(this.g))?(this.g.timeout=this.B,this.g.ontimeout=De(this.ua,this)):this.A=jl(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){cm(this,s)}};function _A(n){return vr&&typeof n.timeout=="number"&&n.ontimeout!==void 0}I.ua=function(){typeof Pl<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))};function cm(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Zm(n),Ta(n)}function Zm(n){n.F||(n.F=!0,Se(n,"complete"),Se(n,"error"))}I.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Se(this,"complete"),Se(this,"abort"),Ta(this))};I.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ta(this,!0)),re.$.N.call(this)};I.La=function(){this.s||(this.G||this.v||this.l?ey(this):this.kb())};I.kb=function(){ey(this)};function ey(n){if(n.h&&typeof Pl<"u"&&(!n.C[1]||ft(n)!=4||n.da()!=2)){if(n.v&&ft(n)==4)jl(n.La,0,n);else if(Se(n,"readystatechange"),ft(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(Bm)[1]||null;!i&&V.self&&V.self.location&&(i=V.self.location.protocol.slice(0,-1)),r=!yA.test(i?i.toLowerCase():"")}t=r}if(t)Se(n,"complete"),Se(n,"success");else{n.m=6;try{var s=2<ft(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Zm(n)}}finally{Ta(n)}}}}function Ta(n,e){if(n.g){ty(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Se(n,"ready");try{t.onreadystatechange=r}catch{}}}function ty(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(V.clearTimeout(n.A),n.A=null)}I.isActive=function(){return!!this.g};function ft(n){return n.g?n.g.readyState:0}I.da=function(){try{return 2<ft(this)?this.g.status:-1}catch{return-1}};I.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};I.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),mA(e)}};function lm(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Jm:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function wA(n){let e={};n=(n.g&&2<=ft(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Hi(n[r]))continue;var t=KI(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}BI(e,function(r){return r.join(", ")})}I.Ia=function(){return this.m};I.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function ny(n){let e="";return Nl(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Kl(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=ny(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Z(n,e,t))}function $i(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function ry(n){this.Ga=0,this.j=[],this.l=new pa,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=$i("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=$i("baseRetryDelayMs",5e3,n),this.hb=$i("retryDelaySeedMs",1e4,n),this.eb=$i("forwardChannelMaxRetries",2,n),this.xa=$i("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Km(n&&n.concurrentRequestLimit),this.Ja=new fA,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}I=ry.prototype;I.ra=8;I.H=1;function Ql(n){if(iy(n),n.H==3){var e=n.W++,t=Pt(n.I);if(Z(t,"SID",n.K),Z(t,"RID",e),Z(t,"TYPE","terminate"),hs(n,t),e=new as(n,n.l,e),e.L=2,e.A=_a(Pt(t)),t=!1,V.navigator&&V.navigator.sendBeacon)try{t=V.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&V.Image&&(new Image().src=e.A,t=!0),t||(e.g=dy(e.l,null),e.g.ha(e.A)),e.G=Date.now(),us(e)}ly(n)}function Ea(n){n.g&&(Hl(n),n.g.cancel(),n.g=null)}function iy(n){Ea(n),n.u&&(V.clearTimeout(n.u),n.u=null),sa(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&V.clearTimeout(n.m),n.m=null)}function Ia(n){if(!Qm(n.i)&&!n.m){n.m=!0;var e=n.Na;Xi||Sm(),Ji||(Xi(),Ji=!0),Fl.add(e,n),n.C=0}}function TA(n,e){return Wm(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=ss(De(n.Na,n,e),cy(n,n.C)),n.C++,!0)}I.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new as(this,this.l,n),s=this.s;if(this.U&&(s?(s=vm(s),_m(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=sy(this,i,e),t=Pt(this.I),Z(t,"RID",n),Z(t,"CVER",22),this.F&&Z(t,"X-HTTP-Session-Id",this.F),hs(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(ny(s)))+"&"+e:this.o&&Kl(t,this.o,s)),$l(this.i,i),this.bb&&Z(t,"TYPE","init"),this.P?(Z(t,"$req",e),Z(t,"SID","null"),i.aa=!0,Al(i,t,null)):Al(i,t,e),this.H=2}}else this.H==3&&(n?hm(this,n):this.j.length==0||Qm(this.i)||hm(this))};function hm(n,e){var t;e?t=e.m:t=n.W++;let r=Pt(n.I);Z(r,"SID",n.K),Z(r,"RID",t),Z(r,"AID",n.V),hs(n,r),n.o&&n.s&&Kl(r,n.o,n.s),t=new as(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=sy(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),$l(n.i,t),Al(t,r,e)}function hs(n,e){n.na&&Nl(n.na,function(t,r){Z(e,r,t)}),n.h&&qm({},function(t,r){Z(e,r,t)})}function sy(n,e,t){t=Math.min(n.j.length,t);var r=n.h?De(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{pA(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function oy(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Xi||Sm(),Ji||(Xi(),Ji=!0),Fl.add(e,n),n.A=0}}function Wl(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=ss(De(n.Ma,n),cy(n,n.A)),n.A++,!0)}I.Ma=function(){if(this.u=null,ay(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ss(De(this.jb,this),n)}};I.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ke(10),Ea(this),ay(this))};function Hl(n){n.B!=null&&(V.clearTimeout(n.B),n.B=null)}function ay(n){n.g=new as(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Pt(n.wa);Z(e,"RID","rpc"),Z(e,"SID",n.K),Z(e,"AID",n.V),Z(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Z(e,"TO",n.qa),Z(e,"TYPE","xmlhttp"),hs(n,e),n.o&&n.s&&Kl(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=_a(Pt(e)),t.u=null,t.S=!0,Lm(t,n)}I.ib=function(){this.v!=null&&(this.v=null,Ea(this),Wl(this),ke(19))};function sa(n){n.v!=null&&(V.clearTimeout(n.v),n.v=null)}function uy(n,e){var t=null;if(n.g==e){sa(n),Hl(n),n.g=null;var r=2}else if(Sl(n.i,e))t=e.F,Hm(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=ga(),Se(r,new Nm(r,t)),Ia(n)}else oy(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&TA(n,e)||r==2&&Wl(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:bn(n,5);break;case 4:bn(n,10);break;case 3:bn(n,6);break;default:bn(n,2)}}}function cy(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function bn(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=De(n.pb,n);t||(t=new Cn("//www.google.com/images/cleardot.gif"),V.location&&V.location.protocol=="http"||ra(t,"https"),_a(t)),gA(t.toString(),r)}else ke(2);n.H=0,n.h&&n.h.za(e),ly(n),iy(n)}I.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ke(2)):(this.l.info("Failed to ping google.com"),ke(1))};function ly(n){if(n.H=0,n.ma=[],n.h){let e=Ym(n.i);(e.length!=0||n.j.length!=0)&&(nm(n.ma,e),nm(n.ma,n.j),n.i.i.length=0,Dl(n.j),n.j.length=0),n.h.ya()}}function hy(n,e,t){var r=t instanceof Cn?Pt(t):new Cn(t);if(r.g!="")e&&(r.g=e+"."+r.g),ia(r,r.m);else{var i=V.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Cn(null);r&&ra(s,r),e&&(s.g=e),i&&ia(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Z(r,t,e),Z(r,"VER",n.ra),hs(n,r),r}function dy(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new re(new cs({ob:t})):new re(n.va),e.Oa(n.J),e}I.isActive=function(){return!!this.h&&this.h.isActive(this)};function fy(){}I=fy.prototype;I.Ba=function(){};I.Aa=function(){};I.za=function(){};I.ya=function(){};I.isActive=function(){return!0};I.Va=function(){};function oa(){if(vr&&!(10<=Number(FI)))throw Error("Environmental error: no available transport.")}oa.prototype.g=function(n,e){return new ze(n,e)};function ze(n,e){Te.call(this),this.g=new ry(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Hi(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hi(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new wr(this)}Ee(ze,Te);ze.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ke(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=hy(n,null,n.Y),Ia(n)};ze.prototype.close=function(){Ql(this.g)};ze.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Ll(n),n=t);e.j.push(new lA(e.fb++,n)),e.H==3&&Ia(e)};ze.prototype.N=function(){this.g.h=null,delete this.j,Ql(this.g),delete this.g,ze.$.N.call(this)};function py(n){Bl.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Ee(py,Bl);function gy(){zl.call(this),this.status=1}Ee(gy,zl);function wr(n){this.g=n}Ee(wr,fy);wr.prototype.Ba=function(){Se(this.g,"a")};wr.prototype.Aa=function(n){Se(this.g,new py(n))};wr.prototype.za=function(n){Se(this.g,new gy)};wr.prototype.ya=function(){Se(this.g,"b")};function EA(){this.blockSize=-1}function tt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Ee(tt,EA);tt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function dl(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}tt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)dl(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){dl(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){dl(this,r),i=0;break}}this.h=i,this.i+=e};tt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function H(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var IA={};function Yl(n){return-128<=n&&128>n?kI(n,function(e){return new H([e|0],0>e?-1:0)}):new H([n|0],0>n?-1:0)}function pt(n){if(isNaN(n)||!isFinite(n))return yr;if(0>n)return Re(pt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=bl;return new H(e,0)}function my(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Re(my(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=pt(Math.pow(e,8)),r=yr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=pt(Math.pow(e,s)),r=r.R(s).add(pt(o))):(r=r.R(t),r=r.add(pt(o)))}return r}var bl=4294967296,yr=Yl(0),Cl=Yl(1),dm=Yl(16777216);I=H.prototype;I.ea=function(){if(He(this))return-Re(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:bl+r)*e,e*=bl}return n};I.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Ct(this))return"0";if(He(this))return"-"+Re(this).toString(n);for(var e=pt(Math.pow(n,6)),t=this,r="";;){var i=ua(t,e).g;t=aa(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Ct(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};I.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Ct(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function He(n){return n.h==-1}I.X=function(n){return n=aa(this,n),He(n)?-1:Ct(n)?0:1};function Re(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new H(t,~n.h).add(Cl)}I.abs=function(){return He(this)?Re(this):this};I.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new H(t,t[t.length-1]&-2147483648?-1:0)};function aa(n,e){return n.add(Re(e))}I.R=function(n){if(Ct(this)||Ct(n))return yr;if(He(this))return He(n)?Re(this).R(Re(n)):Re(Re(this).R(n));if(He(n))return Re(this.R(Re(n)));if(0>this.X(dm)&&0>n.X(dm))return pt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,na(t,2*r+2*i),t[2*r+2*i+1]+=s*u,na(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,na(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,na(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new H(t,0)};function na(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Gi(n,e){this.g=n,this.h=e}function ua(n,e){if(Ct(e))throw Error("division by zero");if(Ct(n))return new Gi(yr,yr);if(He(n))return e=ua(Re(n),e),new Gi(Re(e.g),Re(e.h));if(He(e))return e=ua(n,Re(e)),new Gi(Re(e.g),e.h);if(30<n.g.length){if(He(n)||He(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Cl,r=e;0>=r.X(n);)t=fm(t),r=fm(r);var i=gr(t,1),s=gr(r,1);for(r=gr(r,2),t=gr(t,2);!Ct(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=gr(r,1),t=gr(t,1)}return e=aa(n,i.R(e)),new Gi(i,e)}for(i=yr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=pt(t),o=s.R(e);He(o)||0<o.X(n);)t-=r,s=pt(t),o=s.R(e);Ct(s)&&(s=Cl),i=i.add(s),n=aa(n,o)}return new Gi(i,n)}I.gb=function(n){return ua(this,n).h};I.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new H(t,this.h&n.h)};I.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new H(t,this.h|n.h)};I.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new H(t,this.h^n.h)};function fm(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new H(t,n.h)}function gr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new H(i,n.h)}oa.prototype.createWebChannel=oa.prototype.g;ze.prototype.send=ze.prototype.u;ze.prototype.open=ze.prototype.m;ze.prototype.close=ze.prototype.close;ma.NO_ERROR=0;ma.TIMEOUT=8;ma.HTTP_ERROR=6;Vm.COMPLETE="complete";Mm.EventType=os;os.OPEN="a";os.CLOSE="b";os.ERROR="c";os.MESSAGE="d";Te.prototype.listen=Te.prototype.O;re.prototype.listenOnce=re.prototype.P;re.prototype.getLastError=re.prototype.Sa;re.prototype.getLastErrorCode=re.prototype.Ia;re.prototype.getStatus=re.prototype.da;re.prototype.getResponseJson=re.prototype.Wa;re.prototype.getResponseText=re.prototype.ja;re.prototype.send=re.prototype.ha;re.prototype.setWithCredentials=re.prototype.Oa;tt.prototype.digest=tt.prototype.l;tt.prototype.reset=tt.prototype.reset;tt.prototype.update=tt.prototype.j;H.prototype.add=H.prototype.add;H.prototype.multiply=H.prototype.R;H.prototype.modulo=H.prototype.gb;H.prototype.compare=H.prototype.X;H.prototype.toNumber=H.prototype.ea;H.prototype.toString=H.prototype.toString;H.prototype.getBits=H.prototype.D;H.fromNumber=pt;H.fromString=my;var yy=nt.createWebChannelTransport=function(){return new oa},vy=nt.getStatEventTarget=function(){return ga()},Aa=nt.ErrorCode=ma,_y=nt.EventType=Vm,wy=nt.Event=Pn,Xl=nt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},XS=nt.FetchXmlHttpFactory=cs,ds=nt.WebChannel=Mm,Ty=nt.XhrIo=re,Ey=nt.Md5=tt,Dn=nt.Integer=H;var Iy="@firebase/firestore";var ge=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ge.UNAUTHENTICATED=new ge(null),ge.GOOGLE_CREDENTIALS=new ge("google-credentials-uid"),ge.FIRST_PARTY=new ge("first-party-uid"),ge.MOCK_USER=new ge("mock-user");var Zr="10.10.0";var tn=new Fp("@firebase/firestore");function Rr(){return tn.logLevel}function ab(n){tn.setLogLevel(n)}function v(n,...e){if(tn.logLevel<=ct.DEBUG){let t=e.map(ef);tn.debug(`Firestore (${Zr}): ${n}`,...t)}}function oe(n,...e){if(tn.logLevel<=ct.ERROR){let t=e.map(ef);tn.error(`Firestore (${Zr}): ${n}`,...t)}}function wt(n,...e){if(tn.logLevel<=ct.WARN){let t=e.map(ef);tn.warn(`Firestore (${Zr}): ${n}`,...t)}}function ef(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function S(n="Unexpected state"){let e=`FIRESTORE (${Zr}) INTERNAL ASSERTION FAILED: `+n;throw oe(e),new Error(e)}function b(n,e){n||S()}function ub(n,e){n||S()}function E(n,e){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends Op{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var me=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ka=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},nh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ge.UNAUTHENTICATED))}shutdown(){}},rh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},ih=class{constructor(e){this.t=e,this.currentUser=ge.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new me;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new me,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>m(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new me)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b(typeof r.accessToken=="string"),new ka(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return b(e===null||typeof e=="string"),new ge(e)}},sh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ge.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},oh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new sh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ge.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ah=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},uh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b(typeof t.token=="string"),this.R=t.token,new ah(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function AA(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Oa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=AA(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function O(n,e){return n<e?-1:n>e?1:0}function kr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Av(n){return n+"\0"}var ae=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?O(this.nanoseconds,e.nanoseconds):O(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var C=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ae(0,0))}static max(){return new n(new ae(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var La=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&S(),r===void 0?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},z=class n extends La{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},RA=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_e=class n extends La{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return RA.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var A=class n{constructor(e){this.path=e}static fromPath(e){return new n(z.fromString(e))}static fromName(e){return new n(z.fromString(e).popFirst(5))}static empty(){return new n(z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&z.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new z(e.slice()))}};var Or=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function ch(n){return n.fields.find(e=>e.kind===2)}function Nn(n){return n.fields.filter(e=>e.kind!==2)}Or.UNKNOWN_ID=-1;var xr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var As=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Xe.min())}};function Rv(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=C.fromTimestamp(r===1e9?new ae(t+1,0):new ae(t,r));return new Xe(i,A.empty(),e)}function Sv(n){return new Xe(n.readTime,n.key,-1)}var Xe=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(C.min(),A.empty(),-1)}static max(){return new n(C.max(),A.empty(),-1)}};function tf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=A.comparator(n.documentKey,e.documentKey),t!==0?t:O(n.largestBatchId,e.largestBatchId))}var bv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function pn(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==bv)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Ua=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new me,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Fn(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=nf(r.target.error);this.V.reject(new Fn(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Fn(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new hh(t)}},Nt=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(pi())===12.2&&oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),Vn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!kp())return!1;if(n.C())return!0;let e=pi(),t=n.S(e),r=0<t&&t<10,i=n.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return m(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Fn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Fn(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db})}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=Ua.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},lh=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Vn(this.k.delete())}},Fn=class extends _{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function gn(n){return n.name==="IndexedDbTransactionError"}var hh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Vn(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),Vn(this.store.add(e))}get(e){return Vn(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),Vn(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),Vn(this.store.count())}W(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.G(i,t)}Z(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=nf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new lh(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Vn(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=nf(r.target.error);t(i)}})}var Ay=!1;function nf(n){let e=Nt.S(pi());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ay||(Ay=!0,setTimeout(()=>{throw r},0)),r}}return n}var dh=class{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(t){gn(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield pn(t)}yield this.ee(6e4)}))}},fh=class{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){return m(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))})}ne(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Sv(s);tf(o,r)>0&&(r=o)}),new Xe(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var $e=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Qs(n){return n==null}function Rs(n){return n===0&&1/n==-1/0}function Cv(n){return typeof n=="number"&&Number.isInteger(n)&&!Rs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Oe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ry(e)),e=SA(n.get(t),e);return Ry(e)}function SA(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Ry(n){return n+""}function gt(n){let e=n.length;if(b(e>=2),e===2)return b(n.charAt(0)===""&&n.charAt(1)===""),z.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new z(r)}var Sy=["userId","batchId"];function Pa(n,e){return[n,Oe(e)]}function Pv(n,e,t){return[n,Oe(e),t]}var bA={},CA=["prefixPath","collectionGroup","readTime","documentId"],PA=["prefixPath","collectionGroup","documentId"],DA=["collectionGroup","readTime","prefixPath","documentId"],xA=["canonicalId","targetId"],NA=["targetId","path"],VA=["path","targetId"],MA=["collectionId","parent"],kA=["indexId","uid"],OA=["uid","sequenceNumber"],LA=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],FA=["indexId","uid","orderedDocumentKey"],UA=["userId","collectionPath","documentId"],jA=["userId","collectionPath","largestBatchId"],qA=["userId","collectionGroup","largestBatchId"],Dv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],BA=[...Dv,"documentOverlays"],xv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Nv=xv,zA=[...Nv,"indexConfiguration","indexState","indexEntries"];var Ss=class extends Fa{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}};function Ae(n,e){let t=E(n);return Nt.M(t.ae,e)}function by(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Vv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ee=class n{constructor(e,t){this.comparator=e,this.root=t||yt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,yt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Dr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Dr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Dr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Dr(this.root,e,this.comparator,!0)}},Dr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},yt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};yt.EMPTY=null,yt.RED=!0,yt.BLACK=!1;yt.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var J=class n{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ja(this.data.getIterator())}getIteratorFrom(e){return new ja(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ja=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Tr(n){return n.hasNext()?n.getNext():void 0}var Ge=class n{constructor(e){this.fields=e,e.sort(_e.comparator)}static empty(){return new n([])}unionWith(e){let t=new J(_e.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return kr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var qa=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function lb(){return typeof atob<"u"}var Ie=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new qa("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return O(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var $A=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nn(n){if(b(!!n),typeof n=="string"){let e=0,t=$A.exec(n);if(b(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ie(n.seconds),nanos:ie(n.nanos)}}function ie(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rn(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}function xu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function rf(n){let e=n.mapValue.fields.__previous_value__;return xu(e)?rf(e):e}function bs(n){let e=nn(n.mapValue.fields.__local_write_time__.timestampValue);return new ae(e.seconds,e.nanos)}var ph=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Lr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var en={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Da={nullValue:"NULL_VALUE"};function Un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xu(n)?4:Mv(n)?9007199254740991:10:S()}function Tt(n,e){if(n===e)return!0;let t=Un(n);if(t!==Un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return bs(n).isEqual(bs(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=nn(i.timestampValue),a=nn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return rn(i.bytesValue).isEqual(rn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ie(i.geoPointValue.latitude)===ie(s.geoPointValue.latitude)&&ie(i.geoPointValue.longitude)===ie(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ie(i.integerValue)===ie(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ie(i.doubleValue),a=ie(s.doubleValue);return o===a?Rs(o)===Rs(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return kr(n.arrayValue.values||[],e.arrayValue.values||[],Tt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(by(o)!==by(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Tt(o[u],a[u])))return!1;return!0}(n,e);default:return S()}}function Cs(n,e){return(n.values||[]).find(t=>Tt(t,e))!==void 0}function sn(n,e){if(n===e)return 0;let t=Un(n),r=Un(e);if(t!==r)return O(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return O(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ie(s.integerValue||s.doubleValue),u=ie(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Cy(n.timestampValue,e.timestampValue);case 4:return Cy(bs(n),bs(e));case 5:return O(n.stringValue,e.stringValue);case 6:return function(s,o){let a=rn(s),u=rn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=O(a[c],u[c]);if(l!==0)return l}return O(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=O(ie(s.latitude),ie(o.latitude));return a!==0?a:O(ie(s.longitude),ie(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=sn(a[c],u[c]);if(l)return l}return O(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===en.mapValue&&o===en.mapValue)return 0;if(s===en.mapValue)return 1;if(o===en.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=O(u[h],l[h]);if(d!==0)return d;let f=sn(a[u[h]],c[l[h]]);if(f!==0)return f}return O(u.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function Cy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return O(n,e);let t=nn(n),r=nn(e),i=O(t.seconds,r.seconds);return i!==0?i:O(t.nanos,r.nanos)}function Fr(n){return gh(n)}function gh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=nn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return rn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return A.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=gh(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${gh(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function jn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mh(n){return!!n&&"integerValue"in n}function Ps(n){return!!n&&"arrayValue"in n}function Py(n){return!!n&&"nullValue"in n}function Dy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xa(n){return!!n&&"mapValue"in n}function _s(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Hn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=_s(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_s(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Mv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function GA(n){return"nullValue"in n?Da:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jn(Lr.empty(),A.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function KA(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jn(Lr.empty(),A.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?en:S()}function xy(n,e){let t=sn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ny(n,e){let t=sn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Ve=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!xa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_s(t)}setAll(e){let t=_e.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=_s(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());xa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];xa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Hn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(_s(this.value))}};function kv(n){let e=[];return Hn(n.fields,(t,r)=>{let i=new _e([t]);if(xa(r)){let s=kv(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Ge(e)}var ye=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,C.min(),C.min(),C.min(),Ve.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,C.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,C.min(),C.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,C.min(),C.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(C.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Et=class{constructor(e,t){this.position=e,this.inclusive=t}};function Vy(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=A.comparator(A.fromName(o.referenceValue),t.key):r=sn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function My(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Tt(n.position[t],e.position[t]))return!1;return!0}var qn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function QA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ba=class{},j=class n extends Ba{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new _h(e,t,r):t==="array-contains"?new Eh(e,r):t==="in"?new za(e,r):t==="not-in"?new Ih(e,r):t==="array-contains-any"?new Ah(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new wh(e,r):new Th(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(sn(t,this.value)):t!==null&&Un(this.value)===Un(t)&&this.matchesComparison(sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Y=class n extends Ba{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new n(e,t)}matches(e){return Ur(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Ur(n){return n.op==="and"}function yh(n){return n.op==="or"}function sf(n){return Ov(n)&&Ur(n)}function Ov(n){for(let e of n.filters)if(e instanceof Y)return!1;return!0}function vh(n){if(n instanceof j)return n.field.canonicalString()+n.op.toString()+Fr(n.value);if(sf(n))return n.filters.map(e=>vh(e)).join(",");{let e=n.filters.map(t=>vh(t)).join(",");return`${n.op}(${e})`}}function Lv(n,e){return n instanceof j?function(r,i){return i instanceof j&&r.op===i.op&&r.field.isEqual(i.field)&&Tt(r.value,i.value)}(n,e):n instanceof Y?function(r,i){return i instanceof Y&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Lv(o,i.filters[a]),!0):!1}(n,e):void S()}function Fv(n,e){let t=n.filters.concat(e);return Y.create(t,n.op)}function Uv(n){return n instanceof j?function(t){return`${t.field.canonicalString()} ${t.op} ${Fr(t.value)}`}(n):n instanceof Y?function(t){return t.op.toString()+" {"+t.getFilters().map(Uv).join(" ,")+"}"}(n):"Filter"}var _h=class extends j{constructor(e,t,r){super(e,t,r),this.key=A.fromName(r.referenceValue)}matches(e){let t=A.comparator(e.key,this.key);return this.matchesComparison(t)}},wh=class extends j{constructor(e,t){super(e,"in",t),this.keys=jv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Th=class extends j{constructor(e,t){super(e,"not-in",t),this.keys=jv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function jv(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>A.fromName(r.referenceValue))}var Eh=class extends j{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ps(t)&&Cs(t.arrayValue,this.value)}},za=class extends j{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Cs(this.value.arrayValue,t)}},Ih=class extends j{constructor(e,t){super(e,"not-in",t)}matches(e){if(Cs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Cs(this.value.arrayValue,t)}},Ah=class extends j{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ps(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Cs(this.value.arrayValue,r))}};var Rh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Sh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Rh(n,e,t,r,i,s,o)}function Bn(n){let e=E(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>vh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Qs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Fr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Fr(r)).join(",")),e.ce=t}return e.ce}function Ws(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!QA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Lv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!My(n.startAt,e.startAt)&&My(n.endAt,e.endAt)}function $a(n){return A.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ga(n,e){return n.filters.filter(t=>t instanceof j&&t.field.isEqual(e))}function ky(n,e,t){let r=Da,i=!0;for(let s of Ga(n,e)){let o=Da,a=!0;switch(s.op){case"<":case"<=":o=GA(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Da}xy({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];xy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Oy(n,e,t){let r=en,i=!0;for(let s of Ga(n,e)){let o=en,a=!0;switch(s.op){case">=":case">":o=KA(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=en}Ny({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Ny({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var rt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function qv(n,e,t,r,i,s,o,a){return new rt(n,e,t,r,i,s,o,a)}function ei(n){return new rt(n)}function Ly(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function of(n){return n.collectionGroup!==null}function Nr(n){let e=E(n);if(e.le===null){e.le=[];let t=new Set;for(let s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new J(_e.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new qn(s,r))}),t.has(_e.keyField().canonicalString())||e.le.push(new qn(_e.keyField(),r))}return e.le}function Le(n){let e=E(n);return e.he||(e.he=WA(e,Nr(n))),e.he}function WA(n,e){if(n.limitType==="F")return Sh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new qn(i.field,s)});let t=n.endAt?new Et(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Et(n.startAt.position,n.startAt.inclusive):null;return Sh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function bh(n,e){let t=n.filters.concat([e]);return new rt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ka(n,e,t){return new rt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Hs(n,e){return Ws(Le(n),Le(e))&&n.limitType===e.limitType}function Bv(n){return`${Bn(Le(n))}|lt:${n.limitType}`}function Sr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Uv(i)).join(", ")}]`),Qs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Fr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Fr(i)).join(",")),`Target(${r})`}(Le(n))}; limitType=${n.limitType})`}function Ys(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):A.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Nr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=Vy(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Nr(r),i)||r.endAt&&!function(o,a,u){let c=Vy(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Nr(r),i))}(n,e)}function zv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $v(n){return(e,t)=>{let r=!1;for(let i of Nr(n)){let s=HA(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function HA(n,e,t){let r=n.field.isKeyField()?A.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?sn(u,c):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var It=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Hn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Vv(this.inner)}size(){return this.innerSize}};var YA=new ee(A.comparator);function Ue(){return YA}var Gv=new ee(A.comparator);function ys(...n){let e=Gv;for(let t of n)e=e.insert(t.key,t);return e}function Kv(n){let e=Gv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function mt(){return ws()}function Qv(){return ws()}function ws(){return new It(n=>n.toString(),(n,e)=>n.isEqual(e))}var XA=new ee(A.comparator),JA=new J(A.comparator);function L(...n){let e=JA;for(let t of n)e=e.add(t);return e}var ZA=new J(O);function af(){return ZA}function Wv(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Rs(e)?"-0":e}}function Hv(n){return{integerValue:""+n}}function Yv(n,e){return Cv(e)?Hv(e):Wv(n,e)}var jr=class{constructor(){this._=void 0}};function e0(n,e,t){return n instanceof on?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&xu(s)&&(s=rf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Vt?Jv(n,e):n instanceof Mt?Zv(n,e):function(i,s){let o=Xv(i,s),a=Fy(o)+Fy(i.Ie);return mh(o)&&mh(i.Ie)?Hv(a):Wv(i.serializer,a)}(n,e)}function t0(n,e,t){return n instanceof Vt?Jv(n,e):n instanceof Mt?Zv(n,e):t}function Xv(n,e){return n instanceof an?function(r){return mh(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var on=class extends jr{},Vt=class extends jr{constructor(e){super(),this.elements=e}};function Jv(n,e){let t=e_(e);for(let r of n.elements)t.some(i=>Tt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Mt=class extends jr{constructor(e){super(),this.elements=e}};function Zv(n,e){let t=e_(e);for(let r of n.elements)t=t.filter(i=>!Tt(i,r));return{arrayValue:{values:t}}}var an=class extends jr{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function Fy(n){return ie(n.integerValue||n.doubleValue)}function e_(n){return Ps(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var zn=class{constructor(e,t){this.field=e,this.transform=t}};function n0(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Vt&&i instanceof Vt||r instanceof Mt&&i instanceof Mt?kr(r.elements,i.elements,Tt):r instanceof an&&i instanceof an?Tt(r.Ie,i.Ie):r instanceof on&&i instanceof on}(n.transform,e.transform)}var Ch=class{constructor(e,t){this.version=e,this.transformResults=t}},se=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Na(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var qr=class{};function t_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new cn(n.key,se.none()):new un(n.key,n.data,se.none());{let t=n.data,r=Ve.empty(),i=new J(_e.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new it(n.key,r,new Ge(i.toArray()),se.none())}}function r0(n,e,t){n instanceof un?function(i,s,o){let a=i.value.clone(),u=jy(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof it?function(i,s,o){if(!Na(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=jy(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(n_(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ts(n,e,t,r){return n instanceof un?function(s,o,a,u){if(!Na(s.precondition,o))return a;let c=s.value.clone(),l=qy(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof it?function(s,o,a,u){if(!Na(s.precondition,o))return a;let c=qy(s.fieldTransforms,u,o),l=o.data;return l.setAll(n_(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Na(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function i0(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=Xv(r.transform,i||null);s!=null&&(t===null&&(t=Ve.empty()),t.set(r.field,s))}return t||null}function Uy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&kr(r,i,(s,o)=>n0(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var un=class extends qr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},it=class extends qr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function n_(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function jy(n,e,t){let r=new Map;b(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,t0(o,a,t[i]))}return r}function qy(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,e0(s,o,e))}return r}var cn=class extends qr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ds=class extends qr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var xs=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&r0(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ts(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ts(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Qv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=t_(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(C.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&kr(this.mutations,e.mutations,(t,r)=>Uy(t,r))&&kr(this.baseMutations,e.baseMutations,(t,r)=>Uy(t,r))}},Ph=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){b(e.mutations.length===r.length);let i=function(){return XA}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Ns=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Dh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var fe,B;function r_(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function i_(n){if(n===void 0)return oe("GRPC error has no .code"),g.UNKNOWN;switch(n){case fe.OK:return g.OK;case fe.CANCELLED:return g.CANCELLED;case fe.UNKNOWN:return g.UNKNOWN;case fe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case fe.INTERNAL:return g.INTERNAL;case fe.UNAVAILABLE:return g.UNAVAILABLE;case fe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case fe.NOT_FOUND:return g.NOT_FOUND;case fe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case fe.ABORTED:return g.ABORTED;case fe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case fe.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(B=fe||(fe={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";var By=null;function s_(){return new TextEncoder}var s0=new Dn([4294967295,4294967295],0);function zy(n){let e=s_().encode(n),t=new Ey;return t.update(e),new Uint8Array(t.digest())}function $y(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Dn([t,r],0),new Dn([i,s],0)]}var xh=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ln(`Invalid padding: ${t}`);if(r<0)throw new Ln(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ln(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ln(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Dn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Dn.fromNumber(r)));return i.compare(s0)===1&&(i=new Dn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=zy(e),[r,i]=$y(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let t=zy(e),[r,i]=$y(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ln=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vs=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ms.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(C.min(),i,new ee(O),Ue(),L())}},Ms=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,L(),L(),L())}};var Vr=class{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}},Qa=class{constructor(e,t){this.targetId=e,this.fe=t}},Wa=class{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ha=class{constructor(){this.ge=0,this.pe=Ky(),this.ye=Ie.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=L(),t=L(),r=L();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new Ms(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Ky()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,b(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},Nh=class{constructor(e){this.Be=e,this.ke=new Map,this.qe=Ue(),this.Qe=Gy(),this.Ke=new ee(O)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){let t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){let s=i.target;if($a(s))if(r===0){let o=new A(s.path);this.We(t,o,ye.newNoDocument(o,C.min()))}else b(r===1);else{let o=this.Ze(t);if(o!==r){let a=this.Xe(e),u=a?this.et(a,e,o):1;if(u!==0){this.He(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}By?.tt(function(l,h,d,f,T){var w,y,R,N,M,F;let X={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},$=h.unchangedNames;return $&&(X.bloomFilter={applied:T===0,hashCount:(w=$?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(N=(R=(y=$?.bits)===null||y===void 0?void 0:y.bitmap)===null||R===void 0?void 0:R.length)!==null&&N!==void 0?N:0,padding:(F=(M=$?.bits)===null||M===void 0?void 0:M.padding)!==null&&F!==void 0?F:0,mightContain:le=>{var st;return(st=f?.mightContain(le))!==null&&st!==void 0&&st}}),X}(o,e.fe,this.Be.nt(),a,u))}}}}Xe(e){let t=e.fe.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=rn(r).toUint8Array()}catch(u){if(u instanceof qa)return wt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new xh(o,i,s)}catch(u){return wt(u instanceof Ln?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){let r=this.Be.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){let t=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&$a(a.target)){let u=new A(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,ye.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=L();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new Vs(e,t,this.Ke,this.qe,r);return this.qe=Ue(),this.Qe=Gy(),this.Ke=new ee(O),i}Ue(e,t){if(!this.je(e))return;let r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Ha,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new J(O),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Ha),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}};function Gy(){return new ee(A.comparator)}function Ky(){return new ee(A.comparator)}var o0={asc:"ASCENDING",desc:"DESCENDING"},a0={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},u0={and:"AND",or:"OR"},Vh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Mh(n,e){return n.useProto3Json||Qs(e)?e:{value:e}}function Br(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function o_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function c0(n,e){return Br(n,e.toTimestamp())}function ue(n){return b(!!n),C.fromTimestamp(function(t){let r=nn(t);return new ae(r.seconds,r.nanos)}(n))}function uf(n,e){return kh(n,e).canonicalString()}function kh(n,e){let t=function(i){return new z(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function a_(n){let e=z.fromString(n);return b(y_(e)),e}function ks(n,e){return uf(n.databaseId,e.path)}function vt(n,e){let t=a_(e);if(t.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new A(l_(t))}function u_(n,e){return uf(n.databaseId,e)}function c_(n){let e=a_(n);return e.length===4?z.emptyPath():l_(e)}function Oh(n){return new z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function l_(n){return b(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Qy(n,e,t){return{name:ks(n,e),fields:t.value.mapValue.fields}}function h_(n,e,t){let r=vt(n,e.name),i=ue(e.updateTime),s=e.createTime?ue(e.createTime):C.min(),o=new Ve({mapValue:{fields:e.fields}}),a=ye.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function l0(n,e){return"found"in e?function(r,i){b(!!i.found),i.found.name,i.found.updateTime;let s=vt(r,i.found.name),o=ue(i.found.updateTime),a=i.found.createTime?ue(i.found.createTime):C.min(),u=new Ve({mapValue:{fields:i.found.fields}});return ye.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){b(!!i.missing),b(!!i.readTime);let s=vt(r,i.missing),o=ue(i.readTime);return ye.newNoDocument(s,o)}(n,e):S()}function h0(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(b(l===void 0||typeof l=="string"),Ie.fromBase64String(l||"")):(b(l===void 0||l instanceof Uint8Array),Ie.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:i_(c.code);return new _(l,c.message||"")}(o);t=new Wa(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=vt(n,r.document.name),s=ue(r.document.updateTime),o=r.document.createTime?ue(r.document.createTime):C.min(),a=new Ve({mapValue:{fields:r.document.fields}}),u=ye.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new Vr(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=vt(n,r.document),s=r.readTime?ue(r.readTime):C.min(),o=ye.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Vr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=vt(n,r.document),s=r.removedTargetIds||[];t=new Vr([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Dh(i,s),a=r.targetId;t=new Qa(a,o)}}return t}function Os(n,e){let t;if(e instanceof un)t={update:Qy(n,e.key,e.value)};else if(e instanceof cn)t={delete:ks(n,e.key)};else if(e instanceof it)t={update:Qy(n,e.key,e.data),updateMask:y0(e.fieldMask)};else{if(!(e instanceof Ds))return S();t={verify:ks(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof on)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Vt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Mt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof an)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:c0(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,e.precondition)),t}function Lh(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?se.updateTime(ue(s.updateTime)):s.exists!==void 0?se.exists(s.exists):se.none()}(e.currentDocument):se.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)b(a.setToServerValue==="REQUEST_TIME"),u=new on;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Vt(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Mt(l)}else"increment"in a?u=new an(o,a.increment):S();let c=_e.fromServerFormat(a.fieldPath);return new zn(c,u)}(n,i)):[];if(e.update){e.update.name;let i=vt(n,e.update.name),s=new Ve({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Ge(c.map(l=>_e.fromServerFormat(l)))}(e.updateMask);return new it(i,s,o,t,r)}return new un(i,s,t,r)}if(e.delete){let i=vt(n,e.delete);return new cn(i,t)}if(e.verify){let i=vt(n,e.verify);return new Ds(i,t)}return S()}function d0(n,e){return n&&n.length>0?(b(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ue(i.updateTime):ue(s);return o.isEqual(C.min())&&(o=ue(s)),new Ch(o,i.transformResults||[])}(t,e))):[]}function d_(n,e){return{documents:[u_(n,e.path)]}}function f_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=u_(n,i);let s=function(c){if(c.length!==0)return m_(Y.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:br(d.field),direction:p0(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Mh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i}}function p_(n){let e=c_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){b(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=g_(h);return d instanceof Y&&sf(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(T){return new qn(Cr(T.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Qs(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new Et(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new Et(f,d)}(t.endAt)),qv(e,i,o,s,a,"F",u,c)}function f0(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function g_(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Cr(t.unaryFilter.field);return j.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Cr(t.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Cr(t.unaryFilter.field);return j.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Cr(t.unaryFilter.field);return j.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(t){return j.create(Cr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Y.create(t.compositeFilter.filters.map(r=>g_(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S()}function p0(n){return o0[n]}function g0(n){return a0[n]}function m0(n){return u0[n]}function br(n){return{fieldPath:n.canonicalString()}}function Cr(n){return _e.fromServerFormat(n.fieldPath)}function m_(n){return n instanceof j?function(t){if(t.op==="=="){if(Dy(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NAN"}};if(Py(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Dy(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NOT_NAN"}};if(Py(t.value))return{unaryFilter:{field:br(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:br(t.field),op:g0(t.op),value:t.value}}}(n):n instanceof Y?function(t){let r=t.getFilters().map(i=>m_(i));return r.length===1?r[0]:{compositeFilter:{op:m0(t.op),filters:r}}}(n):S()}function y0(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function y_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var zr=class n{constructor(e,t,r,i,s=C.min(),o=C.min(),a=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ya=class{constructor(e){this.ct=e}};function v0(n,e){let t;if(e.document)t=h_(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=A.fromSegments(e.noDocument.path),i=Gn(e.noDocument.readTime);t=ye.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{let r=A.fromSegments(e.unknownDocument.path),i=Gn(e.unknownDocument.version);t=ye.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ae(i[0],i[1]);return C.fromTimestamp(s)}(e.readTime)),t}function Wy(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Xa(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:ks(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Br(s,o.version.toTimestamp()),createTime:Br(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:$n(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:$n(e.version)}}return r}function Xa(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function $n(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Gn(n){let e=new ae(n.seconds,n.nanoseconds);return C.fromTimestamp(e)}function Mn(n,e){let t=(e.baseMutations||[]).map(s=>Lh(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Lh(n.ct,s)),i=ae.fromMillis(e.localWriteTimeMs);return new xs(e.batchId,i,t,r)}function vs(n){let e=Gn(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Gn(n.lastLimboFreeSnapshotVersion):C.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return b(s.documents.length===1),Le(ei(c_(s.documents[0])))}(n.query):function(s){return Le(p_(s))}(n.query),new zr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ie.fromBase64String(n.resumeToken))}function v_(n,e){let t=$n(e.snapshotVersion),r=$n(e.lastLimboFreeSnapshotVersion),i;i=$a(e.target)?d_(n.ct,e.target):f_(n.ct,e.target).ut;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Bn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function cf(n){let e=p_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ka(e,e.limit,"L"):e}function Jl(n,e){return new Ns(e.largestBatchId,Lh(n.ct,e.overlayMutation))}function Hy(n,e){let t=e.path.lastSegment();return[n,Oe(e.path.popLast()),t]}function Yy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:$n(r.readTime),documentKey:Oe(r.documentKey.path),largestBatchId:r.largestBatchId}}var Fh=class{getBundleMetadata(e,t){return Xy(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Gn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Xy(e).put(function(i){return{bundleId:i.id,createTime:$n(ue(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Jy(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:cf(s.bundledQuery),readTime:Gn(s.readTime)}}(r)})}saveNamedQuery(e,t){return Jy(e).put(function(i){return{name:i.name,readTime:$n(ue(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Xy(n){return Ae(n,"bundles")}function Jy(n){return Ae(n,"namedQueries")}var Ja=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return fs(e).get(Hy(this.userId,t)).next(r=>r?Jl(this.serializer,r):null)}getOverlays(e,t){let r=mt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Ns(t,o);i.push(this.ht(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Oe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(fs(e).H("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=mt(),s=Oe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return fs(e).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Jl(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=mt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fs(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Jl(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return fs(e).put(function(i,s,o){let[a,u,c]=Hy(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Os(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function fs(n){return Ae(n,"documentOverlays")}var Dt=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ie(e.integerValue));else if("doubleValue"in e){let r=ie(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Rs(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(rn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Mv(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):S()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),A.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};Dt.bt=new Dt;function _0(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Zy(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=_0(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Uh=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=Zy(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=Zy(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},jh=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},qh=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},kn=class{constructor(){this.Gt=new Uh,this.zt=new jh(this.Gt),this.jt=new qh(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var On=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Yt(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=ev(n.arrayValue,e.arrayValue),t!==0?t:(t=ev(n.directionalValue,e.directionalValue),t!==0?t:A.comparator(n.documentKey,e.documentKey)))}function ev(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Za=class{constructor(e){this.Yt=new J((t,r)=>_e.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(b(e.collectionGroup===this.collectionId),this.en)return!1;let t=ch(e);if(t!==void 0&&!this.nn(t))return!1;let r=Nn(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new J(_e.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new xr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new xr(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new xr(r.field,r.dir==="asc"?0:1)));return new Or(Or.UNKNOWN_ID,this.collectionId,t,As.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function __(n){var e,t;if(b(n instanceof j||n instanceof Y),n instanceof j){if(n instanceof za){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>j.create(n.field,"==",s)))||[];return Y.create(i,"or")}return n}let r=n.filters.map(i=>__(i));return Y.create(r,n.op)}function w0(n){if(n.getFilters().length===0)return[];let e=$h(__(n));return b(w_(e)),Bh(e)||zh(e)?[e]:e.getFilters()}function Bh(n){return n instanceof j}function zh(n){return n instanceof Y&&sf(n)}function w_(n){return Bh(n)||zh(n)||function(t){if(t instanceof Y&&yh(t)){for(let r of t.getFilters())if(!Bh(r)&&!zh(r))return!1;return!0}return!1}(n)}function $h(n){if(b(n instanceof j||n instanceof Y),n instanceof j)return n;if(n.filters.length===1)return $h(n.filters[0]);let e=n.filters.map(r=>$h(r)),t=Y.create(e,n.op);return t=eu(t),w_(t)?t:(b(t instanceof Y),b(Ur(t)),b(t.filters.length>1),t.filters.reduce((r,i)=>lf(r,i)))}function lf(n,e){let t;return b(n instanceof j||n instanceof Y),b(e instanceof j||e instanceof Y),t=n instanceof j?e instanceof j?function(i,s){return Y.create([i,s],"and")}(n,e):tv(n,e):e instanceof j?tv(e,n):function(i,s){if(b(i.filters.length>0&&s.filters.length>0),Ur(i)&&Ur(s))return Fv(i,s.getFilters());let o=yh(i)?i:s,a=yh(i)?s:i,u=o.filters.map(c=>lf(c,a));return Y.create(u,"or")}(n,e),eu(t)}function tv(n,e){if(Ur(e))return Fv(e,n.getFilters());{let t=e.filters.map(r=>lf(n,r));return Y.create(t,"or")}}function eu(n){if(b(n instanceof j||n instanceof Y),n instanceof j)return n;let e=n.getFilters();if(e.length===1)return eu(e[0]);if(Ov(n))return n;let t=e.map(i=>eu(i)),r=[];return t.forEach(i=>{i instanceof j?r.push(i):i instanceof Y&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Y.create(r,n.op)}var Gh=class{constructor(){this._n=new Ls}addToCollectionParentIndex(e,t){return this._n.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(Xe.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(Xe.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Ls=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new J(z.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new J(z.comparator)).toArray()}};var Ra=new Uint8Array(0),Kh=class{constructor(e,t){this.databaseId=t,this.an=new Ls,this.un=new It(r=>Bn(r),(r,i)=>Ws(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:Oe(i)};return nv(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[Av(t),""],!1,!0);return nv(e).W(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(gt(o.parent))}return r})}addFieldIndex(e,t){let r=ps(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ir(e);return s.next(a=>{o.put(Yy(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=ps(e),i=Ir(e),s=Er(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ps(e),r=Er(e),i=Ir(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return p.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Za(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Er(e),i=!0,s=new Map;return p.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=L(),a=[];return p.forEach(s,(u,c)=>{v("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(F=>`${F.fieldPath}:${F.kind}`).join(",")}`}(u)} to execute ${Bn(t)}`);let l=function(M,F){let X=ch(F);if(X===void 0)return null;for(let $ of Ga(M,X.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(c,u),h=function(M,F){let X=new Map;for(let $ of Nn(F))for(let le of Ga(M,$.fieldPath))switch(le.op){case"==":case"in":X.set($.fieldPath.canonicalString(),le.value);break;case"not-in":case"!=":return X.set($.fieldPath.canonicalString(),le.value),Array.from(X.values())}return null}(c,u),d=function(M,F){let X=[],$=!0;for(let le of Nn(F)){let st=le.kind===0?ky(M,le.fieldPath,M.startAt):Oy(M,le.fieldPath,M.startAt);X.push(st.value),$&&($=st.inclusive)}return new Et(X,$)}(c,u),f=function(M,F){let X=[],$=!0;for(let le of Nn(F)){let st=le.kind===0?Oy(M,le.fieldPath,M.endAt):ky(M,le.fieldPath,M.endAt);X.push(st.value),$&&($=st.inclusive)}return new Et(X,$)}(c,u),T=this.hn(u,c,d),w=this.hn(u,c,f),y=this.Pn(u,c,h),R=this.In(u.indexId,l,T,d.inclusive,w,f.inclusive,y);return p.forEach(R,N=>r.j(N,t.limit).next(M=>{M.forEach(F=>{let X=A.fromSegments(F.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return p.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=w0(Y.create(e.filters,"and")).map(r=>Sh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.Tn(t[h/c]):Ra,f=this.En(e,d,r[h%c],i),T=this.dn(e,d,s[h%c],o),w=a.map(y=>this.En(e,d,y,!0));l.push(...this.createRange(f,T,w))}return l}En(e,t,r,i){let s=new On(e,A.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new On(e,A.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new Za(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return p.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new J(_e.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new kn;for(let i of Nn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);Dt.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new kn;return Dt.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new kn;return Dt.bt.Pt(jn(this.databaseId,t),r.Ht(function(s){let o=Nn(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new kn);let s=0;for(let o of Nn(e)){let a=r[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&Ps(a))i=this.mn(i,o,a);else{let c=u.Ht(o.kind);Dt.bt.Pt(a,c)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new kn;u.seed(a.Wt()),Dt.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof j&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=ps(e),i=Ir(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new As(h.sequenceNumber,new Xe(Gn(h.readTime),new A(gt(h.documentKey)),h.largestBatchId)):As.empty(),f=l.fields.map(([T,w])=>new xr(_e.fromServerFormat(T),w));return new Or(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:O(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=ps(e),s=Ir(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(Yy(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.pn(e,i,u).next(c=>{let l=this.yn(s,u);return c.isEqual(l)?p.resolve():this.wn(e,s,u,c,l)}))))})}Sn(e,t,r,i){return Er(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return Er(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=Er(e),s=new J(Yt);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new On(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new J(Yt),i=this.An(t,e);if(i==null)return r;let s=ch(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ps(o))for(let a of o.arrayValue.values||[])r=r.add(new On(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new On(t.indexId,e.key,Ra,i));return r}wn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),T=c.getIterator(),w=Tr(f),y=Tr(T);for(;w||y;){let R=!1,N=!1;if(w&&y){let M=l(w,y);M<0?N=!0:M>0&&(R=!0)}else w!=null?N=!0:R=!0;R?(h(y),y=Tr(T)):N?(d(w),w=Tr(f)):(w=Tr(f),y=Tr(T))}}(i,s,Yt,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),p.waitFor(o)}gn(e){let t=1;return Ir(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Yt(o,a)).filter((o,a,u)=>!a||Yt(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Yt(o,e),u=Yt(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ra,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ra,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(e,t){return Yt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(rv)}getMinOffset(e,t){return p.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||S())).next(rv)}};function nv(n){return Ae(n,"collectionParents")}function Er(n){return Ae(n,"indexEntries")}function ps(n){return Ae(n,"indexConfiguration")}function Ir(n){return Ae(n,"indexState")}function rv(n){b(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;tf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Xe(e.readTime,e.documentKey,t)}var iv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ye=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function T_(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{b(a===1)}));let c=[];for(let l of t.mutations){let h=Pv(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function tu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}Ye.DEFAULT_COLLECTION_PERCENTILE=10,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ye.DEFAULT=new Ye(41943040,Ye.DEFAULT_COLLECTION_PERCENTILE,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ye.DISABLED=new Ye(-1,0,0);var nu=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){b(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xt(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Pr(e),o=Xt(e);return o.add({}).next(a=>{b(typeof a=="number");let u=new xs(a,t,r,i),c=function(f,T,w){let y=w.baseMutations.map(N=>Os(f.ct,N)),R=w.mutations.map(N=>Os(f.ct,N));return{userId:T,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:y,mutations:R}}(this.serializer,this.userId,u),l=[],h=new J((d,f)=>O(d.canonicalString(),f.canonicalString()));for(let d of i){let f=Pv(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,bA))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Xt(e).get(t).next(r=>r?(b(r.userId===this.userId),Mn(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?p.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Xt(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),s=Mn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Xt(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xt(e).W("userMutationsIndex",t).next(r=>r.map(i=>Mn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Pa(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Pr(e).Y({range:i},(o,a,u)=>{let[c,l,h]=o,d=gt(l);if(c===this.userId&&t.path.isEqual(d))return Xt(e).get(h).next(f=>{if(!f)throw S();b(f.userId===this.userId),s.push(Mn(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new J(O),i=[];return t.forEach(s=>{let o=Pa(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Pr(e).Y({range:a},(c,l,h)=>{let[d,f,T]=c,w=gt(f);d===this.userId&&s.path.isEqual(w)?r=r.add(T):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Pa(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new J(O);return Pr(e).Y({range:o},(u,c,l)=>{let[h,d,f]=u,T=gt(d);h===this.userId&&r.isPrefixOf(T)?T.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Xt(e).get(s).next(o=>{if(o===null)throw S();b(o.userId===this.userId),r.push(Mn(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return T_(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Pr(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=gt(s[1]);i.push(u)}else a.done()}).next(()=>{b(i.length===0)})})}containsKey(e,t){return E_(e,this.userId,t)}xn(e){return I_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function E_(n,e,t){let r=Pa(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Pr(n).Y({range:s,J:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Xt(n){return Ae(n,"mutations")}function Pr(n){return Ae(n,"documentMutations")}function I_(n){return Ae(n,"mutationQueues")}var $r=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var Qh=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new $r(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>C.fromTimestamp(new ae(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ar(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ar(e).Y((o,a)=>{let u=vs(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ar(e).Y((r,i)=>{let s=vs(i);t(s)})}Bn(e){return sv(e).get("targetGlobalKey").next(t=>(b(t!==null),t))}kn(e,t){return sv(e).put("targetGlobalKey",t)}qn(e,t){return Ar(e).put(v_(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Bn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ar(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=vs(a);Ws(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Jt(e);return t.forEach(o=>{let a=Oe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=Jt(e);return p.forEach(t,s=>{let o=Oe(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Jt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Jt(e),s=L();return i.Y({range:r,J:!0},(o,a,u)=>{let c=gt(o[1]),l=new A(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=Oe(t.path),i=IDBKeyRange.bound([r],[Av(r)],!1,!0),s=0;return Jt(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return Ar(e).get(t).next(r=>r?vs(r):null)}};function Ar(n){return Ae(n,"targets")}function sv(n){return Ae(n,"targetGlobal")}function Jt(n){return Ae(n,"targetDocuments")}function ov([n,e],[t,r]){let i=O(n,t);return i===0?O(e,r):i}var Wh=class{constructor(e){this.Kn=e,this.buffer=new J(ov),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();ov(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Hh=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){gn(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield pn(t)}yield this.zn(3e5)}))}},Yh=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve($e._e);let r=new Wh(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(iv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iv):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Rr()<=ct.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function T0(n,e){return new Yh(n,e)}var Xh=class{constructor(e,t){this.db=e,this.garbageCollector=T0(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Sa(e,r)}removeReference(e,t,r){return Sa(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Sa(e,t)}er(e,t){return function(i,s){let o=!1;return I_(i).Z(a=>E_(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,C.min()),Jt(e).delete(function(h){return[0,Oe(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Sa(e,t)}Xn(e,t){let r=Jt(e),i,s=$e._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==$e._e&&t(new A(gt(i)),s),s=c,i=u):s=$e._e}).next(()=>{s!==$e._e&&t(new A(gt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Sa(n,e){return Jt(n).put(function(r,i){return{targetId:0,path:Oe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var ru=class{constructor(){this.changes=new It(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ye.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Jh=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return xn(e).put(r)}removeEntry(e,t,r){return xn(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Xa(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=ye.newInvalidDocument(t);return xn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(gs(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:ye.newInvalidDocument(t)};return xn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(gs(t))},(i,s)=>{r={document:this.nr(t,s),size:tu(s)}}).next(()=>r)}getEntries(e,t){let r=Ue();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=Ue(),i=new ee(A.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,tu(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return p.resolve();let i=new J(cv);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(gs(i.first()),gs(i.last())),o=i.getIterator(),a=o.getNext();return xn(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=A.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&cv(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(gs(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Xa(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xn(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Ue();for(let h of c){let d=this.nr(A.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Ys(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Ue(),o=uv(t,r),a=uv(t,Xe.max());return xn(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.nr(A.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new Zh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return av(e).get("remoteDocumentGlobalKey").next(t=>(b(!!t),t))}tr(e,t){return av(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=v0(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(C.min())))return r}return ye.newInvalidDocument(e)}};function A_(n){return new Jh(n)}var Zh=class extends ru{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new It(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new J((s,o)=>O(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=Wy(this.ar.serializer,o);i=i.add(s.path.popLast());let c=tu(u);r+=c-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=Wy(this.ar.serializer,o.convertToNoDocument(C.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function av(n){return Ae(n,"remoteDocumentGlobal")}function xn(n){return Ae(n,"remoteDocumentsV14")}function gs(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function uv(n,e){let t=e.documentKey.path.toArray();return[n,Xa(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function cv(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=O(t[s],r[s]),i)return i;return i=O(t.length,r.length),i||(i=O(t[t.length-2],r[r.length-2]),i||O(t[t.length-1],r[r.length-1]))}var ed=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var iu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ts(r.mutation,i,Ge.empty(),ae.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,L()).next(()=>r))}getLocalViewOfDocuments(e,t,r=L()){let i=mt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ys();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=mt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ue(),o=ws(),a=function(){return ws()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof it)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),Ts(l.mutation,c,l.mutation.getFieldMask(),ae.now())):o.set(c.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new ed(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ws(),i=new ee((o,a)=>o-a),s=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||Ge.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||L()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=Qv();l.forEach(d=>{if(!s.has(d)){let f=t_(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return A.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):of(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(mt()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,L())).next(l=>({batchId:a,changes:Kv(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new A(t)).next(r=>{let i=ys();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=ys();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new rt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,ye.newInvalidDocument(l)))});let a=ys();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&Ts(l.mutation,c,Ge.empty(),ae.now()),Ys(t,c)&&(a=a.insert(u,c))}),a})}};var td=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return p.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ue(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:cf(i.bundledQuery),readTime:ue(i.readTime)}}(t)),p.resolve()}};var nd=class{constructor(){this.overlays=new ee(A.comparator),this.hr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=mt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=mt(),s=t.length+1,o=new A(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ee((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=mt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=mt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ns(t,r));let s=this.hr.get(t);s===void 0&&(s=L(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var Fs=class{constructor(){this.Pr=new J(pe.Ir),this.Tr=new J(pe.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new pe(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new pe(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new A(new z([])),r=new pe(t,e),i=new pe(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new A(new z([])),r=new pe(t,e),i=new pe(t,e+1),s=L();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new pe(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},pe=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return A.comparator(e.key,t.key)||O(e.pr,t.pr)}static Er(e,t){return O(e.pr,t.pr)||A.comparator(e.key,t.key)}};var rd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new J(pe.Ir)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new xs(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new pe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new pe(t,0),i=new pe(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new J(O);return t.forEach(i=>{let s=new pe(i,0),o=new pe(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),p.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;A.isDocumentKey(s)||(s=s.child(""));let o=new pe(new A(s),0),a=new J(O);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),p.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){b(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return p.forEach(t.mutations,i=>{let s=new pe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new pe(t,0),i=this.wr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var id=class{constructor(e){this.vr=e,this.docs=function(){return new ee(A.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():ye.newInvalidDocument(t))}getEntries(e,t){let r=Ue();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ye.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ue(),o=t.path,a=new A(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||tf(Sv(l),r)<=0||(i.has(l.key)||Ys(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}Fr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new sd(this)}getSize(e){return p.resolve(this.size)}},sd=class extends ru{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var od=class{constructor(e){this.persistence=e,this.Mr=new It(t=>Bn(t),Ws),this.lastRemoteSnapshotVersion=C.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Fs,this.targetCount=0,this.Lr=$r.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),p.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new $r(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.qn(t),p.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Nr.containsKey(t))}};var su=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new $e(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new od(this),this.indexManager=new Gh,this.remoteDocumentCache=function(i){return new id(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Ya(t),this.$r=new td(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new rd(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new ad(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return p.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},ad=class extends Fa{constructor(e){super(),this.currentSequenceNumber=e}},ou=class n{constructor(e){this.persistence=e,this.zr=new Fs,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),p.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Jr,r=>{let i=A.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,C.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return p.or([()=>p.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var ud=class{constructor(e){this.serializer=e}N(e,t,r,i){let s=new Ua("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sy,{unique:!0}),u.createObjectStore("documentMutations")}(e),lv(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),lv(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:C.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sy,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:UA});c.createIndex("collectionPathOverlayIndex",jA,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",qA,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:CA});c.createIndex("documentKeyIndex",PA),c.createIndex("collectionGroupIndex",DA)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:kA}).createIndex("sequenceNumberIndex",OA,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:LA}).createIndex("documentKeyIndex",FA,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=tu(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>p.forEach(a,u=>{b(u.userId===s.userId);let c=Mn(this.serializer,u);return T_(e,s.userId,c).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new z(o),c=function(h){return[0,Oe(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:Oe(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:MA});let r=t.store("collectionParents"),i=new Ls,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Oe(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new z(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=gt(a);return s(l.popLast())}))}ri(e){let t=e.store("targets");return t.Y((r,i)=>{let s=vs(i),o=v_(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new A(z.fromString(h.document.name).popFirst(5)):h.noDocument?A.fromSegments(h.noDocument.path):h.unknownDocument?A.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}si(e,t){let r=t.store("mutations"),i=A_(this.serializer),s=new su(ou.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:L();Mn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new ge(c),h=Ja.lt(this.serializer,l),d=s.getIndexManager(l),f=nu.lt(l,this.serializer,d,s.referenceDelegate);return new iu(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Ss(t,$e._e),u).next()})})}};function lv(n){n.createObjectStore("targetDocuments",{keyPath:NA}).createIndex("documentTargetsIndex",VA,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",xA,{unique:!0}),n.createObjectStore("targetGlobal")}var Zl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cd=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xh(this,i),this.Ti=t+"main",this.serializer=new Ya(u),this.Ei=new Nt(this.Ti,this.ui,new ud(this.serializer)),this.Qr=new Qh(this.referenceDelegate,this.serializer),this.remoteDocumentCache=A_(this.serializer),this.$r=new Fh,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&oe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Zl);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new $e(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ba(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(gn(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return ms(e).get("owner").next(t=>p.resolve(this.Si(t)))}bi(e){return ba(e).delete(this.clientId)}Di(){return m(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ae(t,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?p.resolve(!0):ms(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Zl);return!1}}return!(!this.networkEnabled||!this.inForeground)||ba(e).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return m(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ss(e,$e._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>ba(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return nu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Kh(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ja.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===15?zA:u===14?Nv:u===13?xv:u===12?BA:u===11?Dv:void S()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new Ss(a,this.kr?this.kr.next():$e._e),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new _(g.FAILED_PRECONDITION,bv);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return ms(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,Zl)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ms(e).put("owner",t)}static D(){return Nt.D()}yi(e){let t=ms(e);return t.get("owner").next(r=>this.Si(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(oe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;oc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return oe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){oe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function ms(n){return Ae(n,"owner")}function ba(n){return Ae(n,"clientMetadata")}function hf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var ld=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=L(),i=L();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var hd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var au=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return oc()?8:Nt.v(pi())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new hd;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Rr()<=ct.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),p.resolve()):(Rr()<=ct.DEBUG&&v("QueryEngine","Query:",Sr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Rr()<=ct.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Le(t))):p.resolve())}ji(e,t){if(Ly(t))return p.resolve(null);let r=Le(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ka(t,null,"F"),r=Le(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=L(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,Ka(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return Ly(t)||i.isEqual(C.min())?p.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?p.resolve(null):(Rr()<=ct.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sr(t)),this.es(e,o,t,Rv(i,-1)).next(a=>a))})}Zi(e,t){let r=new J($v(e));return t.forEach((i,s)=>{Ys(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Rr()<=ct.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.zi.getDocumentsMatchingQuery(e,t,Xe.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var dd=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ee(O),this.rs=new It(s=>Bn(s),Ws),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new iu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function R_(n,e,t,r){return new dd(n,e,t,r)}function S_(n,e){return m(this,null,function*(){let t=E(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=L();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function E0(n,e){let t=E(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(T=>{f=f.next(()=>l.getEntry(u,T)).next(w=>{let y=c.docVersions.get(T);b(y!==null),w.version.compareTo(y)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=L();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function b_(n){let e=E(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function I0(n,e){let t=E(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Ie.EMPTY_BYTE_STRING,C.min()).withLastLimboFreeSnapshotVersion(C.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,y,R){return w.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}(d,f,l)&&a.push(t.Qr.updateTargetData(s,f))});let u=Ue(),c=L();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(C_(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(C.min())){let l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}function C_(n,e,t){let r=L(),i=L();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ue();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(C.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function A0(n,e){let t=E(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Gr(n,e){let t=E(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new zr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Kr(n,e,t){return m(this,null,function*(){let r=E(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!gn(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function uu(n,e,t){let r=E(n),i=C.min(),s=L();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=E(u),d=h.rs.get(l);return d!==void 0?p.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,Le(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:C.min(),t?s:L())).next(a=>(x_(r,zv(e),a),{documents:a,hs:s})))}function P_(n,e){let t=E(n),r=E(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function D_(n,e){let t=E(n),r=t.ss.get(e)||C.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,Rv(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(x_(t,e,i),i))}function x_(n,e,t){let r=n.ss.get(e)||C.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function R0(n,e,t,r){return m(this,null,function*(){let i=E(n),s=L(),o=Ue();for(let c of t){let l=e.Ps(c.metadata.name);c.document&&(s=s.add(l));let h=e.Is(c);h.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(l,h)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Gr(i,function(l){return Le(ei(z.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>C_(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function S0(r,i){return m(this,arguments,function*(n,e,t=L()){let s=yield Gr(n,Le(cf(e.bundledQuery))),o=E(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ue(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,e);let c=s.withResumeToken(Ie.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function hv(n,e){return`firestore_clients_${n}_${e}`}function dv(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function eh(n,e){return`firestore_targets_${n}_${e}`}var cu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new _(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(oe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Es=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new _(r.error.code,r.error.message))),s?new n(e,r.state,i):(oe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},lu=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=af();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Cv(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(oe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},fd=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(oe("SharedClientState",`Failed to parse online state: ${e}`),null)}},Us=class{constructor(){this.activeTargetIds=af()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Is=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ee(O),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=hv(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Us),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(hv(this.persistenceKey,r));if(i){let s=lu.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(eh(this.persistenceKey,e));if(r){let i=Es.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(eh(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>m(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=$e._e;if(s!=null)try{let a=JSON.parse(s);b(typeof a=="number"),o=a}catch(a){oe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==$e._e&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new cu(this.currentUser,e,t,r),s=dv(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=dv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=eh(this.persistenceKey,e),s=new Es(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return lu.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return cu.Es(new ge(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return Es.Es(i,t)}xs(e){return fd.Es(e)}Js(e){return JSON.parse(e)}zs(e){return m(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=af();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},hu=class{constructor(){this.no=new Us,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Us,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var pd=class{io(e){}shutdown(){}};var du=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ca=null;function th(){return Ca===null?Ca=function(){return 268435456+Math.round(2147483648*Math.random())}():Ca++,"0x"+Ca.toString(16)}var b0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var gd=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var Ne="WebChannelConnection",md=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){let a=th(),u=this.bo(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw wt("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Zr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){let i=b0[t];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){let s=th();return new Promise((o,a)=>{let u=new Ty;u.setWithCredentials(!0),u.listenOnce(_y.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Aa.NO_ERROR:let l=u.getResponseJson();v(Ne,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Aa.TIMEOUT:v(Ne,`RPC '${e}' ${s} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case Aa.HTTP_ERROR:let h=u.getStatus();if(v(Ne,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let T=function(y){let R=y.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(R)>=0?R:g.UNKNOWN}(f.status);a(new _(T,f.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(Ne,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);v(Ne,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){let i=th(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=yy(),a=vy(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");v(Ne,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,T=new gd({lo:y=>{f?v(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,y):(d||(v(Ne,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(Ne,`RPC '${e}' stream ${i} sending:`,y),h.send(y))},ho:()=>h.close()}),w=(y,R,N)=>{y.listen(R,M=>{try{N(M)}catch(F){setTimeout(()=>{throw F},0)}})};return w(h,ds.EventType.OPEN,()=>{f||v(Ne,`RPC '${e}' stream ${i} transport opened.`)}),w(h,ds.EventType.CLOSE,()=>{f||(f=!0,v(Ne,`RPC '${e}' stream ${i} transport closed`),T.Vo())}),w(h,ds.EventType.ERROR,y=>{f||(f=!0,wt(Ne,`RPC '${e}' stream ${i} transport errored:`,y),T.Vo(new _(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,ds.EventType.MESSAGE,y=>{var R;if(!f){let N=y.data[0];b(!!N);let M=N,F=M.error||((R=M[0])===null||R===void 0?void 0:R.error);if(F){v(Ne,`RPC '${e}' stream ${i} received error:`,F);let X=F.status,$=function(uw){let Nf=fe[uw];if(Nf!==void 0)return i_(Nf)}(X),le=F.message;$===void 0&&($=g.INTERNAL,le="Unknown error status: "+X+" with message "+F.message),f=!0,T.Vo(new _($,le)),h.close()}else v(Ne,`RPC '${e}' stream ${i} received:`,N),T.mo(N)}}),w(a,wy.STAT_EVENT,y=>{y.stat===Xl.PROXY?v(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):y.stat===Xl.NOPROXY&&v(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{T.Ro()},0),T}};function N_(){return typeof window<"u"?window:null}function Va(){return typeof document<"u"?document:null}function Xs(n){return new Vh(n,!0)}var js=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var fu=class{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new js(e,t)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return m(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return m(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){return m(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(oe(t.toString()),oe("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(t)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{let i=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){let r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>m(this,null,function*(){this.state=0,this.start()}))}__(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},yd=class extends fu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=h0(this.serializer,e),r=function(s){if(!("targetChange"in s))return C.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?C.min():o.readTime?ue(o.readTime):C.min()}(e);return this.listener.u_(t,r)}c_(e){let t={};t.database=Oh(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=$a(u)?{documents:d_(s,u)}:{query:f_(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=o_(s,o.resumeToken);let c=Mh(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(C.min())>0){a.readTime=Br(s,o.snapshotVersion.toTimestamp());let c=Mh(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=f0(this.serializer,e);r&&(t.labels=r),this.t_(t)}l_(e){let t={};t.database=Oh(this.serializer),t.removeTarget=e,this.t_(t)}},vd=class extends fu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let t=d0(e.writeResults,e.commitTime),r=ue(e.commitTime);return this.listener.T_(r,t)}return b(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=Oh(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Os(this.serializer,r))};this.t_(t)}};var _d=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,kh(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,kh(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var wd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(oe(t),this.g_=!1):v("OnlineStateTracker",t)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Td=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>m(this,null,function*(){mn(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(u){return m(this,null,function*(){let c=E(u);c.v_.add(4),yield ti(c),c.x_.set("Unknown"),c.v_.delete(4),yield Js(c)})}(this))}))}),this.x_=new wd(r,i)}};function Js(n){return m(this,null,function*(){if(mn(n))for(let e of n.F_)yield e(!0)})}function ti(n){return m(this,null,function*(){for(let e of n.F_)yield e(!1)})}function Nu(n,e){let t=E(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),pf(t)?ff(t):ri(t).Jo()&&df(t,e))}function Qr(n,e){let t=E(n),r=ri(t);t.C_.delete(e),r.Jo()&&V_(t,e),t.C_.size===0&&(r.Jo()?r.Xo():mn(t)&&t.x_.set("Unknown"))}function df(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(C.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ri(n).c_(e)}function V_(n,e){n.O_.Oe(e),ri(n).l_(e)}function ff(n){n.O_=new Nh({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),ri(n).start(),n.x_.p_()}function pf(n){return mn(n)&&!ri(n).Ho()&&n.C_.size>0}function mn(n){return E(n).v_.size===0}function M_(n){n.O_=void 0}function C0(n){return m(this,null,function*(){n.C_.forEach((e,t)=>{df(n,e)})})}function P0(n,e){return m(this,null,function*(){M_(n),pf(n)?(n.x_.S_(e),ff(n)):n.x_.set("Unknown")})}function D0(n,e,t){return m(this,null,function*(){if(n.x_.set("Online"),e instanceof Wa&&e.state===2&&e.cause)try{yield function(i,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield pu(n,r)}else if(e instanceof Vr?n.O_.$e(e):e instanceof Qa?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(C.min()))try{let r=yield b_(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(Ie.EMPTY_BYTE_STRING,l.snapshotVersion)),V_(s,u);let h=new zr(l.target,u,c,l.sequenceNumber);df(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield pu(n,r)}})}function pu(n,e,t){return m(this,null,function*(){if(!gn(e))throw e;n.v_.add(1),yield ti(n),n.x_.set("Offline"),t||(t=()=>b_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield Js(n)}))})}function k_(n,e){return e().catch(t=>pu(n,t,e))}function ni(n){return m(this,null,function*(){let e=E(n),t=ln(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;x0(e);)try{let i=yield A0(e.localStore,r);if(i===null){e.D_.length===0&&t.Xo();break}r=i.batchId,N0(e,i)}catch(i){yield pu(e,i)}O_(e)&&L_(e)})}function x0(n){return mn(n)&&n.D_.length<10}function N0(n,e){n.D_.push(e);let t=ln(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function O_(n){return mn(n)&&!ln(n).Ho()&&n.D_.length>0}function L_(n){ln(n).start()}function V0(n){return m(this,null,function*(){ln(n).d_()})}function M0(n){return m(this,null,function*(){let e=ln(n);for(let t of n.D_)e.I_(t.mutations)})}function k0(n,e,t){return m(this,null,function*(){let r=n.D_.shift(),i=Ph.from(r,e,t);yield k_(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ni(n)})}function O0(n,e){return m(this,null,function*(){e&&ln(n).P_&&(yield function(r,i){return m(this,null,function*(){if(function(o){return r_(o)&&o!==g.ABORTED}(i.code)){let s=r.D_.shift();ln(r).Zo(),yield k_(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield ni(r)}})}(n,e)),O_(n)&&L_(n)})}function fv(n,e){return m(this,null,function*(){let t=E(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=mn(t);t.v_.add(3),yield ti(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield Js(t)})}function Ed(n,e){return m(this,null,function*(){let t=E(n);e?(t.v_.delete(2),yield Js(t)):e||(t.v_.add(2),yield ti(t),t.x_.set("Unknown"))})}function ri(n){return n.N_||(n.N_=function(t,r,i){let s=E(t);return s.R_(),new yd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:C0.bind(null,n),To:P0.bind(null,n),u_:D0.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.N_.Zo(),pf(n)?ff(n):n.x_.set("Unknown")):(yield n.N_.stop(),M_(n))}))),n.N_}function ln(n){return n.L_||(n.L_=function(t,r,i){let s=E(t);return s.R_(),new vd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:V0.bind(null,n),To:O0.bind(null,n),E_:M0.bind(null,n),T_:k0.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.L_.Zo(),yield ni(n)):(yield n.L_.stop(),n.D_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var Id=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new me,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ii(n,e){if(oe("AsyncQueue",`${e}: ${n}`),gn(n))return new _(g.UNAVAILABLE,`${e}: ${n}`);throw n}var gu=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||A.comparator(t.key,r.key):(t,r)=>A.comparator(t.key,r.key),this.keyedMap=ys(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var mu=class{constructor(){this.B_=new ee(A.comparator)}track(e){let t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):S():this.B_=this.B_.insert(t,e)}k_(){let e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}},Wr=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,gu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Hs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Ad=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}},Rd=class{constructor(){this.queries=new It(e=>Bv(e),Hs),this.onlineState="Unknown",this.W_=new Set}};function gf(n,e){return m(this,null,function*(){let t=E(n),r=3,i=e.query,s=t.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Ad,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield t.onListen(i,!0);break;case 1:s.q_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=ii(o,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Q_.push(e),e.G_(t.onlineState),s.q_&&e.z_(s.q_)&&yf(t)})}function mf(n,e){return m(this,null,function*(){let t=E(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function L0(n,e){let t=E(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&yf(t)}function F0(n,e,t){let r=E(n),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(t);r.queries.delete(e)}function yf(n){n.W_.forEach(e=>{e.next()})}var Sd,pv;(pv=Sd||(Sd={})).j_="default",pv.Cache="cache";var qs=class{constructor(e,t,r){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Wr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache||!this.U_())return!0;let r=t!=="Offline";return(!this.options.ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Z_(e){if(e.docChanges.length>0)return!0;let t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ea(e){e=Wr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Sd.Cache}};var bd=class{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}};var yu=class{constructor(e){this.serializer=e}Ps(e){return vt(this.serializer,e)}Is(e){return e.metadata.exists?h_(this.serializer,e.document,!1):ye.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return ue(e)}},Cd=class{constructor(e,t,r){this.ia=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=F_(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;let r=z.fromString(e.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){let t=new Map,r=new yu(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||L()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield R0(this.localStore,new yu(this.serializer),this.documents,this.ia.id),t=this.oa(this.documents);for(let r of this.queries)yield S0(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:e}})}};function F_(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var vu=class{constructor(e){this.key=e}},_u=class{constructor(e){this.key=e}},wu=class{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=L(),this.mutatedKeys=L(),this.ha=$v(e),this.Pa=new gu(this.ha)}get Ia(){return this.ua}Ta(e,t){let r=t?t.Ea:new mu,i=t?t.Pa:this.Pa,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=Ys(this.query,h)?h:null,T=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),y=!1;d&&f?d.data.isEqual(f.data)?T!==w&&(r.track({type:3,doc:f}),y=!0):this.da(d,f)||(r.track({type:2,doc:f}),y=!0,(u&&this.ha(f,u)>0||c&&this.ha(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),y=!0):d&&!f&&(r.track({type:1,doc:d}),y=!0,(u||c)&&(a=!0)),y&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;let o=e.Ea.k_();o.sort((l,h)=>function(f,T){let w=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(f)-w(T)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=i!=null&&i;let a=t&&!i?this.Ra():[],u=this.la.size===0&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new Wr(this.query,e.Pa,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new mu,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(t=>this.ua=this.ua.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ua=this.ua.delete(t)),this.current=e.current)}Ra(){if(!this.current)return[];let e=this.la;this.la=L(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let t=[];return e.forEach(r=>{this.la.has(r)||t.push(new _u(r))}),this.la.forEach(r=>{e.has(r)||t.push(new vu(r))}),t}fa(e){this.ua=e.hs,this.la=L();let t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Wr.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},Pd=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Dd=class{constructor(e){this.key=e,this.pa=!1}},xd=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new It(a=>Bv(a),Hs),this.Sa=new Map,this.ba=new Set,this.Da=new ee(A.comparator),this.Ca=new Map,this.va=new Fs,this.Fa={},this.Ma=new Map,this.xa=$r.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function U0(n,e,t=!0){return m(this,null,function*(){let r=Vu(n),i,s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield U_(r,e,t,!0),i})}function j0(n,e){return m(this,null,function*(){let t=Vu(n);yield U_(t,e,!0,!1)})}function U_(n,e,t,r){return m(this,null,function*(){let i=yield Gr(n.localStore,Le(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield vf(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Nu(n.remoteStore,i),a})}function vf(n,e,t,r,i){return m(this,null,function*(){n.Na=(h,d,f)=>function(w,y,R,N){return m(this,null,function*(){let M=y.view.Ta(R);M.Xi&&(M=yield uu(w.localStore,y.query,!1).then(({documents:le})=>y.view.Ta(le,M)));let F=N&&N.targetChanges.get(y.targetId),X=N&&N.targetMismatches.get(y.targetId)!=null,$=y.view.applyChanges(M,w.isPrimaryClient,F,X);return Nd(w,y.targetId,$.Va),$.snapshot})}(n,h,d,f);let s=yield uu(n.localStore,e,!0),o=new wu(e,s.hs),a=o.Ta(s.documents),u=Ms.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Nd(n,t,c.Va);let l=new Pd(e,t,o);return n.wa.set(e,l),n.Sa.has(t)?n.Sa.get(t).push(e):n.Sa.set(t,[e]),c.snapshot})}function q0(n,e,t){return m(this,null,function*(){let r=E(n),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Hs(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Kr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Qr(r.remoteStore,i.targetId),Hr(r,i.targetId)}).catch(pn))):(Hr(r,i.targetId),yield Kr(r.localStore,i.targetId,!0))})}function B0(n,e){return m(this,null,function*(){let t=E(n),r=t.wa.get(e),i=t.Sa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Qr(t.remoteStore,r.targetId))})}function z0(n,e,t){return m(this,null,function*(){let r=Ef(n);try{let i=yield function(o,a){let u=E(o),c=ae.now(),l=a.reduce((f,T)=>f.add(T.key),L()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let T=Ue(),w=L();return u.os.getEntries(f,l).next(y=>{T=y,T.forEach((R,N)=>{N.isValidDocument()||(w=w.add(R))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,T)).next(y=>{h=y;let R=[];for(let N of a){let M=i0(N,h.get(N.key).overlayedDocument);M!=null&&R.push(new it(N.key,M,kv(M.value.mapValue),se.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,R,a)}).next(y=>{d=y;let R=y.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,y.batchId,R)})}).then(()=>({batchId:d.batchId,changes:Kv(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new ee(O)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Lt(r,i.changes),yield ni(r.remoteStore)}catch(i){let s=ii(i,"Failed to persist write");t.reject(s)}})}function j_(n,e){return m(this,null,function*(){let t=E(n);try{let r=yield I0(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Ca.get(s);o&&(b(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?b(o.pa):i.removedDocuments.size>0&&(b(o.pa),o.pa=!1))}),yield Lt(t,r,e)}catch(r){yield pn(r)}})}function gv(n,e,t){let r=E(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=E(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(c=!0)}),c&&yf(u)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $0(n,e,t){return m(this,null,function*(){let r=E(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Ca.get(e),s=i&&i.key;if(s){let o=new ee(A.comparator);o=o.insert(s,ye.newNoDocument(s,C.min()));let a=L().add(s),u=new Vs(C.min(),new Map,new ee(O),o,a);yield j_(r,u),r.Da=r.Da.remove(s),r.Ca.delete(e),Tf(r)}else yield Kr(r.localStore,e,!1).then(()=>Hr(r,e,t)).catch(pn)})}function G0(n,e){return m(this,null,function*(){let t=E(n),r=e.batch.batchId;try{let i=yield E0(t.localStore,e);wf(t,r,null),_f(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Lt(t,i)}catch(i){yield pn(i)}})}function K0(n,e,t){return m(this,null,function*(){let r=E(n);try{let i=yield function(o,a){let u=E(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(b(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);wf(r,e,t),_f(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Lt(r,i)}catch(i){yield pn(i)}})}function Q0(n,e){return m(this,null,function*(){let t=E(n);mn(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=E(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Ma.get(r)||[];i.push(e),t.Ma.set(r,i)}catch(r){let i=ii(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function _f(n,e){(n.Ma.get(e)||[]).forEach(t=>{t.resolve()}),n.Ma.delete(e)}function wf(n,e,t){let r=E(n),i=r.Fa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function Hr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Sa.get(e))n.wa.delete(r),t&&n.ya.La(r,t);n.Sa.delete(e),n.isPrimaryClient&&n.va.Vr(e).forEach(r=>{n.va.containsKey(r)||q_(n,r)})}function q_(n,e){n.ba.delete(e.path.canonicalString());let t=n.Da.get(e);t!==null&&(Qr(n.remoteStore,t),n.Da=n.Da.remove(e),n.Ca.delete(t),Tf(n))}function Nd(n,e,t){for(let r of t)r instanceof vu?(n.va.addReference(r.key,e),W0(n,r)):r instanceof _u?(v("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,e),n.va.containsKey(r.key)||q_(n,r.key)):S()}function W0(n,e){let t=e.key,r=t.path.canonicalString();n.Da.get(t)||n.ba.has(r)||(v("SyncEngine","New document in limbo: "+t),n.ba.add(r),Tf(n))}function Tf(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let e=n.ba.values().next().value;n.ba.delete(e);let t=new A(z.fromString(e)),r=n.xa.next();n.Ca.set(r,new Dd(t)),n.Da=n.Da.insert(t,r),Nu(n.remoteStore,new zr(Le(ei(t.path)),r,"TargetPurposeLimboResolution",$e._e))}}function Lt(n,e,t){return m(this,null,function*(){let r=E(n),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=ld.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(u,c){return m(this,null,function*(){let l=E(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!gn(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),T=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(T);l.ns=l.ns.insert(d,w)}}})}(r.localStore,s))})}function H0(n,e){return m(this,null,function*(){let t=E(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield S_(t.localStore,e);t.currentUser=e,function(s,o){s.Ma.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,o))})}),s.Ma.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Lt(t,r.us)}})}function Y0(n,e){let t=E(n),r=t.Ca.get(e);if(r&&r.pa)return L().add(r.key);{let i=L(),s=t.Sa.get(e);if(!s)return i;for(let o of s){let a=t.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function X0(n,e){return m(this,null,function*(){let t=E(n),r=yield uu(t.localStore,e.query,!0),i=e.view.fa(r);return t.isPrimaryClient&&Nd(t,e.targetId,i.Va),i})}function J0(n,e){return m(this,null,function*(){let t=E(n);return D_(t.localStore,e).then(r=>Lt(t,r))})}function Z0(n,e,t,r){return m(this,null,function*(){let i=E(n),s=yield function(a,u){let c=E(a),l=E(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield ni(i.remoteStore):t==="acknowledged"||t==="rejected"?(wf(i,e,r||null),_f(i,e),function(a,u){E(E(a).mutationQueue).Mn(u)}(i.localStore,e)):S(),yield Lt(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function eR(n,e){return m(this,null,function*(){let t=E(n);if(Vu(t),Ef(t),e===!0&&t.Oa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield mv(t,r.toArray());t.Oa=!0,yield Ed(t.remoteStore,!0);for(let s of i)Nu(t.remoteStore,s)}else if(e===!1&&t.Oa!==!1){let r=[],i=Promise.resolve();t.Sa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Hr(t,o),Kr(t.localStore,o,!0))),Qr(t.remoteStore,o)}),yield i,yield mv(t,r),function(o){let a=E(o);a.Ca.forEach((u,c)=>{Qr(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new ee(A.comparator)}(t),t.Oa=!1,yield Ed(t.remoteStore,!1)}})}function mv(n,e,t){return m(this,null,function*(){let r=E(n),i=[],s=[];for(let o of e){let a,u=r.Sa.get(o);if(u&&u.length!==0){a=yield Gr(r.localStore,Le(u[0]));for(let c of u){let l=r.wa.get(c),h=yield X0(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield P_(r.localStore,o);a=yield Gr(r.localStore,c),yield vf(r,B_(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i})}function B_(n){return qv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function tR(n){return function(t){return E(E(t).persistence).Bi()}(E(n).localStore)}function nR(n,e,t,r){return m(this,null,function*(){let i=E(n);if(i.Oa)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.Sa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield D_(i.localStore,zv(s[0])),a=Vs.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ie.EMPTY_BYTE_STRING);yield Lt(i,o,a);break}case"rejected":yield Kr(i.localStore,e,!0),Hr(i,e,r);break;default:S()}})}function rR(n,e,t){return m(this,null,function*(){let r=Vu(n);if(r.Oa){for(let i of e){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield P_(r.localStore,i),o=yield Gr(r.localStore,s);yield vf(r,B_(s),o.targetId,!1,o.resumeToken),Nu(r.remoteStore,o)}for(let i of t)r.Sa.has(i)&&(yield Kr(r.localStore,i,!1).then(()=>{Qr(r.remoteStore,i),Hr(r,i)}).catch(pn))}})}function Vu(n){let e=E(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=j_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Y0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$0.bind(null,e),e.ya.u_=L0.bind(null,e.eventManager),e.ya.La=F0.bind(null,e.eventManager),e}function Ef(n){let e=E(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=G0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=K0.bind(null,e),e}function iR(n,e,t){let r=E(n);(function(s,o,a){return m(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,T){let w=E(f),y=ue(T.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",R=>w.$r.getBundleMetadata(R,T.id)).then(R=>!!R&&R.createTime.compareTo(y)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(F_(u));let c=new Cd(u,s.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield c.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield c.complete();return yield Lt(s,h.aa,void 0),yield function(f,T){let w=E(f);return w.persistence.runTransaction("Save bundle","readwrite",y=>w.$r.saveBundleMetadata(y,T))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h._a)}catch(u){return wt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Bs=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=Xs(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return R_(this.persistence,new au,e.initialUser,this.serializer)}createPersistence(e){return new su(ou.Hr,this.serializer)}createSharedClientState(e){return new hu}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Tu=class n extends Bs{constructor(e,t,r){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield ju(n.prototype,this,"initialize").call(this,e),yield this.ka.initialize(this,e),yield Ef(this.ka.syncEngine),yield ni(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return R_(this.persistence,new au,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Hh(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new fh(t,this.persistence);return new dh(e.asyncQueue,r)}createPersistence(e){let t=hf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new cd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,N_(),Va(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new hu}},Vd=class n extends Tu{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield ju(n.prototype,this,"initialize").call(this,e);let t=this.ka.syncEngine;this.sharedClientState instanceof Is&&(this.sharedClientState.syncEngine={Zs:Z0.bind(null,t),Xs:nR.bind(null,t),eo:rR.bind(null,t),Bi:tR.bind(null,t),Ys:J0.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>m(this,null,function*(){yield eR(this.ka.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=N_();if(!Is.D(t))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=hf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Is(t,e.asyncQueue,r,e.clientId,e.initialUser)}},zs=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>gv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=H0.bind(null,this.syncEngine),yield Ed(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Rd}()}createDatastore(e){let t=Xs(e.databaseInfo.databaseId),r=function(s){return new md(s)}(e.databaseInfo);return function(s,o,a,u){return new _d(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Td(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>gv(this.syncEngine,t,0),function(){return du.D()?new du:new pd}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new xd(i,s,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield function(r){return m(this,null,function*(){let i=E(r);v("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield ti(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function yv(n,e=10240){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Yr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):oe("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Md=class{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new me,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}Ba(){return m(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return m(this,null,function*(){let e=yield this.Wa();if(e===null)return null;let t=this.$a.decode(e),r=Number(t);isNaN(r)&&this.Ga(`length string (${t}) is not valid number`);let i=yield this.za(r);return new bd(JSON.parse(i),e.length+r)})}ja(){return this.buffer.findIndex(e=>e===123)}Wa(){return m(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let e=this.ja();e<0&&this.Ga("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}za(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let t=this.$a.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){return m(this,null,function*(){let e=yield this.Ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var kd=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return m(this,null,function*(){let o=E(i),a={documents:s.map(h=>ks(o.serializer,h))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,z.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=l0(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());b(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new cn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=A.fromPath(r);this.mutations.push(new Ds(i,this.precondition(i)))}),yield function(r,i){return m(this,null,function*(){let s=E(r),o={writes:i.map(a=>Os(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,z.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=C.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(C.min())?se.exists(!1):se.updateTime(t):se.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(C.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return se.updateTime(t)}return se.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Od=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new js(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>m(this,null,function*(){let e=new kd(this.datastore),t=this.Xa(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.eu(i)}))}).catch(r=>{this.eu(r)})}))}Xa(e){try{let t=this.updateFunction(e);return!Qs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!r_(t)}return!1}};var Ld=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ge.UNAUTHENTICATED,this.clientId=Oa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new me;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ii(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ma(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield S_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Fd(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield If(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>fv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>fv(e.remoteStore,i)),n._onlineComponents=e})}function z_(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function If(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ma(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!z_(t))throw t;wt("Error using user provided cache. Falling back to memory cache: "+t),yield Ma(n,new Bs)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Ma(n,new Bs);return n._offlineComponents})}function Mu(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Fd(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Fd(n,new zs))),n._onlineComponents})}function $_(n){return If(n).then(e=>e.persistence)}function Af(n){return If(n).then(e=>e.localStore)}function G_(n){return Mu(n).then(e=>e.remoteStore)}function Rf(n){return Mu(n).then(e=>e.syncEngine)}function sR(n){return Mu(n).then(e=>e.datastore)}function Xr(n){return m(this,null,function*(){let e=yield Mu(n),t=e.eventManager;return t.onListen=U0.bind(null,e.syncEngine),t.onUnlisten=q0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=j0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B0.bind(null,e.syncEngine),t})}function oR(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield $_(n),t=yield G_(n);return e.setNetworkEnabled(!0),function(i){let s=E(i);return s.v_.delete(0),Js(s)}(t)}))}function aR(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield $_(n),t=yield G_(n);return e.setNetworkEnabled(!1),function(i){return m(this,null,function*(){let s=E(i);s.v_.add(0),yield ti(s),s.x_.set("Offline")})}(t)}))}function uR(n,e){let t=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield function(c,l){let h=E(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=ii(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Af(n),e,t)})),t.promise}function K_(n,e,t={}){let r=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Yr({next:d=>{o.enqueueAndForget(()=>mf(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new qs(ei(a.path),l,{includeMetadataChanges:!0,ta:!0});return gf(s,h)}(yield Xr(n),n.asyncQueue,e,t,r)})),r.promise}function cR(n,e){let t=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield uu(i,s,!0),u=new wu(s,a.hs),c=u.Ta(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=ii(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Af(n),e,t)})),t.promise}function Q_(n,e,t={}){let r=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Yr({next:d=>{o.enqueueAndForget(()=>mf(s,h)),d.fromCache&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new qs(a,l,{includeMetadataChanges:!0,ta:!0});return gf(s,h)}(yield Xr(n),n.asyncQueue,e,t,r)})),r.promise}function lR(n,e){let t=new Yr(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){E(i).W_.add(s),s.next()}(yield Xr(n),t)})),()=>{t.Qa(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){E(i).W_.delete(s)}(yield Xr(n),t)}))}}function hR(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?s_().encode(o):o,function(l,h){return new Md(l,h)}(function(l,h){if(l instanceof Uint8Array)return yv(l,h);if(l instanceof ArrayBuffer)return yv(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Xs(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){iR(yield Rf(n),i,r)}))}function dR(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return function(r,i){let s=E(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield Af(n),e)}))}function W_(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var vv=new Map;function Sf(n,e,t){if(!t)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function fR(n,e,t,r){if(e===!0&&r===!0)throw new _(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function _v(n){if(!A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function wv(n){if(A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ku(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":S()}function G(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ku(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function H_(n,e){if(e<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Eu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}fR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=W_((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Kn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eu(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new nh;switch(r.type){case"firstParty":return new oh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=vv.get(t);r&&(v("ComponentProvider","Removing Datastore"),vv.delete(t),r.terminate())}(this),Promise.resolve()}};function pR(n,e,t,r={}){var i;let s=(n=G(n,Kn))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&wt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=ge.MOCK_USER;else{a=Mp(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ge(c)}n._authCredentials=new rh(new ka(a,u))}}var be=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ce=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _t(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},_t=class n extends be{constructor(e,t,r){super(e,t,ei(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ce(this.firestore,null,new A(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function fb(n,e,...t){if(n=ve(n),Sf("collection","path",e),n instanceof Kn){let r=z.fromString(e,...t);return wv(r),new _t(n,null,r)}{if(!(n instanceof ce||n instanceof _t))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(z.fromString(e,...t));return wv(r),new _t(n.firestore,null,r)}}function pb(n,e){if(n=G(n,Kn),Sf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new be(n,null,function(r){return new rt(z.emptyPath(),r)}(e))}function gR(n,e,...t){if(n=ve(n),arguments.length===1&&(e=Oa.newId()),Sf("doc","path",e),n instanceof Kn){let r=z.fromString(e,...t);return _v(r),new ce(n,null,new A(r))}{if(!(n instanceof ce||n instanceof _t))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(z.fromString(e,...t));return _v(r),new ce(n.firestore,n instanceof _t?n.converter:null,new A(r))}}function gb(n,e){return n=ve(n),e=ve(e),(n instanceof ce||n instanceof _t)&&(e instanceof ce||e instanceof _t)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function mR(n,e){return n=ve(n),e=ve(e),n instanceof be&&e instanceof be&&n.firestore===e.firestore&&Hs(n._query,e._query)&&n.converter===e.converter}var Ud=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new js(this,"async_queue_retry"),this.cu=()=>{let t=Va();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};let e=Va();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;let t=Va();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});let t=new me;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){return m(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!gn(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(e){let t=this.nu.then(()=>(this._u=!0,e().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw oe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=t,t}enqueueAfterDelay(e,t,r){this.lu(),this.uu.indexOf(e)>-1&&(t=0);let i=Id.createAndSchedule(this,e,t,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){return m(this,null,function*(){let e;do e=this.nu,yield e;while(e!==this.nu)})}Eu(e){for(let t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.su)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){let t=this.su.indexOf(e);this.su.splice(t,1)}};function jd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var qd=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new me,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var mb=-1,ne=class extends Kn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Ud}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Y_(this),this._firestoreClient.terminate()}};function yb(n,e){let t=typeof n=="object"?n:vo(),r=typeof n=="string"?n:e||"(default)",i=jp(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Vp("firestore");s&&pR(i,...s)}return i}function Ce(n){return n._firestoreClient||Y_(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Y_(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new ph(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,W_(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Ld(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function vb(n,e){J_(n=G(n,ne));let t=Ce(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");wt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new zs;return X_(t,i,new Tu(i,r.cacheSizeBytes,e?.forceOwnership))}function _b(n){J_(n=G(n,ne));let e=Ce(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");wt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new zs;return X_(e,r,new Vd(r,t.cacheSizeBytes))}function X_(n,e,t){let r=new me;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield Ma(n,t),yield Fd(n,e),r.resolve()}catch(i){let s=i;if(!z_(s))throw s;wt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function wb(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new me;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield function(r){return m(this,null,function*(){if(!Nt.D())return Promise.resolve();let i=r+"main";yield Nt.delete(i)})}(hf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Tb(n){return function(t){let r=new me;return t.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return Q0(yield Rf(t),r)})),r.promise}(Ce(n=G(n,ne)))}function Eb(n){return oR(Ce(n=G(n,ne)))}function Ib(n){return aR(Ce(n=G(n,ne)))}function Ab(n,e){let t=Ce(n=G(n,ne)),r=new qd;return hR(t,n._databaseId,e,r),r}function Rb(n,e){return dR(Ce(n=G(n,ne)),e).then(t=>t?new be(n,null,t.query):null)}function J_(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Jr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ie.fromBase64String(e))}catch(t){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var hn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _e(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var kt=class{constructor(e){this._methodName=e}};var $s=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return O(this._lat,e._lat)||O(this._long,e._long)}};var yR=/^__.*__$/,Bd=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new it(e,this.data,this.fieldMask,t,this.fieldTransforms):new un(e,this.data,t,this.fieldTransforms)}},Iu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new it(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Z_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Au=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return Ru(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(e.length===0)throw this.Su("Document fields must not be empty");if(Z_(this.Vu)&&yR.test(e))throw this.Su('Document fields cannot begin and end with "__"')}},zd=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Xs(e)}Cu(e,t,r,i=!1){return new Au({Vu:e,methodName:t,Du:r,path:_e.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Yn(n){let e=n._freezeSettings(),t=Xs(n._databaseId);return new zd(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ou(n,e,t,r,i,s={}){let o=n.Cu(s.merge||s.mergeFields?2:0,e,t,i);Pf("Data must be an object, but it was:",o,r);let a=nw(r,o),u,c;if(s.merge)u=new Ge(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Wd(e,h,t);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);iw(l,d)||l.push(d)}u=new Ge(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Bd(new Ve(a),u,c)}var Gs=class n extends kt{_toFieldTransform(e){if(e.Vu!==2)throw e.Vu===1?e.Su(`${this._methodName}() can only appear at the top level of your update data`):e.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function ew(n,e,t){return new Au({Vu:3,Du:e.settings.Du,methodName:n._methodName,gu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var $d=class n extends kt{_toFieldTransform(e){return new zn(e.path,new on)}isEqual(e){return e instanceof n}},Gd=class n extends kt{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=ew(this,e,!0),r=this.vu.map(s=>Xn(s,t)),i=new Vt(r);return new zn(e.path,i)}isEqual(e){return e instanceof n&&ac(this.vu,e.vu)}},Kd=class n extends kt{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=ew(this,e,!0),r=this.vu.map(s=>Xn(s,t)),i=new Mt(r);return new zn(e.path,i)}isEqual(e){return e instanceof n&&ac(this.vu,e.vu)}},Qd=class n extends kt{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){let t=new an(e.serializer,Yv(e.serializer,this.Fu));return new zn(e.path,t)}isEqual(e){return e instanceof n&&this.Fu===e.Fu}};function bf(n,e,t,r){let i=n.Cu(1,e,t);Pf("Data must be an object, but it was:",i,r);let s=[],o=Ve.empty();Hn(r,(u,c)=>{let l=Df(e,u,t);c=ve(c);let h=i.yu(l);if(c instanceof Gs)s.push(l);else{let d=Xn(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Ge(s);return new Iu(o,a,i.fieldTransforms)}function Cf(n,e,t,r,i,s){let o=n.Cu(1,e,t),a=[Wd(e,r,t)],u=[i];if(s.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Wd(e,s[d])),u.push(s[d+1]);let c=[],l=Ve.empty();for(let d=a.length-1;d>=0;--d)if(!iw(c,a[d])){let f=a[d],T=u[d];T=ve(T);let w=o.yu(f);if(T instanceof Gs)c.push(f);else{let y=Xn(T,w);y!=null&&(c.push(f),l.set(f,y))}}let h=new Ge(c);return new Iu(l,h,o.fieldTransforms)}function tw(n,e,t,r=!1){return Xn(t,n.Cu(r?4:3,e))}function Xn(n,e){if(rw(n=ve(n)))return Pf("Unsupported field value:",e,n),nw(n,e);if(n instanceof kt)return function(r,i){if(!Z_(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.gu&&e.Vu!==4)throw e.Su("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Xn(a,i.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Yv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ae.fromDate(r);return{timestampValue:Br(i.serializer,s)}}if(r instanceof ae){let s=new ae(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Br(i.serializer,s)}}if(r instanceof $s)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Jr)return{bytesValue:o_(i.serializer,r._byteString)};if(r instanceof ce){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:uf(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${ku(r)}`)}(n,e)}function nw(n,e){let t={};return Vv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hn(n,(r,i)=>{let s=Xn(i,e.fu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function rw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ae||n instanceof $s||n instanceof Jr||n instanceof ce||n instanceof kt)}function Pf(n,e,t){if(!rw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=ku(t);throw r==="an object"?e.Su(n+" a custom object"):e.Su(n+" "+r)}}function Wd(n,e,t){if((e=ve(e))instanceof hn)return e._internalPath;if(typeof e=="string")return Df(n,e);throw Ru("Field path arguments must be of type string or ",n,!1,void 0,t)}var vR=new RegExp("[~\\*/\\[\\]]");function Df(n,e,t){if(e.search(vR)>=0)throw Ru(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new hn(...e.split("."))._internalPath}catch{throw Ru(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ru(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function iw(n,e){return n.some(t=>t.isEqual(e))}var Qn=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ce(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Hd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Lu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Hd=class extends Qn{data(){return super.data()}};function Lu(n,e){return typeof e=="string"?Df(n,e):e instanceof hn?e._internalPath:e._delegate._internalPath}function sw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ks=class{},Wn=class extends Ks{};function Sb(n,e,...t){let r=[];e instanceof Ks&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Yd).length,a=s.filter(u=>u instanceof Su).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Su=class n extends Wn{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return aw(e._query,t),new be(e.firestore,e.converter,bh(e._query,t))}_parse(e){let t=Yn(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Ev(h,l);let f=[];for(let T of h)f.push(Tv(u,s,T));d={arrayValue:{values:f}}}else d=Tv(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Ev(h,l),d=tw(a,o,h,l==="in"||l==="not-in");return j.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function bb(n,e,t){let r=e,i=Lu("where",n);return Su._create(i,r,t)}var Yd=class n extends Ks{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Y.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)aw(o,u),o=bh(o,u)}(e._query,t),new be(e.firestore,e.converter,bh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Xd=class n extends Wn{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new qn(s,o)}(e._query,this._field,this._direction);return new be(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new rt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function Cb(n,e="asc"){let t=e,r=Lu("orderBy",n);return Xd._create(r,t)}var bu=class n extends Wn{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new be(e.firestore,e.converter,Ka(e._query,this._limit,this._limitType))}};function Pb(n){return H_("limit",n),bu._create("limit",n,"F")}function Db(n){return H_("limitToLast",n),bu._create("limitToLast",n,"L")}var Cu=class n extends Wn{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=ow(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new rt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function xb(...n){return Cu._create("startAt",n,!0)}function Nb(...n){return Cu._create("startAfter",n,!1)}var Pu=class n extends Wn{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=ow(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new rt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Vb(...n){return Pu._create("endBefore",n,!1)}function Mb(...n){return Pu._create("endAt",n,!0)}function ow(n,e,t,r){if(t[0]=ve(t[0]),t[0]instanceof Qn)return function(s,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Nr(s))if(h.field.isKeyField())l.push(jn(o,u.key));else{let d=u.data.field(h.field);if(xu(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new Et(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Yn(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let T=0;T<l.length;T++){let w=l[T];if(d[T].field.isKeyField()){if(typeof w!="string")throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!of(o)&&w.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let y=o.path.child(z.fromString(w));if(!A.isDocumentKey(y))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${y}' is not because it contains an odd number of segments.`);let R=new A(y);f.push(jn(a,R))}else{let y=tw(u,c,w);f.push(y)}}return new Et(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Tv(n,e,t){if(typeof(t=ve(t))=="string"){if(t==="")throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!of(e)&&t.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(z.fromString(t));if(!A.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jn(n,new A(r))}if(t instanceof ce)return jn(n,t._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ku(t)}.`)}function Ev(n,e){if(!Array.isArray(n)||n.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function aw(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Du=class{convertValue(e,t="none"){switch(Un(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Hn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new $s(ie(e.latitude),ie(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(bs(e));default:return null}}convertTimestamp(e){let t=nn(e);return new ae(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=z.fromString(e);b(y_(r));let i=new Lr(r.get(1),r.get(3)),s=new A(r.popFirst(5));return i.isEqual(t)||oe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Fu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Jd=class extends Du{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}};var xt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},dn=class extends Qn{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Lu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Mr=class extends dn{data(e={}){return super.data(e)}},fn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Mr(this._firestore,this._userDataWriter,r.key,r,new xt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Mr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new xt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Mr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new xt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:_R(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function _R(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function kb(n,e){return n instanceof dn&&e instanceof dn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof fn&&e instanceof fn&&n._firestore===e._firestore&&mR(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Ob(n){n=G(n,ce);let e=G(n.firestore,ne);return K_(Ce(e),n._key).then(t=>xf(e,n,t))}var Ot=class extends Du{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}};function Lb(n){n=G(n,ce);let e=G(n.firestore,ne),t=Ce(e),r=new Ot(e);return uR(t,n._key).then(i=>new dn(e,r,n._key,i,new xt(i!==null&&i.hasLocalMutations,!0),n.converter))}function Fb(n){n=G(n,ce);let e=G(n.firestore,ne);return K_(Ce(e),n._key,{source:"server"}).then(t=>xf(e,n,t))}function Ub(n){n=G(n,be);let e=G(n.firestore,ne),t=Ce(e),r=new Ot(e);return sw(n._query),Q_(t,n._query).then(i=>new fn(e,r,n,i))}function jb(n){n=G(n,be);let e=G(n.firestore,ne),t=Ce(e),r=new Ot(e);return cR(t,n._query).then(i=>new fn(e,r,n,i))}function qb(n){n=G(n,be);let e=G(n.firestore,ne),t=Ce(e),r=new Ot(e);return Q_(t,n._query,{source:"server"}).then(i=>new fn(e,r,n,i))}function Bb(n,e,t){n=G(n,ce);let r=G(n.firestore,ne),i=Fu(n.converter,e,t);return Uu(r,[Ou(Yn(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,se.none())])}function zb(n,e,t,...r){n=G(n,ce);let i=G(n.firestore,ne),s=Yn(i),o;return o=typeof(e=ve(e))=="string"||e instanceof hn?Cf(s,"updateDoc",n._key,e,t,r):bf(s,"updateDoc",n._key,e),Uu(i,[o.toMutation(n._key,se.exists(!0))])}function $b(n){return Uu(G(n.firestore,ne),[new cn(n._key,se.none())])}function Gb(n,e){let t=G(n.firestore,ne),r=gR(n),i=Fu(n.converter,e);return Uu(t,[Ou(Yn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,se.exists(!1))]).then(()=>r)}function Kb(n,...e){var t,r,i;n=ve(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||jd(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(jd(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof ce)c=G(n.firestore,ne),l=ei(n._key.path),u={next:h=>{e[o]&&e[o](xf(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=G(n,be);c=G(h.firestore,ne),l=h._query;let d=new Ot(c);u={next:f=>{e[o]&&e[o](new fn(c,d,h,f))},error:e[o+1],complete:e[o+2]},sw(n._query)}return function(d,f,T,w){let y=new Yr(w),R=new qs(f,y,T);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return gf(yield Xr(d),R)})),()=>{y.Qa(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return mf(yield Xr(d),R)}))}}(Ce(c),l,a,u)}function Qb(n,e){return lR(Ce(n=G(n,ne)),jd(e)?e:{next:e})}function Uu(n,e){return function(r,i){let s=new me;return r.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return z0(yield Rf(r),i,s)})),s.promise}(Ce(n),e)}function xf(n,e,t){let r=t.docs.get(e._key),i=new Ot(n);return new dn(n,i,e._key,r,new xt(t.hasPendingWrites,t.fromCache),e.converter)}var wR={maxAttempts:5};var Iv=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yn(e)}set(e,t,r){this._verifyNotCommitted();let i=Zt(e,this._firestore),s=Fu(i.converter,t,r),o=Ou(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,se.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Zt(e,this._firestore),o;return o=typeof(t=ve(t))=="string"||t instanceof hn?Cf(this._dataReader,"WriteBatch.update",s._key,t,r,i):bf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,se.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Zt(e,this._firestore);return this._mutations=this._mutations.concat(new cn(t._key,se.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Zt(n,e){if((n=ve(n)).firestore!==e)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Zd=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Yn(t)}get(t){let r=Zt(t,this._firestore),i=new Jd(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Qn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Qn(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){let s=Zt(t,this._firestore),o=Fu(s.converter,r,i),a=Ou(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Zt(t,this._firestore),a;return a=typeof(r=ve(r))=="string"||r instanceof hn?Cf(this._dataReader,"Transaction.update",o._key,r,i,s):bf(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Zt(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Zt(e,this._firestore),r=new Ot(this._firestore);return super.get(e).then(i=>new dn(this._firestore,r,t._key,i._document,new xt(!1,!1),t.converter))}};function Hb(n,e,t){n=G(n,ne);let r=Object.assign(Object.assign({},wR),t);return function(s){if(s.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new me;return s.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let c=yield sR(s);new Od(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(Ce(n),i=>e(new Zd(n,i)),r)}function Yb(){return new Gs("deleteField")}function Xb(){return new $d("serverTimestamp")}function Jb(...n){return new Gd("arrayUnion",n)}function Zb(...n){return new Kd("arrayRemove",n)}function eC(n){return new Qd("increment",n)}(function(e,t=!0){(function(i){Zr=i})(qp),Up(new Lp("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new ne(new ih(r.getProvider("auth-internal")),new uh(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Lr(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Rt(Iy,"4.5.1",e),Rt(Iy,"4.5.1","esm2017")})();export{vw as a,MR as b,Zp as c,QR as d,WR as e,rT as f,VT as g,bt as h,fg as i,fS as j,pS as k,pr as l,RS as m,cI as n,Yg as o,Xg as p,dI as q,Jg as r,zi as s,ol as t,kS as u,OS as v,QS as w,em as x,tm as y,II as z,WS as A,HS as B,ab as C,wt as D,ub as E,_ as F,ae as G,_e as H,A as I,lb as J,Lr as K,fR as L,G as M,pR as N,ce as O,fb as P,pb as Q,gR as R,gb as S,mR as T,mb as U,yb as V,Ce as W,vb as X,_b as Y,wb as Z,Tb as _,Eb as $,Ib as aa,Ab as ba,Rb as ca,Jr as da,hn as ea,$s as fa,Sb as ga,bb as ha,Cb as ia,Pb as ja,Db as ka,xb as la,Nb as ma,Vb as na,Mb as oa,Du as pa,dn as qa,Mr as ra,fn as sa,kb as ta,Ob as ua,Lb as va,Fb as wa,Ub as xa,jb as ya,qb as za,Bb as Aa,zb as Ba,$b as Ca,Gb as Da,Kb as Ea,Qb as Fa,Uu as Ga,Iv as Ha,Hb as Ia,Yb as Ja,Xb as Ka,Jb as La,Zb as Ma,eC as Na};
