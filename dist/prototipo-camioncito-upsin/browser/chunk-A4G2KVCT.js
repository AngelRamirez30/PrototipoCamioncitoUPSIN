import{Va as fc,Wa as bt,b as qp,d as Bp,e as mi,j as hc,k as $p,l as zp,n as dc,p as ve,q as Gp,r as ht,s as Kp,t as Wp,u as Qp,v as Hp,w as Yp,x as wo,y as Io,z as rt}from"./chunk-VXCTXBXA.js";import{$ as Bt,$a as gp,$b as Cp,A as St,Aa as ip,Ac as Up,Ba as wn,Bb as Ep,C as tr,Ca as lt,Cc as lc,D as jt,Da as oo,Dc as jp,Ea as nc,Ec as _o,F as Xu,Fa as sp,G as nr,Ga as In,H as Qf,Ha as rc,Hb as Tp,Ia as ir,J as _n,Ja as sr,Jb as Ap,K as qt,Ka as op,Kb as Rp,L as Ju,La as ap,M as Hf,Ma as up,Na as cp,O as Yf,Oa as lp,Pa as hp,Qa as dp,Ra as En,Rb as Sp,S as Xf,T as qe,Ta as fp,Ua as di,Ub as uo,V as Jf,Vb as co,W as de,Wa as nt,Wb as lo,X as te,Xa as pp,Xb as bp,Y as rr,Yb as ho,Z as Zu,Zb as fo,_ as hi,_b as oc,a as qf,aa as no,ab as ic,ac,b as Bf,ba as Zf,bc as uc,c as ui,ca as We,cb as ao,cc as po,d as Ku,da as ro,db as re,dc as go,e as Wu,eb as mp,ec as Pp,f as Ut,fb as yp,fc as cc,g as Ke,gc as Dp,h as $f,hb as vp,hc as xp,i as zf,ia as ec,ib as _p,ic as mo,j as vn,jb as sc,k as Qu,ka as ep,kb as fi,kc as Np,l as Hu,la as q,lc as yo,m as Pe,ma as Qe,mb as wp,mc as kp,n as x,na as tp,nc as Mp,o as ci,oa as G,oc as Fe,p as Gf,pa as io,pc as Vp,q as Kf,qa as np,qc as pi,r as W,ra as tt,rc as Op,s as to,sc as Lp,t as je,ta as tc,tc as gi,u as li,ub as Ip,uc as vo,v as Wf,va as V,w as Yu,wa as P,xa as He,ya as rp,za as so,zc as Fp}from"./chunk-BJ35RS3A.js";import{a as D,b as Me,e as Gu,f as m}from"./chunk-CQCHLVVT.js";var vi=class{},To=class{},Tn=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var gc=class{encodeKey(e){return Xp(e)}encodeValue(e){return Xp(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function ww(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[o,a]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],u=t.get(o)||[];u.push(a),t.set(o,u)}),t}var Iw=/%(\d[a-f0-9])/gi,Ew={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Xp(n){return encodeURIComponent(n).replace(Iw,(e,t)=>Ew[t]??e)}function Eo(n){return`${n}`}var $t=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new gc,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=ww(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(Eo):[Eo(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Eo(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(Eo(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var mc=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function Tw(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Jp(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Zp(n){return typeof Blob<"u"&&n instanceof Blob}function eg(n){return typeof FormData<"u"&&n instanceof FormData}function Aw(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var yi=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(Tw(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Tn,this.context??=new mc,!this.params)this.params=new $t,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),u=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+u+o}}}serializeBody(){return this.body===null?null:Jp(this.body)||Zp(this.body)||eg(this.body)||Aw(this.body)||typeof this.body=="string"?this.body:this.body instanceof $t?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||eg(this.body)?null:Zp(this.body)?this.body.type||null:Jp(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof $t?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.body!==void 0?e.body:this.body,o=e.withCredentials!==void 0?e.withCredentials:this.withCredentials,a=e.reportProgress!==void 0?e.reportProgress:this.reportProgress,u=e.headers||this.headers,c=e.params||this.params,l=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((h,d)=>h.set(d,e.setHeaders[d]),u)),e.setParams&&(c=Object.keys(e.setParams).reduce((h,d)=>h.set(d,e.setParams[d]),c)),new n(t,r,s,{params:c,headers:u,context:l,reportProgress:a,responseType:i,withCredentials:o})}},or=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(or||{}),_i=class{constructor(e,t=So.Ok,r="OK"){this.headers=e.headers||new Tn,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},yc=class n extends _i{constructor(e={}){super(e),this.type=or.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Ao=class n extends _i{constructor(e={}){super(e),this.type=or.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Ro=class extends _i{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},So=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(So||{});function pc(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var Rw=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let o;if(r instanceof yi)o=r;else{let c;s.headers instanceof Tn?c=s.headers:c=new Tn(s.headers);let l;s.params&&(s.params instanceof $t?l=s.params:l=new $t({fromObject:s.params})),o=new yi(r,i,s.body!==void 0?s.body:null,{headers:c,context:s.context,params:l,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let a=x(o).pipe(jt(c=>this.handler.handle(c)));if(r instanceof yi||s.observe==="events")return a;let u=a.pipe(St(c=>c instanceof Ao));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(W(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return c.body}));case"blob":return u.pipe(W(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new Error("Response is not a Blob.");return c.body}));case"text":return u.pipe(W(c=>{if(c.body!==null&&typeof c.body!="string")throw new Error("Response is not a string.");return c.body}));case"json":default:return u.pipe(W(c=>c.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new $t().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,pc(s,i))}post(r,i,s={}){return this.request("POST",r,pc(s,i))}put(r,i,s={}){return this.request("PUT",r,pc(s,i))}};e.\u0275fac=function(i){return new(i||e)(V(vi))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function ig(n,e){return e(n)}function Sw(n,e){return(t,r)=>e.intercept(t,{handle:i=>n(i,r)})}function bw(n,e,t){return(r,i)=>lt(t,()=>e(r,s=>n(s,i)))}var Cw=new G(""),vc=new G(""),Pw=new G(""),Dw=new G("");function xw(){let n=null;return(e,t)=>{n===null&&(n=(P(Cw,{optional:!0})??[]).reduceRight(Sw,ig));let r=P(fi),i=r.add();return n(e,t).pipe(_n(()=>r.remove(i)))}}var tg=(()=>{let e=class e extends vi{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=P(fi);let s=P(Dw,{optional:!0});this.backend=s??r}handle(r){if(this.chain===null){let s=Array.from(new Set([...this.injector.get(vc),...this.injector.get(Pw,[])]));this.chain=s.reduceRight((o,a)=>bw(o,a,this.injector),ig)}let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(_n(()=>this.pendingTasks.remove(i)))}};e.\u0275fac=function(i){return new(i||e)(V(To),V(wn))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();var Nw=/^\)\]\}',?\n/;function kw(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var ng=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new te(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?Pe(i.\u0275loadImpl()):x(null)).pipe(qe(()=>new ui(o=>{let a=i.build();if(a.open(r.method,r.urlWithParams),r.withCredentials&&(a.withCredentials=!0),r.headers.forEach((y,R)=>a.setRequestHeader(y,R.join(","))),r.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let y=r.detectContentTypeHeader();y!==null&&a.setRequestHeader("Content-Type",y)}if(r.responseType){let y=r.responseType.toLowerCase();a.responseType=y!=="json"?y:"text"}let u=r.serializeBody(),c=null,l=()=>{if(c!==null)return c;let y=a.statusText||"OK",R=new Tn(a.getAllResponseHeaders()),N=kw(a)||r.url;return c=new yc({headers:R,status:a.status,statusText:y,url:N}),c},h=()=>{let{headers:y,status:R,statusText:N,url:M}=l(),F=null;R!==So.NoContent&&(F=typeof a.response>"u"?a.responseText:a.response),R===0&&(R=F?So.Ok:0);let X=R>=200&&R<300;if(r.responseType==="json"&&typeof F=="string"){let z=F;F=F.replace(Nw,"");try{F=F!==""?JSON.parse(F):null}catch(he){F=z,X&&(X=!1,F={error:he,text:F})}}X?(o.next(new Ao({body:F,headers:y,status:R,statusText:N,url:M||void 0})),o.complete()):o.error(new Ro({error:F,headers:y,status:R,statusText:N,url:M||void 0}))},d=y=>{let{url:R}=l(),N=new Ro({error:y,status:a.status||0,statusText:a.statusText||"Unknown Error",url:R||void 0});o.error(N)},f=!1,I=y=>{f||(o.next(l()),f=!0);let R={type:or.DownloadProgress,loaded:y.loaded};y.lengthComputable&&(R.total=y.total),r.responseType==="text"&&a.responseText&&(R.partialText=a.responseText),o.next(R)},w=y=>{let R={type:or.UploadProgress,loaded:y.loaded};y.lengthComputable&&(R.total=y.total),o.next(R)};return a.addEventListener("load",h),a.addEventListener("error",d),a.addEventListener("timeout",d),a.addEventListener("abort",d),r.reportProgress&&(a.addEventListener("progress",I),u!==null&&a.upload&&a.upload.addEventListener("progress",w)),a.send(u),o.next({type:or.Sent}),()=>{a.removeEventListener("error",d),a.removeEventListener("abort",d),a.removeEventListener("load",h),a.removeEventListener("timeout",d),r.reportProgress&&(a.removeEventListener("progress",I),u!==null&&a.upload&&a.upload.removeEventListener("progress",w)),a.readyState!==a.DONE&&a.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(V(_o))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),sg=new G(""),Mw="XSRF-TOKEN",Vw=new G("",{providedIn:"root",factory:()=>Mw}),Ow="X-XSRF-TOKEN",Lw=new G("",{providedIn:"root",factory:()=>Ow}),bo=class{},Fw=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=vo(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(V(Fe),V(tt),V(Vw))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function Uw(n,e){let t=n.url.toLowerCase();if(!P(sg)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=P(bo).getToken(),i=P(Lw);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}var og=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(og||{});function jw(n,e){return{\u0275kind:n,\u0275providers:e}}function qw(...n){let e=[Rw,ng,tg,{provide:vi,useExisting:tg},{provide:To,useExisting:ng},{provide:vc,useValue:Uw,multi:!0},{provide:sg,useValue:!0},{provide:bo,useClass:Fw}];for(let t of n)e.push(...t.\u0275providers);return so(e)}var rg=new G("");function Bw(){return jw(og.LegacyInterceptors,[{provide:rg,useFactory:xw},{provide:vc,useExisting:rg,multi:!0}])}var zS=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=We({type:e}),e.\u0275inj=Qe({providers:[qw(Bw())]});let n=e;return n})();var Ic=class extends Mp{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Ec=class n extends Ic{static makeCurrent(){kp(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=zw();return t==null?null:Gw(t)}resetBaseElement(){wi=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return vo(document.cookie,e)}},wi=null;function zw(){return wi=wi||document.querySelector("base"),wi?wi.getAttribute("href"):null}function Gw(n){return new URL(n,document.baseURI).pathname}var Tc=class{addToWindow(e){Bt.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new te(5103,!1);return s},Bt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Bt.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=Bt.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};Bt.frameworkStabilizers||(Bt.frameworkStabilizers=[]),Bt.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?yo().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},Kw=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),Ac=new G(""),lg=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new te(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(V(Ac),V(re))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),Co=class{constructor(e){this._doc=e}},_c="ng-app-id",hg=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=lc(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${_c}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(_c),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(_c,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(V(Fe),V(io),V(tc,8),V(tt))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),wc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Sc=/%COMP%/g,dg="%COMP%",Ww=`_nghost-${dg}`,Qw=`_ngcontent-${dg}`,Hw=!0,Yw=new G("",{providedIn:"root",factory:()=>Hw});function Xw(n){return Qw.replace(Sc,n)}function Jw(n){return Ww.replace(Sc,n)}function fg(n,e){return e.map(t=>t.replace(Sc,n))}var ag=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=lc(u),this.defaultRenderer=new Ii(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===hi.ShadowDom&&(i=Me(D({},i),{encapsulation:hi.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Po?s.applyToHost(r):s instanceof Ei&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case hi.Emulated:o=new Po(c,l,i,this.appId,h,a,u,d);break;case hi.ShadowDom:return new Rc(c,l,r,i,a,u,this.nonce,d);default:o=new Ei(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(V(lg),V(hg),V(io),V(Yw),V(Fe),V(tt),V(re),V(tc))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),Ii=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(wc[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(ug(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(ug(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new te(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=wc[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=wc[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(di.DashCase|di.Important)?e.style.setProperty(t,r,i&di.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&di.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=yo().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function ug(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Rc=class extends Ii{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=fg(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Ei=class extends Ii{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?fg(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Po=class extends Ei{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=Xw(c),this.hostAttr=Jw(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},Zw=(()=>{let e=class e extends Co{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(V(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})(),cg=["alt","control","meta","shift"],eI={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},tI={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},nI=(()=>{let e=class e extends Co{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>yo().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),cg.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=eI[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),cg.forEach(a=>{if(a!==s){let u=tI[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(V(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function rI(){Ec.makeCurrent()}function iI(){return new rc}function sI(){return ep(document),document}var oI=[{provide:tt,useValue:Up},{provide:np,useValue:rI,multi:!0},{provide:Fe,useFactory:sI,deps:[]}],rb=Pp(Dp,"browser",oI),aI=new G(""),uI=[{provide:ho,useClass:Tc,deps:[]},{provide:bp,useClass:fo,deps:[re,oc,ho]},{provide:fo,useClass:fo,deps:[re,oc,ho]}],cI=[{provide:ip,useValue:"root"},{provide:rc,useFactory:iI,deps:[]},{provide:Ac,useClass:Zw,multi:!0,deps:[Fe,re,tt]},{provide:Ac,useClass:nI,multi:!0,deps:[Fe]},ag,hg,lg,{provide:gp,useExisting:ag},{provide:_o,useClass:Kw,deps:[]},[]],ib=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:io,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(V(aI,12))},e.\u0275mod=We({type:e}),e.\u0275inj=Qe({providers:[...cI,...uI],imports:[Fp,xp]});let n=e;return n})();var pg=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(V(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var lI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:function(i){let s=null;return i?s=new(i||e):s=V(hI),s},providedIn:"root"});let n=e;return n})(),hI=(()=>{let e=class e extends lI{constructor(r){super(),this._doc=r}sanitize(r,i){if(i==null)return null;switch(r){case En.NONE:return i;case En.HTML:return sr(i,"HTML")?ir(i):dp(this._doc,String(i)).toString();case En.STYLE:return sr(i,"Style")?ir(i):i;case En.SCRIPT:if(sr(i,"Script"))return ir(i);throw new te(5200,!1);case En.URL:return sr(i,"URL")?ir(i):hp(String(i));case En.RESOURCE_URL:if(sr(i,"ResourceURL"))return ir(i);throw new te(5201,!1);default:throw new te(5202,!1)}}bypassSecurityTrustHtml(r){return op(r)}bypassSecurityTrustStyle(r){return ap(r)}bypassSecurityTrustScript(r){return up(r)}bypassSecurityTrustUrl(r){return cp(r)}bypassSecurityTrustResourceUrl(r){return lp(r)}};e.\u0275fac=function(i){return new(i||e)(V(Fe))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var U="primary",Li=Symbol("RouteTitle"),xc=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function dr(n){return new xc(n)}function fI(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function pI(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!dt(n[t],e[t]))return!1;return!0}function dt(n,e){let t=n?Nc(n):void 0,r=e?Nc(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Ag(n[i],e[i]))return!1;return!0}function Nc(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Ag(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Rg(n){return n.length>0?n[n.length-1]:null}function Wt(n){return Gf(n)?n:Cp(n)?Pe(Promise.resolve(n)):x(n)}var gI={exact:bg,subset:Cg},Sg={exact:mI,subset:yI,ignored:()=>!0};function gg(n,e,t){return gI[t.paths](n.root,e.root,t.matrixParams)&&Sg[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function mI(n,e){return dt(n,e)}function bg(n,e,t){if(!Rn(n.segments,e.segments)||!No(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!bg(n.children[r],e.children[r],t))return!1;return!0}function yI(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Ag(n[t],e[t]))}function Cg(n,e,t){return Pg(n,e,e.segments,t)}function Pg(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Rn(i,t)||e.hasChildren()||!No(i,t,r))}else if(n.segments.length===t.length){if(!Rn(n.segments,t)||!No(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!Cg(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Rn(n.segments,i)||!No(n.segments,i,r)||!n.children[U]?!1:Pg(n.children[U],e,s,r)}}function No(n,e,t){return e.every((r,i)=>Sg[t](n[i].parameters,r.parameters))}var zt=class{constructor(e=new Q([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=dr(this.queryParams),this._queryParamMap}toString(){return wI.serialize(this)}},Q=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ko(this)}},An=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=dr(this.parameters),this._parameterMap}toString(){return xg(this)}};function vI(n,e){return Rn(n,e)&&n.every((t,r)=>dt(t.parameters,e[r].parameters))}function Rn(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function _I(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===U&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==U&&(t=t.concat(e(i,r)))}),t}var Fi=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>new Pi,providedIn:"root"});let n=e;return n})(),Pi=class{parse(e){let t=new Mc(e);return new zt(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Ti(e.root,!0)}`,r=TI(e.queryParams),i=typeof e.fragment=="string"?`#${II(e.fragment)}`:"";return`${t}${r}${i}`}},wI=new Pi;function ko(n){return n.segments.map(e=>xg(e)).join("/")}function Ti(n,e){if(!n.hasChildren())return ko(n);if(e){let t=n.children[U]?Ti(n.children[U],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==U&&r.push(`${i}:${Ti(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=_I(n,(r,i)=>i===U?[Ti(n.children[U],!1)]:[`${i}:${Ti(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[U]!=null?`${ko(n)}/${t[0]}`:`${ko(n)}/(${t.join("//")})`}}function Dg(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Do(n){return Dg(n).replace(/%3B/gi,";")}function II(n){return encodeURI(n)}function kc(n){return Dg(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Mo(n){return decodeURIComponent(n)}function mg(n){return Mo(n.replace(/\+/g,"%20"))}function xg(n){return`${kc(n.path)}${EI(n.parameters)}`}function EI(n){return Object.entries(n).map(([e,t])=>`;${kc(e)}=${kc(t)}`).join("")}function TI(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Do(t)}=${Do(i)}`).join("&"):`${Do(t)}=${Do(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var AI=/^[^\/()?;#]+/;function bc(n){let e=n.match(AI);return e?e[0]:""}var RI=/^[^\/()?;=#]+/;function SI(n){let e=n.match(RI);return e?e[0]:""}var bI=/^[^=?&#]+/;function CI(n){let e=n.match(bI);return e?e[0]:""}var PI=/^[^&#]+/;function DI(n){let e=n.match(PI);return e?e[0]:""}var Mc=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Q([],{}):new Q([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[U]=new Q(e,t)),r}parseSegment(){let e=bc(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new te(4009,!1);return this.capture(e),new An(Mo(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=SI(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=bc(this.remaining);i&&(r=i,this.capture(r))}e[Mo(t)]=Mo(r)}parseQueryParam(e){let t=CI(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=DI(this.remaining);o&&(r=o,this.capture(r))}let i=mg(t),s=mg(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=bc(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new te(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=U);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[U]:new Q([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new te(4011,!1)}};function Ng(n){return n.segments.length>0?new Q([],{[U]:n}):n}function kg(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=kg(i);if(r===U&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new Q(n.segments,e);return xI(t)}function xI(n){if(n.numberOfChildren===1&&n.children[U]){let e=n.children[U];return new Q(n.segments.concat(e.segments),e.children)}return n}function fr(n){return n instanceof zt}function NI(n,e,t=null,r=null){let i=Mg(n);return Vg(i,e,t,r)}function Mg(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new Q(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=Ng(r);return e??i}function Vg(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Cc(i,i,i,t,r);let s=kI(e);if(s.toRoot())return Cc(i,i,new Q([],{}),t,r);let o=MI(s,i,n),a=o.processChildren?Si(o.segmentGroup,o.index,s.commands):Lg(o.segmentGroup,o.index,s.commands);return Cc(i,o.segmentGroup,a,t,r)}function Vo(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Di(n){return typeof n=="object"&&n!=null&&n.outlets}function Cc(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=Og(n,e,t);let a=Ng(kg(o));return new zt(a,s,i)}function Og(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Og(s,e,t)}),new Q(n.segments,r)}var Oo=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Vo(r[0]))throw new te(4003,!1);let i=r.find(Di);if(i&&i!==Rg(r))throw new te(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function kI(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Oo(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Oo(t,e,r)}var lr=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function MI(n,e,t){if(n.isAbsolute)return new lr(e,!0,0);if(!t)return new lr(e,!1,NaN);if(t.parent===null)return new lr(t,!0,0);let r=Vo(n.commands[0])?0:1,i=t.segments.length-1+r;return VI(t,i,n.numberOfDoubleDots)}function VI(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new te(4005,!1);i=r.segments.length}return new lr(r,!1,i-s)}function OI(n){return Di(n[0])?n[0].outlets:{[U]:n}}function Lg(n,e,t){if(n??=new Q([],{}),n.segments.length===0&&n.hasChildren())return Si(n,e,t);let r=LI(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Q(n.segments.slice(0,r.pathIndex),{});return s.children[U]=new Q(n.segments.slice(r.pathIndex),n.children),Si(s,0,i)}else return r.match&&i.length===0?new Q(n.segments,{}):r.match&&!n.hasChildren()?Vc(n,e,t):r.match?Si(n,0,i):Vc(n,e,t)}function Si(n,e,t){if(t.length===0)return new Q(n.segments,{});{let r=OI(t),i={};if(Object.keys(r).some(s=>s!==U)&&n.children[U]&&n.numberOfChildren===1&&n.children[U].segments.length===0){let s=Si(n.children[U],e,t);return new Q(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Lg(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new Q(n.segments,i)}}function LI(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Di(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!vg(u,c,o))return s;r+=2}else{if(!vg(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Vc(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Di(s)){let u=FI(s.outlets);return new Q(r,u)}if(i===0&&Vo(t[0])){let u=n.segments[e];r.push(new An(u.path,yg(t[0]))),i++;continue}let o=Di(s)?s.outlets[U]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Vo(a)?(r.push(new An(o,yg(a))),i+=2):(r.push(new An(o,{})),i++)}return new Q(r,{})}function FI(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Vc(new Q([],{}),0,r))}),e}function yg(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function vg(n,e,t){return n==t.path&&dt(e,t.parameters)}var bi="imperative",we=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(we||{}),Xe=class{constructor(e,t){this.id=e,this.url=t}},pr=class extends Xe{constructor(e,t,r="imperative",i=null){super(e,t),this.type=we.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},it=class extends Xe{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=we.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ye=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Ye||{}),Lo=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Lo||{}),Gt=class extends Xe{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=we.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Kt=class extends Xe{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=we.NavigationSkipped}},xi=class extends Xe{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=we.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Fo=class extends Xe{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Oc=class extends Xe{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lc=class extends Xe{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=we.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Fc=class extends Xe{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Uc=class extends Xe{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=we.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},jc=class{constructor(e){this.route=e,this.type=we.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},qc=class{constructor(e){this.route=e,this.type=we.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Bc=class{constructor(e){this.snapshot=e,this.type=we.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$c=class{constructor(e){this.snapshot=e,this.type=we.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},zc=class{constructor(e){this.snapshot=e,this.type=we.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Gc=class{constructor(e){this.snapshot=e,this.type=we.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Uo=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=we.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Ni=class{},ki=class{constructor(e){this.url=e}};var Kc=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ui,this.attachRef=null}},Ui=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new Kc,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),jo=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Wc(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Wc(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Qc(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Qc(e,this._root).map(t=>t.value)}};function Wc(n,e){if(n===e.value)return e;for(let t of e.children){let r=Wc(n,t);if(r)return r}return null}function Qc(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Qc(n,t);if(r.length)return r.unshift(e),r}return[]}var Be=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function cr(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var qo=class extends jo{constructor(e,t){super(e),this.snapshot=t,il(this,e)}toString(){return this.snapshot.toString()}};function Fg(n){let e=UI(n),t=new Ke([new An("",{})]),r=new Ke({}),i=new Ke({}),s=new Ke({}),o=new Ke(""),a=new Sn(t,r,s,o,i,U,n,e.root);return a.snapshot=e.root,new qo(new Be(a,[]),e)}function UI(n){let e={},t={},r={},i="",s=new Mi([],e,r,i,t,U,n,null,{});return new Bo("",new Be(s,[]))}var Sn=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(W(c=>c[Li]))??x(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(W(e=>dr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(W(e=>dr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function rl(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:D(D({},e.params),n.params),data:D(D({},e.data),n.data),resolve:D(D(D(D({},n.data),e.data),i?.data),n._resolvedData)}:r={params:D({},n.params),data:D({},n.data),resolve:D(D({},n.data),n._resolvedData??{})},i&&jg(i)&&(r.resolve[Li]=i.title),r}var Mi=class{get title(){return this.data?.[Li]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=dr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=dr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Bo=class extends jo{constructor(e,t){super(t),this.url=e,il(this,t)}toString(){return Ug(this._root)}};function il(n,e){e.value._routerState=n,e.children.forEach(t=>il(n,t))}function Ug(n){let e=n.children.length>0?` { ${n.children.map(Ug).join(", ")} } `:"";return`${n.value}${e}`}function Pc(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,dt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),dt(e.params,t.params)||n.paramsSubject.next(t.params),pI(e.url,t.url)||n.urlSubject.next(t.url),dt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Hc(n,e){let t=dt(n.params,e.params)&&vI(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Hc(n.parent,e.parent))}function jg(n){return typeof n.title=="string"||n.title===null}var jI=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=U,this.activateEvents=new rr,this.deactivateEvents=new rr,this.attachEvents=new rr,this.detachEvents=new rr,this.parentContexts=P(Ui),this.location=P(yp),this.changeDetector=P(ao),this.environmentInjector=P(wn),this.inputBinder=P(Wo,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new te(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new te(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new te(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new te(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new Yc(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=ro({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[oo]});let n=e;return n})(),Yc=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Sn?this.route:e===Ui?this.childContexts:this.parent.get(e,t)}},Wo=new G(""),_g=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=to([i.queryParams,i.params,i.data]).pipe(qe(([o,a,u],c)=>(u=D(D(D({},o),a),u),c===0?x(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=Np(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function qI(n,e,t){let r=Vi(n,e._root,t?t._root:void 0);return new qo(r,e)}function Vi(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=BI(n,e,t);return new Be(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Vi(n,a)),o}}let r=$I(e.value),i=e.children.map(s=>Vi(n,s));return new Be(r,i)}}function BI(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Vi(n,r,i);return Vi(n,r)})}function $I(n){return new Sn(new Ke(n.url),new Ke(n.params),new Ke(n.queryParams),new Ke(n.fragment),new Ke(n.data),n.outlet,n.component,n)}var qg="ngNavigationCancelingError";function Bg(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=fr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=$g(!1,Ye.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function $g(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[qg]=!0,t.cancellationCode=e,t}function zI(n){return zg(n)&&fr(n.url)}function zg(n){return!!n&&n[qg]}var GI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Zf({type:e,selectors:[["ng-component"]],standalone:!0,features:[Sp],decls:1,vars:0,template:function(i,s){i&1&&Ip(0,"router-outlet")},dependencies:[jI],encapsulation:2});let n=e;return n})();function KI(n,e){return n.providers&&!n._injector&&(n._injector=sc(n.providers,e,`Route: ${n.path}`)),n._injector??e}function sl(n){let e=n.children&&n.children.map(sl),t=e?Me(D({},n),{children:e}):D({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==U&&(t.component=GI),t}function ft(n){return n.outlet||U}function WI(n,e){let t=n.filter(r=>ft(r)===e);return t.push(...n.filter(r=>ft(r)!==e)),t}function ji(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var QI=(n,e,t,r)=>W(i=>(new Xc(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Xc=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Pc(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=cr(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=cr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=cr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=cr(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Gc(s.value.snapshot))}),e.children.length&&this.forwardEvent(new $c(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Pc(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Pc(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=ji(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},$o=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},hr=class{constructor(e,t){this.component=e,this.route=t}};function HI(n,e,t){let r=n._root,i=e?e._root:null;return Ai(r,i,t,[r.value])}function YI(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function mr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!tp(n)?n:e.get(n):r}function Ai(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=cr(e);return n.children.forEach(o=>{XI(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Ci(a,t.getContext(o),i)),i}function XI(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=JI(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new $o(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ai(n,e,a?a.children:null,r,i):Ai(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new hr(a.outlet.component,o))}else o&&Ci(e,a,i),i.canActivateChecks.push(new $o(r)),s.component?Ai(n,null,a?a.children:null,r,i):Ai(n,null,t,r,i);return i}function JI(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Rn(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Rn(n.url,e.url)||!dt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Hc(n,e)||!dt(n.queryParams,e.queryParams);case"paramsChange":default:return!Hc(n,e)}}function Ci(n,e,t){let r=cr(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Ci(o,e.children.getContext(s),t):Ci(o,null,t):Ci(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new hr(e.outlet.component,i)):t.canDeactivateChecks.push(new hr(null,i)):t.canDeactivateChecks.push(new hr(null,i))}function qi(n){return typeof n=="function"}function ZI(n){return typeof n=="boolean"}function eE(n){return n&&qi(n.canLoad)}function tE(n){return n&&qi(n.canActivate)}function nE(n){return n&&qi(n.canActivateChild)}function rE(n){return n&&qi(n.canDeactivate)}function iE(n){return n&&qi(n.canMatch)}function Gg(n){return n instanceof Kf||n?.name==="EmptyError"}var xo=Symbol("INITIAL_VALUE");function gr(){return qe(n=>to(n.map(e=>e.pipe(nr(1),Xf(xo)))).pipe(W(e=>{for(let t of e)if(t!==!0){if(t===xo)return xo;if(t===!1||t instanceof zt)return t}return!0}),St(e=>e!==xo),nr(1)))}function sE(n,e){return je(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?x(Me(D({},t),{guardsResult:!0})):oE(o,r,i,n).pipe(je(a=>a&&ZI(a)?aE(r,s,n,e):x(a)),W(a=>Me(D({},t),{guardsResult:a})))})}function oE(n,e,t,r){return Pe(n).pipe(je(i=>dE(i.component,i.route,t,e,r)),qt(i=>i!==!0,!0))}function aE(n,e,t,r){return Pe(e).pipe(jt(i=>Wf(cE(i.route.parent,r),uE(i.route,r),hE(n,i.path,t),lE(n,i.route,t))),qt(i=>i!==!0,!0))}function uE(n,e){return n!==null&&e&&e(new zc(n)),x(!0)}function cE(n,e){return n!==null&&e&&e(new Bc(n)),x(!0)}function lE(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return x(!0);let i=r.map(s=>Yu(()=>{let o=ji(e)??t,a=mr(s,o),u=tE(a)?a.canActivate(e,n):lt(o,()=>a(e,n));return Wt(u).pipe(qt())}));return x(i).pipe(gr())}function hE(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>YI(o)).filter(o=>o!==null).map(o=>Yu(()=>{let a=o.guards.map(u=>{let c=ji(o.node)??t,l=mr(u,c),h=nE(l)?l.canActivateChild(r,n):lt(c,()=>l(r,n));return Wt(h).pipe(qt())});return x(a).pipe(gr())}));return x(s).pipe(gr())}function dE(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return x(!0);let o=s.map(a=>{let u=ji(e)??i,c=mr(a,u),l=rE(c)?c.canDeactivate(n,e,t,r):lt(u,()=>c(n,e,t,r));return Wt(l).pipe(qt())});return x(o).pipe(gr())}function fE(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return x(!0);let s=i.map(o=>{let a=mr(o,n),u=eE(a)?a.canLoad(e,t):lt(n,()=>a(e,t));return Wt(u)});return x(s).pipe(gr(),Kg(r))}function Kg(n){return Bf(de(e=>{if(fr(e))throw Bg(n,e)}),W(e=>e===!0))}function pE(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return x(!0);let s=i.map(o=>{let a=mr(o,n),u=iE(a)?a.canMatch(e,t):lt(n,()=>a(e,t));return Wt(u)});return x(s).pipe(gr(),Kg(r))}var Oi=class{constructor(e){this.segmentGroup=e||null}},zo=class extends Error{constructor(e){super(),this.urlTree=e}};function ur(n){return ci(new Oi(n))}function gE(n){return ci(new te(4e3,!1))}function mE(n){return ci($g(!1,Ye.GuardRejected))}var Jc=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return x(r);if(i.numberOfChildren>1||!i.children[U])return gE(e.redirectTo);i=i.children[U]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new zo(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new zt(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new Q(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new te(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Zc={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function yE(n,e,t,r,i){let s=ol(n,e,t);return s.matched?(r=KI(e,r),pE(r,e,t,i).pipe(W(o=>o===!0?s:D({},Zc)))):x(s)}function ol(n,e,t){if(e.path==="**")return vE(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?D({},Zc):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||fI)(t,n,e);if(!i)return D({},Zc);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?D(D({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function vE(n){return{matched:!0,parameters:n.length>0?Rg(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function wg(n,e,t,r){return t.length>0&&IE(n,t,r)?{segmentGroup:new Q(e,wE(r,new Q(t,n.children))),slicedSegments:[]}:t.length===0&&EE(n,t,r)?{segmentGroup:new Q(n.segments,_E(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Q(n.segments,n.children),slicedSegments:t}}function _E(n,e,t,r){let i={};for(let s of t)if(Qo(n,e,s)&&!r[ft(s)]){let o=new Q([],{});i[ft(s)]=o}return D(D({},r),i)}function wE(n,e){let t={};t[U]=e;for(let r of n)if(r.path===""&&ft(r)!==U){let i=new Q([],{});t[ft(r)]=i}return t}function IE(n,e,t){return t.some(r=>Qo(n,e,r)&&ft(r)!==U)}function EE(n,e,t){return t.some(r=>Qo(n,e,r))}function Qo(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function TE(n,e,t,r){return ft(n)!==r&&(r===U||!Qo(e,t,n))?!1:ol(e,n,t).matched}function AE(n,e,t){return e.length===0&&!n.children[t]}var el=class{};function RE(n,e,t,r,i,s,o="emptyOnly"){return new tl(n,e,t,r,i,o,s).recognize()}var SE=31,tl=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Jc(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new te(4002,`'${e.segmentGroup}'`)}recognize(){let e=wg(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(W(t=>{let r=new Mi([],Object.freeze({}),Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,{},U,this.rootComponentType,null,{}),i=new Be(r,t),s=new Bo("",i),o=NI(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,U).pipe(tr(r=>{if(r instanceof zo)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Oi?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=rl(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(W(s=>s instanceof Be?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Pe(i).pipe(jt(s=>{let o=r.children[s],a=WI(t,s);return this.processSegmentGroup(e,a,o,s)}),Yf((s,o)=>(s.push(...o),s)),Xu(null),Hf(),je(s=>{if(s===null)return ur(r);let o=Wg(s);return bE(o),x(o)}))}processSegment(e,t,r,i,s,o){return Pe(t).pipe(jt(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(tr(u=>{if(u instanceof Oi)return x(null);throw u}))),qt(a=>!!a),tr(a=>{if(Gg(a))return AE(r,i,s)?x(new el):ur(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return TE(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):ur(i):ur(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=ol(t,i,s);if(!a)return ur(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>SE&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(je(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=yE(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(qe(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(qe(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new Mi(l,d,Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,PE(r),ft(r),r.component??r._loadedComponent??null,r,DE(r)),{segmentGroup:I,slicedSegments:w}=wg(t,l,h,u);if(w.length===0&&I.hasChildren())return this.processChildren(c,u,I).pipe(W(R=>R===null?null:new Be(f,R)));if(u.length===0&&w.length===0)return x(new Be(f,[]));let y=ft(r)===s;return this.processSegment(c,u,I,w,y?U:s,!0).pipe(W(R=>new Be(f,R instanceof Be?[R]:[])))}))):ur(t)))}getChildConfig(e,t,r){return t.children?x({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?x({routes:t._loadedRoutes,injector:t._loadedInjector}):fE(e,t,r,this.urlSerializer).pipe(je(i=>i?this.configLoader.loadChildren(e,t).pipe(de(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):mE(t))):x({routes:[],injector:e})}};function bE(n){n.sort((e,t)=>e.value.outlet===U?-1:t.value.outlet===U?1:e.value.outlet.localeCompare(t.value.outlet))}function CE(n){let e=n.value.routeConfig;return e&&e.path===""}function Wg(n){let e=[],t=new Set;for(let r of n){if(!CE(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=Wg(r.children);e.push(new Be(r.value,i))}return e.filter(r=>!t.has(r))}function PE(n){return n.data||{}}function DE(n){return n.resolve||{}}function xE(n,e,t,r,i,s){return je(o=>RE(n,e,t,r,o.extractedUrl,i,s).pipe(W(({state:a,tree:u})=>Me(D({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function NE(n,e){return je(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return x(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of Qg(u))o.add(c);let a=0;return Pe(o).pipe(jt(u=>s.has(u)?kE(u,r,n,e):(u.data=rl(u,u.parent,n).resolve,x(void 0))),de(()=>a++),Ju(1),je(u=>a===o.size?x(t):vn))})}function Qg(n){let e=n.children.map(t=>Qg(t)).flat();return[n,...e]}function kE(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!jg(i)&&(s[Li]=i.title),ME(s,n,e,r).pipe(W(o=>(n._resolvedData=o,n.data=rl(n,n.parent,t).resolve,null)))}function ME(n,e,t,r){let i=Nc(n);if(i.length===0)return x({});let s={};return Pe(i).pipe(je(o=>VE(n[o],e,t,r).pipe(qt(),de(a=>{s[o]=a}))),Ju(1),Qf(s),tr(o=>Gg(o)?vn:ci(o)))}function VE(n,e,t,r){let i=ji(e)??r,s=mr(n,i),o=s.resolve?s.resolve(e,t):lt(i,()=>s(e,t));return Wt(o)}function Dc(n){return qe(e=>{let t=n(e);return t?Pe(t).pipe(W(()=>e)):x(e)})}var Hg=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===U);return i}getResolvedTitleForRoute(r){return r.data[Li]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(OE),providedIn:"root"});let n=e;return n})(),OE=(()=>{let e=class e extends Hg{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(V(pg))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Bi=new G("",{providedIn:"root",factory:()=>({})}),Go=new G(""),al=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=P(go)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return x(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=Wt(r.loadComponent()).pipe(W(Yg),de(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),_n(()=>{this.componentLoaders.delete(r)})),s=new Wu(i,()=>new Ut).pipe(Ku());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return x({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=LE(i,this.compiler,r,this.onLoadEndListener).pipe(_n(()=>{this.childrenLoaders.delete(i)})),a=new Wu(o,()=>new Ut).pipe(Ku());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function LE(n,e,t,r){return Wt(n.loadChildren()).pipe(W(Yg),je(i=>i instanceof _p||Array.isArray(i)?x(i):Pe(e.compileModuleAsync(i))),W(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Go,[],{optional:!0,self:!0}).flat()),{routes:o.map(sl),injector:s}}))}function FE(n){return n&&typeof n=="object"&&"default"in n}function Yg(n){return FE(n)?n.default:n}var ul=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(UE),providedIn:"root"});let n=e;return n})(),UE=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Xg=new G(""),Jg=new G("");function jE(n,e,t){let r=n.get(Jg),i=n.get(Fe);return n.get(re).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),qE(n))),{onViewTransitionCreated:u}=r;return u&&lt(n,()=>u({transition:a,from:e,to:t})),o})}function qE(n){return new Promise(e=>{mp(e,{injector:n})})}var cl=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ut,this.transitionAbortSubject=new Ut,this.configLoader=P(al),this.environmentInjector=P(wn),this.urlSerializer=P(Fi),this.rootContexts=P(Ui),this.location=P(gi),this.inputBindingEnabled=P(Wo,{optional:!0})!==null,this.titleStrategy=P(Hg),this.options=P(Bi,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=P(ul),this.createViewTransition=P(Xg,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>x(void 0),this.rootComponentType=null;let r=s=>this.events.next(new jc(s)),i=s=>this.events.next(new qc(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(Me(D(D({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new Ke({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:bi,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(St(o=>o.id!==0),W(o=>Me(D({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),qe(o=>{this.currentTransition=o;let a=!1,u=!1;return x(o).pipe(de(c=>{this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?Me(D({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),qe(c=>{let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new Kt(c.id,this.urlSerializer.serialize(c.rawUrl),d,Lo.IgnoredSameUrlNavigation)),c.resolve(null),vn}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return x(c).pipe(qe(d=>{let f=this.transitions?.getValue();return this.events.next(new pr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?vn:Promise.resolve(d)}),xE(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),de(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=Me(D({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Fo(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:I,restoredState:w,extras:y}=c,R=new pr(d,this.urlSerializer.serialize(f),I,w);this.events.next(R);let N=Fg(this.rootComponentType).snapshot;return this.currentTransition=o=Me(D({},c),{targetSnapshot:N,urlAfterRedirects:f,extras:Me(D({},y),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,x(o)}else{let d="";return this.events.next(new Kt(c.id,this.urlSerializer.serialize(c.extractedUrl),d,Lo.IgnoredByUrlHandlingStrategy)),c.resolve(null),vn}}),de(c=>{let l=new Oc(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),W(c=>(this.currentTransition=o=Me(D({},c),{guards:HI(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),sE(this.environmentInjector,c=>this.events.next(c)),de(c=>{if(o.guardsResult=c.guardsResult,fr(c.guardsResult))throw Bg(this.urlSerializer,c.guardsResult);let l=new Lc(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),St(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",Ye.GuardRejected),!1)),Dc(c=>{if(c.guards.canActivateChecks.length)return x(c).pipe(de(l=>{let h=new Fc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),qe(l=>{let h=!1;return x(l).pipe(NE(this.paramsInheritanceStrategy,this.environmentInjector),de({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",Ye.NoDataFromResolver)}}))}),de(l=>{let h=new Uc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),Dc(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(de(f=>{h.component=f}),W(()=>{})));for(let f of h.children)d.push(...l(f));return d};return to(l(c.targetSnapshot.root)).pipe(Xu(null),nr(1))}),Dc(()=>this.afterPreactivation()),qe(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?Pe(h).pipe(W(()=>o)):x(o)}),W(c=>{let l=qI(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=Me(D({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),de(()=>{this.events.next(new Ni)}),QI(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),nr(1),de({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new it(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),Jf(this.transitionAbortSubject.pipe(de(c=>{throw c}))),_n(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",Ye.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),tr(c=>{if(u=!0,zg(c))this.events.next(new Gt(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),zI(c)?this.events.next(new ki(c.url)):o.resolve(!1);else{this.events.next(new xi(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return vn}))}))}cancelNavigationTransition(r,i,s){let o=new Gt(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function BE(n){return n!==bi}var $E=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(zE),providedIn:"root"});let n=e;return n})(),nl=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},zE=(()=>{let e=class e extends nl{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=nc(e)))(s||e)}})(),e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Zg=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:()=>P(GE),providedIn:"root"});let n=e;return n})(),GE=(()=>{let e=class e extends Zg{constructor(){super(...arguments),this.location=P(gi),this.urlSerializer=P(Fi),this.options=P(Bi,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=P(ul),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new zt,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Fg(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof pr)this.stateMemento=this.createStateMemento();else if(r instanceof Kt)this.rawUrlTree=i.initialUrl;else if(r instanceof Fo){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Ni?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Gt&&(r.code===Ye.GuardRejected||r.code===Ye.NoDataFromResolver)?this.restoreHistory(i):r instanceof xi?this.restoreHistory(i,!0):r instanceof it&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=D(D({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=D(D({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=nc(e)))(s||e)}})(),e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ri=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Ri||{});function em(n,e){n.events.pipe(St(t=>t instanceof it||t instanceof Gt||t instanceof xi||t instanceof Kt),W(t=>t instanceof it||t instanceof Kt?Ri.COMPLETE:(t instanceof Gt?t.code===Ye.Redirect||t.code===Ye.SupersededByNewNavigation:!1)?Ri.REDIRECTING:Ri.FAILED),St(t=>t!==Ri.REDIRECTING),nr(1)).subscribe(()=>{e()})}function KE(n){throw n}var WE={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},QE={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ct=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=P(lo),this.stateManager=P(Zg),this.options=P(Bi,{optional:!0})||{},this.pendingTasks=P(fi),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=P(cl),this.urlSerializer=P(Fi),this.location=P(gi),this.urlHandlingStrategy=P(ul),this._events=new Ut,this.errorHandler=this.options.errorHandler||KE,this.navigated=!1,this.routeReuseStrategy=P($E),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=P(Go,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!P(Wo,{optional:!0}),this.eventsSubscription=new qf,this.isNgZoneEnabled=P(re)instanceof re&&re.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Gt&&i.code!==Ye.Redirect&&i.code!==Ye.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof it)this.navigated=!0;else if(i instanceof ki){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||BE(s.source)};this.scheduleNavigation(a,bi,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}YE(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),bi,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=D({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(sl),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=D(D({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=Mg(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return Vg(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=fr(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,bi,null,i)}navigate(r,i={skipLocationChange:!1}){return HE(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=D({},WE):i===!1?s=D({},QE):s=i,fr(r))return gg(this.currentUrlTree,r,s);let o=this.parseUrl(r);return gg(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return em(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function HE(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new te(4008,!1)}function YE(n){return!(n instanceof Ni)&&!(n instanceof ki)}var Ig=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Ut,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof it&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:fp(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(nt(Ct),nt(Sn),sp("tabindex"),nt(ic),nt(ec),nt(pi))},e.\u0275dir=ro({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Ep("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&wp("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[no.HasDecoratorInputTransform,"preserveFragment","preserveFragment",mo],skipLocationChange:[no.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",mo],replaceUrl:[no.HasDecoratorInputTransform,"replaceUrl","replaceUrl",mo],routerLink:"routerLink"},standalone:!0,features:[vp,oo]});let n=e;return n})(),Tb=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new rr,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof it&&this.update()})}ngAfterContentInit(){x(this.links.changes,x(null)).pipe(li()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Pe(r).pipe(li()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(r))})}isLinkActive(r){let i=XE(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(nt(Ct),nt(ec),nt(ic),nt(ao),nt(Ig,8))},e.\u0275dir=ro({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&Tp(o,Ig,5),i&2){let a;Ap(a=Rp())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[oo]});let n=e;return n})();function XE(n){return!!n.paths}var Ko=class{};var JE=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(St(r=>r instanceof it),jt(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=sc(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return Pe(s).pipe(li())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=x(null);let o=s.pipe(je(a=>a===null?x(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return Pe([o,a]).pipe(li())}else return o})}};e.\u0275fac=function(i){return new(i||e)(V(Ct),V(go),V(wn),V(Ko),V(al))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),tm=new G(""),ZE=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof pr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof it?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Kt&&r.code===Lo.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Uo&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Uo(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){pp()},e.\u0275prov=q({token:e,factory:e.\u0275fac});let n=e;return n})();function eT(n){return n.routerState.root}function $i(n,e){return{\u0275kind:n,\u0275providers:e}}function tT(){let n=P(In);return e=>{let t=n.get(po);if(e!==t.components[0])return;let r=n.get(Ct),i=n.get(nm);n.get(ll)===1&&r.initialNavigation(),n.get(rm,null,Zu.Optional)?.setUpPreloading(),n.get(tm,null,Zu.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var nm=new G("",{factory:()=>new Ut}),ll=new G("",{providedIn:"root",factory:()=>1});function nT(){return $i(2,[{provide:ll,useValue:0},{provide:ac,multi:!0,deps:[In],useFactory:e=>{let t=e.get(Vp,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Ct),s=e.get(nm);em(i,()=>{r(!0)}),e.get(cl).afterPreactivation=()=>(r(!0),s.closed?x(void 0):s),i.initialNavigation()}))}}])}function rT(){return $i(3,[{provide:ac,multi:!0,useFactory:()=>{let e=P(Ct);return()=>{e.setUpLocationChangeListener()}}},{provide:ll,useValue:2}])}var rm=new G("");function iT(n){return $i(0,[{provide:rm,useExisting:JE},{provide:Ko,useExisting:n}])}function sT(){return $i(8,[_g,{provide:Wo,useExisting:_g}])}function oT(n){let e=[{provide:Xg,useValue:jE},{provide:Jg,useValue:D({skipNextTransition:!!n?.skipInitialTransition},n)}];return $i(9,e)}var Eg=new G("ROUTER_FORROOT_GUARD"),aT=[gi,{provide:Fi,useClass:Pi},Ct,Ui,{provide:Sn,useFactory:eT,deps:[Ct]},al,[]],Ab=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[aT,[],{provide:Go,multi:!0,useValue:r},{provide:Eg,useFactory:hT,deps:[[Ct,new He,new rp]]},{provide:Bi,useValue:i||{}},i?.useHash?cT():lT(),uT(),i?.preloadingStrategy?iT(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?dT(i):[],i?.bindToComponentInputs?sT().\u0275providers:[],i?.enableViewTransitions?oT().\u0275providers:[],fT()]}}static forChild(r){return{ngModule:e,providers:[{provide:Go,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(V(Eg,8))},e.\u0275mod=We({type:e}),e.\u0275inj=Qe({});let n=e;return n})();function uT(){return{provide:tm,useFactory:()=>{let n=P(jp),e=P(re),t=P(Bi),r=P(cl),i=P(Fi);return t.scrollOffset&&n.setOffset(t.scrollOffset),new ZE(i,r,n,e,t)}}}function cT(){return{provide:pi,useClass:Lp}}function lT(){return{provide:pi,useClass:Op}}function hT(n){return"guarded"}function dT(n){return[n.initialNavigation==="disabled"?rT().\u0275providers:[],n.initialNavigation==="enabledBlocking"?nT().\u0275providers:[]]}var Tg=new G("");function fT(){return[{provide:Tg,useFactory:tT},{provide:uc,multi:!0,useExisting:Tg}]}var pT="firebase",gT="10.10.0";rt(pT,gT,"app");var Qt=new uo("ANGULARFIRE2_VERSION");function im(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var dl=(n,e)=>{let t=e?[e]:Io(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Ho=class{constructor(){return dl(mT)}},mT="app-check";function yr(){}var Yo=class{zone;delegate;constructor(e,t=zf){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},hl=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",yr,{},yr,yr)),t.pipe(de({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Xo=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Yo(Zone.current)),this.insideAngular=t.run(()=>new Yo(Zone.current,$f)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(V(re))};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Jo(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function yT(n){return Jo().ngZone.runOutsideAngular(()=>n())}function bn(n){return Jo().ngZone.run(()=>n())}function vT(n){return _T(Jo())(n)}function _T(n){return function(t){return t=t.lift(new hl(n.ngZone)),t.pipe(Hu(n.outsideAngular),Qu(n.insideAngular))}}var wT=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),bn(()=>n.apply(void 0,r))},Zo=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=bn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",yr,{},yr,yr))),r[s]=wT(r[s],t));let i=yT(()=>n.apply(this,r));if(!e)if(i instanceof ui){let s=Jo();return i.pipe(Hu(s.outsideAngular),Qu(s.insideAngular))}else return bn(()=>i);return i instanceof ui?i.pipe(vT):i instanceof Promise?bn(()=>new Promise((s,o)=>i.then(a=>bn(()=>s(a)),a=>bn(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:bn(()=>i)};var Cn=class{constructor(e){return e}},zi=class{constructor(){return Io()}};function IT(n){return n&&n.length===1?n[0]:new Cn(wo())}var fl=new G("angularfire2._apps"),ET={provide:Cn,useFactory:IT,deps:[[new He,fl]]},TT={provide:zi,deps:[[new He,fl]]};function AT(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Cn(r)}}var RT=(()=>{class n{constructor(t){rt("angularfire",Qt.full,"core"),rt("angularfire",Qt.full,"app"),rt("angular",co.full,t.toString())}static \u0275fac=function(r){return new(r||n)(V(tt))};static \u0275mod=We({type:n});static \u0275inj=Qe({providers:[ET,TT]})}return n})();function zb(n,...e){return{ngModule:RT,providers:[{provide:fl,useFactory:AT(n),multi:!0,deps:[re,In,Xo,...e]}]}}var Gb=Zo(Yp,!0);var sm="auth",Gi=class{constructor(e){return e}},pl=class{constructor(){return dl(sm)}};var gl=new G("angularfire2.auth-instances");function RA(n,e){let t=im(sm,n,e);return t&&new Gi(t)}function SA(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Gi(r)}}var bA={provide:pl,deps:[[new He,gl]]},CA={provide:Gi,useFactory:RA,deps:[[new He,gl],Cn]},PA=(()=>{class n{constructor(){rt("angularfire",Qt.full,"auth")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=We({type:n});static \u0275inj=Qe({providers:[CA,bA]})}return n})();function FC(n,...e){return{ngModule:PA,providers:[{provide:gl,useFactory:SA(n),multi:!0,deps:[re,In,Xo,zi,[new He,Ho],...e]}]}}var UC=Zo(fc,!0);var DA="firebase",xA="10.10.0";bt.registerVersion(DA,xA,"app-compat");var NA=["ngOnDestroy"],YC=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(NA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var ea=class{constructor(e){return e}},am=new G("angularfire2.app.options"),um=new G("angularfire2.app.name");function kA(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=bt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>bt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;MA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ea(o)}var MA=(n,...e)=>{cc()&&typeof console<"u"&&console[n](...e)},VA={provide:ea,useFactory:kA,deps:[am,re,[new He,um]]},XC=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:am,useValue:t},{provide:um,useValue:r}]}}constructor(t){bt.registerVersion("angularfire",Qt.full,"core"),bt.registerVersion("angularfire",Qt.full,"app-compat"),bt.registerVersion("angular",co.full,t.toString())}static \u0275fac=function(r){return new(r||n)(V(tt))};static \u0275mod=We({type:n});static \u0275inj=Qe({providers:[VA]})}return n})();function JC(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return OA(i,o)||(om("error",`${e} was already initialized on the ${t} Firebase App with different settings.${LA?" You may need to reload as Firebase is not HMR aware.":""}`),om("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function OA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var LA=typeof module<"u"&&!!module.hot,om=(n,...e)=>{cc()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var FA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ot={},T,Ll=Ll||{},k=FA||self;function pa(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function ss(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function UA(n){return Object.prototype.hasOwnProperty.call(n,ml)&&n[ml]||(n[ml]=++jA)}var ml="closure_uid_"+(1e9*Math.random()>>>0),jA=0;function qA(n,e,t){return n.call.apply(n.bind,arguments)}function BA(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function De(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?De=qA:De=BA,De.apply(null,arguments)}function ta(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ee(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Ht(){this.s=this.s,this.o=this.o}var $A=0;Ht.prototype.s=!1;Ht.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),$A!=0)&&UA(this)};Ht.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Im=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Fl(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function cm(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(pa(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function xe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var zA=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};k.addEventListener("test",t,e),k.removeEventListener("test",t,e)}catch{}return n}();function Xi(n){return/^[\s\xa0]*$/.test(n)}function ga(){var n=k.navigator;return n&&(n=n.userAgent)?n:""}function pt(n){return ga().indexOf(n)!=-1}function Ul(n){return Ul[" "](n),n}Ul[" "]=function(){};function GA(n,e){var t=k0;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var KA=pt("Opera"),Ir=pt("Trident")||pt("MSIE"),Em=pt("Edge"),Il=Em||Ir,Tm=pt("Gecko")&&!(ga().toLowerCase().indexOf("webkit")!=-1&&!pt("Edge"))&&!(pt("Trident")||pt("MSIE"))&&!pt("Edge"),WA=ga().toLowerCase().indexOf("webkit")!=-1&&!pt("Edge");function Am(){var n=k.document;return n?n.documentMode:void 0}var El;e:{if(na="",ra=function(){var n=ga();if(Tm)return/rv:([^\);]+)(\)|;)/.exec(n);if(Em)return/Edge\/([\d\.]+)/.exec(n);if(Ir)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(WA)return/WebKit\/(\S+)/.exec(n);if(KA)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),ra&&(na=ra?ra[1]:""),Ir&&(ia=Am(),ia!=null&&ia>parseFloat(na))){El=String(ia);break e}El=na}var na,ra,ia,Tl;k.document&&Ir?(yl=Am(),Tl=yl||parseInt(El,10)||void 0):Tl=void 0;var yl,QA=Tl;function Ji(n,e){if(xe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Tm){e:{try{Ul(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:HA[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ji.$.h.call(this)}}Ee(Ji,xe);var HA={2:"touch",3:"pen",4:"mouse"};Ji.prototype.h=function(){Ji.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var os="closure_listenable_"+(1e6*Math.random()|0),YA=0;function XA(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++YA,this.fa=this.ia=!1}function ma(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function jl(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function JA(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function Rm(n){let e={};for(let t in n)e[t]=n[t];return e}var lm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sm(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<lm.length;s++)t=lm[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function ya(n){this.src=n,this.g={},this.h=0}ya.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Rl(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new XA(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Al(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Im(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ma(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Rl(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var ql="closure_lm_"+(1e6*Math.random()|0),vl={};function bm(n,e,t,r,i){if(r&&r.once)return Pm(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)bm(n,e[s],t,r,i);return null}return t=zl(t),n&&n[os]?n.O(e,t,ss(r)?!!r.capture:!!r,i):Cm(n,e,t,!1,r,i)}function Cm(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=ss(i)?!!i.capture:!!i,a=$l(n);if(a||(n[ql]=a=new ya(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=ZA(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)zA||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(xm(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function ZA(){function n(t){return e.call(n.src,n.listener,t)}let e=e0;return n}function Pm(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Pm(n,e[s],t,r,i);return null}return t=zl(t),n&&n[os]?n.P(e,t,ss(r)?!!r.capture:!!r,i):Cm(n,e,t,!0,r,i)}function Dm(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Dm(n,e[s],t,r,i);else r=ss(r)?!!r.capture:!!r,t=zl(t),n&&n[os]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Rl(s,t,r,i),-1<t&&(ma(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=$l(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Rl(e,t,r,i)),(t=-1<n?e[n]:null)&&Bl(t))}function Bl(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[os])Al(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(xm(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=$l(e))?(Al(t,n),t.h==0&&(t.src=null,e[ql]=null)):ma(n)}}}function xm(n){return n in vl?vl[n]:vl[n]="on"+n}function e0(n,e){if(n.fa)n=!0;else{e=new Ji(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Bl(n),n=t.call(r,e)}return n}function $l(n){return n=n[ql],n instanceof ya?n:null}var _l="__closure_events_fn_"+(1e9*Math.random()>>>0);function zl(n){return typeof n=="function"?n:(n[_l]||(n[_l]=function(e){return n.handleEvent(e)}),n[_l])}function Ie(){Ht.call(this),this.i=new ya(this),this.S=this,this.J=null}Ee(Ie,Ht);Ie.prototype[os]=!0;Ie.prototype.removeEventListener=function(n,e,t,r){Dm(this,n,e,t,r)};function Se(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new xe(e,n);else if(e instanceof xe)e.target=e.target||n;else{var i=e;e=new xe(r,n),Sm(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=sa(o,r,!0,e)&&i}if(o=e.g=n,i=sa(o,r,!0,e)&&i,i=sa(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=sa(o,r,!1,e)&&i}Ie.prototype.N=function(){if(Ie.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)ma(t[r]);delete n.g[e],n.h--}}this.J=null};Ie.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Ie.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function sa(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&Al(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Gl=k.JSON.stringify,Sl=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function t0(){var n=Kl;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var bl=class{constructor(){this.h=this.g=null}add(e,t){let r=Nm.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Nm=new Sl(()=>new Cl,n=>n.reset()),Cl=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function n0(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function r0(n){k.setTimeout(()=>{throw n},0)}var Zi,es=!1,Kl=new bl,km=()=>{let n=k.Promise.resolve(void 0);Zi=()=>{n.then(i0)}},i0=()=>{for(var n;n=t0();){try{n.h.call(n.g)}catch(t){r0(t)}var e=Nm;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}es=!1};function va(n,e){Ie.call(this),this.h=n||1,this.g=e||k,this.j=De(this.qb,this),this.l=Date.now()}Ee(va,Ie);T=va.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Se(this,"tick"),this.ga&&(Wl(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Wl(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){va.$.N.call(this),Wl(this),delete this.g};function Ql(n,e,t){if(typeof n=="function")t&&(n=De(n,t));else if(n&&typeof n.handleEvent=="function")n=De(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:k.setTimeout(n,e||0)}function Mm(n){n.g=Ql(()=>{n.g=null,n.i&&(n.i=!1,Mm(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Pl=class extends Ht{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Mm(this)}N(){super.N(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function ts(n){Ht.call(this),this.h=n,this.g={}}Ee(ts,Ht);var hm=[];function Vm(n,e,t,r){Array.isArray(t)||(t&&(hm[0]=t.toString()),t=hm);for(var i=0;i<t.length;i++){var s=bm(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Om(n){jl(n.g,function(e,t){this.g.hasOwnProperty(t)&&Bl(e)},n),n.g={}}ts.prototype.N=function(){ts.$.N.call(this),Om(this)};ts.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function _a(){this.g=!0}_a.prototype.Ea=function(){this.g=!1};function s0(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function o0(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function _r(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+u0(n,t)+(r?" "+r:"")})}function a0(n,e){n.info(function(){return"TIMEOUT: "+e})}_a.prototype.info=function(){};function u0(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Gl(t)}catch{return e}}var Nn={},dm=null;function wa(){return dm=dm||new Ie}Nn.Ta="serverreachability";function Lm(n){xe.call(this,Nn.Ta,n)}Ee(Lm,xe);function ns(n){let e=wa();Se(e,new Lm(e))}Nn.STAT_EVENT="statevent";function Fm(n,e){xe.call(this,Nn.STAT_EVENT,n),this.stat=e}Ee(Fm,xe);function Ve(n){let e=wa();Se(e,new Fm(e,n))}Nn.Ua="timingevent";function Um(n,e){xe.call(this,Nn.Ua,n),this.size=e}Ee(Um,xe);function as(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){n()},e)}var Ia={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},jm={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Hl(){}Hl.prototype.h=null;function fm(n){return n.h||(n.h=n.i())}function qm(){}var us={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Yl(){xe.call(this,"d")}Ee(Yl,xe);function Xl(){xe.call(this,"c")}Ee(Xl,xe);var Dl;function Ea(){}Ee(Ea,Hl);Ea.prototype.g=function(){return new XMLHttpRequest};Ea.prototype.i=function(){return{}};Dl=new Ea;function cs(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new ts(this),this.P=c0,n=Il?125:void 0,this.V=new va(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Bm}function Bm(){this.i=null,this.g="",this.h=!1}var c0=45e3,$m={},xl={};T=cs.prototype;T.setTimeout=function(n){this.P=n};function Nl(n,e,t){n.L=1,n.A=Aa(Dt(e)),n.u=t,n.S=!0,zm(n,null)}function zm(n,e){n.G=Date.now(),ls(n),n.B=Dt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Jm(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Bm,n.g=_y(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Pl(De(n.Pa,n,n.g),n.O)),Vm(n.U,n.g,"readystatechange",n.nb),e=n.I?Rm(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),ns(),s0(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let e=this.M;e&&gt(n)==3?e.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)e:{let l=gt(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Il||this.g&&(this.h.h||this.g.ja()||ym(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?ns(3):ns(2)),Ta(this);var t=this.g.da();this.ca=t;t:if(Gm(this)){var r=ym(this.g);n="";var i=r.length,s=gt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Pn(this),Yi(this);var o="";break t}this.h.i=new k.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,o0(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Xi(a)){var c=a;break t}}c=null}if(t=c)_r(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kl(this,t);else{this.i=!1,this.s=3,Ve(12),Pn(this),Yi(this);break e}}this.S?(Km(this,l,o),Il&&this.i&&l==3&&(Vm(this.U,this.V,"tick",this.mb),this.V.start())):(_r(this.j,this.m,o,null),kl(this,o)),l==4&&Pn(this),this.i&&!this.J&&(l==4?gy(this.l,this):(this.i=!1,ls(this)))}else D0(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ve(12)):(this.s=0,Ve(13)),Pn(this),Yi(this)}}}catch{}finally{}};function Gm(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Km(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=l0(n,t),i==xl){e==4&&(n.s=4,Ve(14),r=!1),_r(n.j,n.m,null,"[Incomplete Response]");break}else if(i==$m){n.s=4,Ve(15),_r(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else _r(n.j,n.m,i,null),kl(n,i);Gm(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ve(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),rh(e),e.M=!0,Ve(11))):(_r(n.j,n.m,t,"[Invalid Chunked Response]"),Pn(n),Yi(n))}T.mb=function(){if(this.g){var n=gt(this.g),e=this.g.ja();this.o<e.length&&(Ta(this),Km(this,n,e),this.i&&n!=4&&ls(this))}};function l0(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?xl:(t=Number(e.substring(t,r)),isNaN(t)?$m:(r+=1,r+t>e.length?xl:(e=e.slice(r,r+t),n.o=r+t,e)))}T.cancel=function(){this.J=!0,Pn(this)};function ls(n){n.Y=Date.now()+n.P,Wm(n,n.P)}function Wm(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=as(De(n.lb,n),e)}function Ta(n){n.C&&(k.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(a0(this.j,this.B),this.L!=2&&(ns(),Ve(17)),Pn(this),this.s=2,Yi(this)):Wm(this,this.Y-n)};function Yi(n){n.l.H==0||n.J||gy(n.l,n)}function Pn(n){Ta(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Wl(n.V),Om(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function kl(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Ml(t.i,n))){if(!n.K&&Ml(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)la(t),ba(t);else break e;nh(t),Ve(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=as(De(t.ib,t),6e3));if(1>=ty(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Dn(t,11)}else if((n.K||t.g==n)&&la(t),!Xi(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let I=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(I){var s=r.i;s.g||I.indexOf("spdy")==-1&&I.indexOf("quic")==-1&&I.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Jl(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,Z(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=vy(r,r.J?r.pa:null,r.Y),o.K){ny(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Ta(a),ls(a)),r.g=o}else fy(r);0<t.j.length&&Ca(t)}else c[0]!="stop"&&c[0]!="close"||Dn(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Dn(t,7):th(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}ns(4)}catch{}}function h0(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(pa(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function d0(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(pa(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function Qm(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(pa(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=d0(n),r=h0(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var Hm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function f0(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function xn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof xn){this.h=n.h,ua(this,n.j),this.s=n.s,this.g=n.g,ca(this,n.m),this.l=n.l;var e=n.i,t=new rs;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),pm(this,t),this.o=n.o}else n&&(e=String(n).match(Hm))?(this.h=!1,ua(this,e[1]||"",!0),this.s=Qi(e[2]||""),this.g=Qi(e[3]||"",!0),ca(this,e[4]),this.l=Qi(e[5]||"",!0),pm(this,e[6]||"",!0),this.o=Qi(e[7]||"")):(this.h=!1,this.i=new rs(null,this.h))}xn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Hi(e,gm,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Hi(e,gm,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Hi(t,t.charAt(0)=="/"?m0:g0,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Hi(t,v0)),n.join("")};function Dt(n){return new xn(n)}function ua(n,e,t){n.j=t?Qi(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ca(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function pm(n,e,t){e instanceof rs?(n.i=e,_0(n.i,n.h)):(t||(e=Hi(e,y0)),n.i=new rs(e,n.h))}function Z(n,e,t){n.i.set(e,t)}function Aa(n){return Z(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Qi(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Hi(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,p0),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function p0(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var gm=/[#\/\?@]/g,g0=/[#\?:]/g,m0=/[#\?]/g,y0=/[#\?@]/g,v0=/#/g;function rs(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Yt(n){n.g||(n.g=new Map,n.h=0,n.i&&f0(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}T=rs.prototype;T.add=function(n,e){Yt(this),this.i=null,n=Er(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function Ym(n,e){Yt(n),e=Er(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Xm(n,e){return Yt(n),e=Er(n,e),n.g.has(e)}T.forEach=function(n,e){Yt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};T.ta=function(){Yt(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};T.Z=function(n){Yt(this);let e=[];if(typeof n=="string")Xm(this,n)&&(e=e.concat(this.g.get(Er(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};T.set=function(n,e){return Yt(this),this.i=null,n=Er(this,n),Xm(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};T.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Jm(n,e,t){Ym(n,e),0<t.length&&(n.i=null,n.g.set(Er(n,e),Fl(t)),n.h+=t.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Er(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function _0(n,e){e&&!n.j&&(Yt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Ym(this,r),Jm(this,i,t))},n)),n.j=e}var w0=class{constructor(n,e){this.g=n,this.map=e}};function Zm(n){this.l=n||I0,k.PerformanceNavigationTiming?(n=k.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var I0=10;function ey(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function ty(n){return n.h?1:n.g?n.g.size:0}function Ml(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Jl(n,e){n.g?n.g.add(e):n.h=e}function ny(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}Zm.prototype.cancel=function(){if(this.i=ry(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function ry(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Fl(n.i)}var E0=class{stringify(n){return k.JSON.stringify(n,void 0)}parse(n){return k.JSON.parse(n,void 0)}};function T0(){this.g=new E0}function A0(n,e,t){let r=t||"";try{Qm(n,function(i,s){let o=i;ss(i)&&(o=Gl(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function R0(n,e){let t=new _a;if(k.Image){let r=new Image;r.onload=ta(oa,t,r,"TestLoadImage: loaded",!0,e),r.onerror=ta(oa,t,r,"TestLoadImage: error",!1,e),r.onabort=ta(oa,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=ta(oa,t,r,"TestLoadImage: timeout",!1,e),k.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function oa(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function hs(n){this.l=n.ec||null,this.j=n.ob||!1}Ee(hs,Hl);hs.prototype.g=function(){return new Ra(this.l,this.j)};hs.prototype.i=function(n){return function(){return n}}({});function Ra(n,e){Ie.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Zl,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ee(Ra,Ie);var Zl=0;T=Ra.prototype;T.open=function(n,e){if(this.readyState!=Zl)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,is(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||k).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ds(this)),this.readyState=Zl};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,is(this)),this.g&&(this.readyState=3,is(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof k.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;iy(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function iy(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ds(this):is(this),this.readyState==3&&iy(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,ds(this))};T.Ya=function(n){this.g&&(this.response=n,ds(this))};T.ka=function(){this.g&&ds(this)};function ds(n){n.readyState=4,n.l=null,n.j=null,n.A=null,is(n)}T.setRequestHeader=function(n,e){this.v.append(n,e)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function is(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Ra.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var S0=k.JSON.parse;function ie(n){Ie.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=sy,this.L=this.M=!1}Ee(ie,Ie);var sy="",b0=/^https?$/i,C0=["POST","PUT"];T=ie.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Dl.g(),this.C=this.u?fm(this.u):fm(Dl),this.g.onreadystatechange=De(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){mm(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=k.FormData&&n instanceof k.FormData,!(0<=Im(C0,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{uy(this),0<this.B&&((this.L=P0(this.g))?(this.g.timeout=this.B,this.g.ontimeout=De(this.ua,this)):this.A=Ql(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){mm(this,s)}};function P0(n){return Ir&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof Ll<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))};function mm(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,oy(n),Sa(n)}function oy(n){n.F||(n.F=!0,Se(n,"complete"),Se(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Se(this,"complete"),Se(this,"abort"),Sa(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sa(this,!0)),ie.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?ay(this):this.kb())};T.kb=function(){ay(this)};function ay(n){if(n.h&&typeof Ll<"u"&&(!n.C[1]||gt(n)!=4||n.da()!=2)){if(n.v&&gt(n)==4)Ql(n.La,0,n);else if(Se(n,"readystatechange"),gt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(Hm)[1]||null;!i&&k.self&&k.self.location&&(i=k.self.location.protocol.slice(0,-1)),r=!b0.test(i?i.toLowerCase():"")}t=r}if(t)Se(n,"complete"),Se(n,"success");else{n.m=6;try{var s=2<gt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",oy(n)}}finally{Sa(n)}}}}function Sa(n,e){if(n.g){uy(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Se(n,"ready");try{t.onreadystatechange=r}catch{}}}function uy(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(k.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function gt(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<gt(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),S0(e)}};function ym(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case sy:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function D0(n){let e={};n=(n.g&&2<=gt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Xi(n[r]))continue;var t=n0(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}JA(e,function(r){return r.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function cy(n){let e="";return jl(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function eh(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=cy(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Z(n,e,t))}function Ki(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function ly(n){this.Ga=0,this.j=[],this.l=new _a,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ki("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ki("baseRetryDelayMs",5e3,n),this.hb=Ki("retryDelaySeedMs",1e4,n),this.eb=Ki("forwardChannelMaxRetries",2,n),this.xa=Ki("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Zm(n&&n.concurrentRequestLimit),this.Ja=new T0,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=ly.prototype;T.ra=8;T.H=1;function th(n){if(hy(n),n.H==3){var e=n.W++,t=Dt(n.I);if(Z(t,"SID",n.K),Z(t,"RID",e),Z(t,"TYPE","terminate"),fs(n,t),e=new cs(n,n.l,e),e.L=2,e.A=Aa(Dt(t)),t=!1,k.navigator&&k.navigator.sendBeacon)try{t=k.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&k.Image&&(new Image().src=e.A,t=!0),t||(e.g=_y(e.l,null),e.g.ha(e.A)),e.G=Date.now(),ls(e)}yy(n)}function ba(n){n.g&&(rh(n),n.g.cancel(),n.g=null)}function hy(n){ba(n),n.u&&(k.clearTimeout(n.u),n.u=null),la(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&k.clearTimeout(n.m),n.m=null)}function Ca(n){if(!ey(n.i)&&!n.m){n.m=!0;var e=n.Na;Zi||km(),es||(Zi(),es=!0),Kl.add(e,n),n.C=0}}function x0(n,e){return ty(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=as(De(n.Na,n,e),my(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new cs(this,this.l,n),s=this.s;if(this.U&&(s?(s=Rm(s),Sm(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=dy(this,i,e),t=Dt(this.I),Z(t,"RID",n),Z(t,"CVER",22),this.F&&Z(t,"X-HTTP-Session-Id",this.F),fs(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(cy(s)))+"&"+e:this.o&&eh(t,this.o,s)),Jl(this.i,i),this.bb&&Z(t,"TYPE","init"),this.P?(Z(t,"$req",e),Z(t,"SID","null"),i.aa=!0,Nl(i,t,null)):Nl(i,t,e),this.H=2}}else this.H==3&&(n?vm(this,n):this.j.length==0||ey(this.i)||vm(this))};function vm(n,e){var t;e?t=e.m:t=n.W++;let r=Dt(n.I);Z(r,"SID",n.K),Z(r,"RID",t),Z(r,"AID",n.V),fs(n,r),n.o&&n.s&&eh(r,n.o,n.s),t=new cs(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=dy(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Jl(n.i,t),Nl(t,r,e)}function fs(n,e){n.na&&jl(n.na,function(t,r){Z(e,r,t)}),n.h&&Qm({},function(t,r){Z(e,r,t)})}function dy(n,e,t){t=Math.min(n.j.length,t);var r=n.h?De(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{A0(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function fy(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Zi||km(),es||(Zi(),es=!0),Kl.add(e,n),n.A=0}}function nh(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=as(De(n.Ma,n),my(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,py(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=as(De(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ve(10),ba(this),py(this))};function rh(n){n.B!=null&&(k.clearTimeout(n.B),n.B=null)}function py(n){n.g=new cs(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Dt(n.wa);Z(e,"RID","rpc"),Z(e,"SID",n.K),Z(e,"AID",n.V),Z(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Z(e,"TO",n.qa),Z(e,"TYPE","xmlhttp"),fs(n,e),n.o&&n.s&&eh(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Aa(Dt(e)),t.u=null,t.S=!0,zm(t,n)}T.ib=function(){this.v!=null&&(this.v=null,ba(this),nh(this),Ve(19))};function la(n){n.v!=null&&(k.clearTimeout(n.v),n.v=null)}function gy(n,e){var t=null;if(n.g==e){la(n),rh(n),n.g=null;var r=2}else if(Ml(n.i,e))t=e.F,ny(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=wa(),Se(r,new Um(r,t)),Ca(n)}else fy(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&x0(n,e)||r==2&&nh(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Dn(n,5);break;case 4:Dn(n,10);break;case 3:Dn(n,6);break;default:Dn(n,2)}}}function my(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Dn(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=De(n.pb,n);t||(t=new xn("//www.google.com/images/cleardot.gif"),k.location&&k.location.protocol=="http"||ua(t,"https"),Aa(t)),R0(t.toString(),r)}else Ve(2);n.H=0,n.h&&n.h.za(e),yy(n),hy(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ve(2)):(this.l.info("Failed to ping google.com"),Ve(1))};function yy(n){if(n.H=0,n.ma=[],n.h){let e=ry(n.i);(e.length!=0||n.j.length!=0)&&(cm(n.ma,e),cm(n.ma,n.j),n.i.i.length=0,Fl(n.j),n.j.length=0),n.h.ya()}}function vy(n,e,t){var r=t instanceof xn?Dt(t):new xn(t);if(r.g!="")e&&(r.g=e+"."+r.g),ca(r,r.m);else{var i=k.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new xn(null);r&&ua(s,r),e&&(s.g=e),i&&ca(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Z(r,t,e),Z(r,"VER",n.ra),fs(n,r),r}function _y(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ie(new hs({ob:t})):new ie(n.va),e.Oa(n.J),e}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function wy(){}T=wy.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function ha(){if(Ir&&!(10<=Number(QA)))throw Error("Environmental error: no available transport.")}ha.prototype.g=function(n,e){return new $e(n,e)};function $e(n,e){Ie.call(this),this.g=new ly(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Xi(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Xi(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Tr(this)}Ee($e,Ie);$e.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ve(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=vy(n,null,n.Y),Ca(n)};$e.prototype.close=function(){th(this.g)};$e.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Gl(n),n=t);e.j.push(new w0(e.fb++,n)),e.H==3&&Ca(e)};$e.prototype.N=function(){this.g.h=null,delete this.j,th(this.g),delete this.g,$e.$.N.call(this)};function Iy(n){Yl.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Ee(Iy,Yl);function Ey(){Xl.call(this),this.status=1}Ee(Ey,Xl);function Tr(n){this.g=n}Ee(Tr,wy);Tr.prototype.Ba=function(){Se(this.g,"a")};Tr.prototype.Aa=function(n){Se(this.g,new Iy(n))};Tr.prototype.za=function(n){Se(this.g,new Ey)};Tr.prototype.ya=function(){Se(this.g,"b")};function N0(){this.blockSize=-1}function st(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Ee(st,N0);st.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function wl(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}st.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)wl(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){wl(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){wl(this,r),i=0;break}}this.h=i,this.i+=e};st.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function H(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var k0={};function ih(n){return-128<=n&&128>n?GA(n,function(e){return new H([e|0],0>e?-1:0)}):new H([n|0],0>n?-1:0)}function mt(n){if(isNaN(n)||!isFinite(n))return wr;if(0>n)return Re(mt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Vl;return new H(e,0)}function Ty(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Re(Ty(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=mt(Math.pow(e,8)),r=wr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=mt(Math.pow(e,s)),r=r.R(s).add(mt(o))):(r=r.R(t),r=r.add(mt(o)))}return r}var Vl=4294967296,wr=ih(0),Ol=ih(1),_m=ih(16777216);T=H.prototype;T.ea=function(){if(Je(this))return-Re(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Vl+r)*e,e*=Vl}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Pt(this))return"0";if(Je(this))return"-"+Re(this).toString(n);for(var e=mt(Math.pow(n,6)),t=this,r="";;){var i=fa(t,e).g;t=da(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Pt(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Pt(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function Je(n){return n.h==-1}T.X=function(n){return n=da(this,n),Je(n)?-1:Pt(n)?0:1};function Re(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new H(t,~n.h).add(Ol)}T.abs=function(){return Je(this)?Re(this):this};T.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new H(t,t[t.length-1]&-2147483648?-1:0)};function da(n,e){return n.add(Re(e))}T.R=function(n){if(Pt(this)||Pt(n))return wr;if(Je(this))return Je(n)?Re(this).R(Re(n)):Re(Re(this).R(n));if(Je(n))return Re(this.R(Re(n)));if(0>this.X(_m)&&0>n.X(_m))return mt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,aa(t,2*r+2*i),t[2*r+2*i+1]+=s*u,aa(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,aa(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,aa(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new H(t,0)};function aa(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Wi(n,e){this.g=n,this.h=e}function fa(n,e){if(Pt(e))throw Error("division by zero");if(Pt(n))return new Wi(wr,wr);if(Je(n))return e=fa(Re(n),e),new Wi(Re(e.g),Re(e.h));if(Je(e))return e=fa(n,Re(e)),new Wi(Re(e.g),e.h);if(30<n.g.length){if(Je(n)||Je(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Ol,r=e;0>=r.X(n);)t=wm(t),r=wm(r);var i=vr(t,1),s=vr(r,1);for(r=vr(r,2),t=vr(t,2);!Pt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=vr(r,1),t=vr(t,1)}return e=da(n,i.R(e)),new Wi(i,e)}for(i=wr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=mt(t),o=s.R(e);Je(o)||0<o.X(n);)t-=r,s=mt(t),o=s.R(e);Pt(s)&&(s=Ol),i=i.add(s),n=da(n,o)}return new Wi(i,n)}T.gb=function(n){return fa(this,n).h};T.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new H(t,this.h&n.h)};T.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new H(t,this.h|n.h)};T.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new H(t,this.h^n.h)};function wm(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new H(t,n.h)}function vr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new H(i,n.h)}ha.prototype.createWebChannel=ha.prototype.g;$e.prototype.send=$e.prototype.u;$e.prototype.open=$e.prototype.m;$e.prototype.close=$e.prototype.close;Ia.NO_ERROR=0;Ia.TIMEOUT=8;Ia.HTTP_ERROR=6;jm.COMPLETE="complete";qm.EventType=us;us.OPEN="a";us.CLOSE="b";us.ERROR="c";us.MESSAGE="d";Ie.prototype.listen=Ie.prototype.O;ie.prototype.listenOnce=ie.prototype.P;ie.prototype.getLastError=ie.prototype.Sa;ie.prototype.getLastErrorCode=ie.prototype.Ia;ie.prototype.getStatus=ie.prototype.da;ie.prototype.getResponseJson=ie.prototype.Wa;ie.prototype.getResponseText=ie.prototype.ja;ie.prototype.send=ie.prototype.ha;ie.prototype.setWithCredentials=ie.prototype.Oa;st.prototype.digest=st.prototype.l;st.prototype.reset=st.prototype.reset;st.prototype.update=st.prototype.j;H.prototype.add=H.prototype.add;H.prototype.multiply=H.prototype.R;H.prototype.modulo=H.prototype.gb;H.prototype.compare=H.prototype.X;H.prototype.toNumber=H.prototype.ea;H.prototype.toString=H.prototype.toString;H.prototype.getBits=H.prototype.D;H.fromNumber=mt;H.fromString=Ty;var Ay=ot.createWebChannelTransport=function(){return new ha},Ry=ot.getStatEventTarget=function(){return wa()},Pa=ot.ErrorCode=Ia,Sy=ot.EventType=jm,by=ot.Event=Nn,sh=ot.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},eP=ot.FetchXmlHttpFactory=hs,ps=ot.WebChannel=qm,Cy=ot.XhrIo=ie,Py=ot.Md5=st,kn=ot.Integer=H;var Dy="@firebase/firestore";var ge=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ge.UNAUTHENTICATED=new ge(null),ge.GOOGLE_CREDENTIALS=new ge("google-credentials-uid"),ge.FIRST_PARTY=new ge("first-party-uid"),ge.MOCK_USER=new ge("mock-user");var ni="10.10.0";var nn=new Kp("@firebase/firestore");function Cr(){return nn.logLevel}function lP(n){nn.setLogLevel(n)}function v(n,...e){if(nn.logLevel<=ht.DEBUG){let t=e.map(cf);nn.debug(`Firestore (${ni}): ${n}`,...t)}}function ae(n,...e){if(nn.logLevel<=ht.ERROR){let t=e.map(cf);nn.error(`Firestore (${ni}): ${n}`,...t)}}function Et(n,...e){if(nn.logLevel<=ht.WARN){let t=e.map(cf);nn.warn(`Firestore (${ni}): ${n}`,...t)}}function cf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function S(n="Unexpected state"){let e=`FIRESTORE (${ni}) INTERNAL ASSERTION FAILED: `+n;throw ae(e),new Error(e)}function b(n,e){n||S()}function hP(n,e){n||S()}function E(n,e){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends zp{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var me=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ja=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},lh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ge.UNAUTHENTICATED))}shutdown(){}},hh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},dh=class{constructor(e){this.t=e,this.currentUser=ge.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new me;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new me,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>m(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new me)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b(typeof r.accessToken=="string"),new ja(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return b(e===null||typeof e=="string"),new ge(e)}},fh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ge.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ph=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new fh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ge.FIRST_PARTY))}shutdown(){}invalidateToken(){}},gh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},mh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b(typeof t.token=="string"),this.R=t.token,new gh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function M0(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var qa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=M0(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function O(n,e){return n<e?-1:n>e?1:0}function Fr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function xv(n){return n+"\0"}var ue=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?O(this.nanoseconds,e.nanoseconds):O(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var C=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ue(0,0))}static max(){return new n(new ue(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ba=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&S(),r===void 0?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},$=class n extends Ba{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},V0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_e=class n extends Ba{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return V0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var A=class n{constructor(e){this.path=e}static fromPath(e){return new n($.fromString(e))}static fromName(e){return new n($.fromString(e).popFirst(5))}static empty(){return new n($.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return $.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new $(e.slice()))}};var Ur=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function yh(n){return n.fields.find(e=>e.kind===2)}function Vn(n){return n.fields.filter(e=>e.kind!==2)}Ur.UNKNOWN_ID=-1;var Mr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ss=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,et.min())}};function Nv(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=C.fromTimestamp(r===1e9?new ue(t+1,0):new ue(t,r));return new et(i,A.empty(),e)}function kv(n){return new et(n.readTime,n.key,-1)}var et=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(C.min(),A.empty(),-1)}static max(){return new n(C.max(),A.empty(),-1)}};function lf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=A.comparator(n.documentKey,e.documentKey),t!==0?t:O(n.largestBatchId,e.largestBatchId))}var Mv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$a=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gn(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==Mv)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var za=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new me,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new qn(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=hf(r.target.error);this.V.reject(new qn(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new qn(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new _h(t)}},kt=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(mi())===12.2&&ae("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),On(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!$p())return!1;if(n.C())return!0;let e=mi(),t=n.S(e),r=0<t&&t<10,i=n.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return m(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new qn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new qn(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db})}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=za.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},vh=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return On(this.k.delete())}},qn=class extends _{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function mn(n){return n.name==="IndexedDbTransactionError"}var _h=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),On(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),On(this.store.add(e))}get(e){return On(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),On(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),On(this.store.count())}W(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.G(i,t)}Z(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=hf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new vh(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function On(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=hf(r.target.error);t(i)}})}var xy=!1;function hf(n){let e=kt.S(mi());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return xy||(xy=!0,setTimeout(()=>{throw r},0)),r}}return n}var wh=class{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(t){mn(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield gn(t)}yield this.ee(6e4)}))}},Ih=class{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){return m(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))})}ne(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=kv(s);lf(o,r)>0&&(r=o)}),new et(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var ze=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Hs(n){return n==null}function bs(n){return n===0&&1/n==-1/0}function Vv(n){return typeof n=="number"&&Number.isInteger(n)&&!bs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Oe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ny(e)),e=O0(n.get(t),e);return Ny(e)}function O0(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Ny(n){return n+""}function yt(n){let e=n.length;if(b(e>=2),e===2)return b(n.charAt(0)===""&&n.charAt(1)===""),$.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new $(r)}var ky=["userId","batchId"];function Ma(n,e){return[n,Oe(e)]}function Ov(n,e,t){return[n,Oe(e),t]}var L0={},F0=["prefixPath","collectionGroup","readTime","documentId"],U0=["prefixPath","collectionGroup","documentId"],j0=["collectionGroup","readTime","prefixPath","documentId"],q0=["canonicalId","targetId"],B0=["targetId","path"],$0=["path","targetId"],z0=["collectionId","parent"],G0=["indexId","uid"],K0=["uid","sequenceNumber"],W0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Q0=["indexId","uid","orderedDocumentKey"],H0=["userId","collectionPath","documentId"],Y0=["userId","collectionPath","largestBatchId"],X0=["userId","collectionGroup","largestBatchId"],Lv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],J0=[...Lv,"documentOverlays"],Fv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Uv=Fv,Z0=[...Uv,"indexConfiguration","indexState","indexEntries"];var Cs=class extends $a{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}};function Ae(n,e){let t=E(n);return kt.M(t.ae,e)}function My(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Jn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function jv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ee=class n{constructor(e,t){this.comparator=e,this.root=t||_t.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_t.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_t.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new kr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new kr(this.root,e,this.comparator,!1)}getReverseIterator(){return new kr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new kr(this.root,e,this.comparator,!0)}},kr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},_t=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};_t.EMPTY=null,_t.RED=!0,_t.BLACK=!1;_t.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new _t(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var J=class n{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ga(this.data.getIterator())}getIteratorFrom(e){return new Ga(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ga=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Ar(n){return n.hasNext()?n.getNext():void 0}var Ge=class n{constructor(e){this.fields=e,e.sort(_e.comparator)}static empty(){return new n([])}unionWith(e){let t=new J(_e.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ka=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function fP(){return typeof atob<"u"}var Te=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ka("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return O(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Te.EMPTY_BYTE_STRING=new Te("");var eR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rn(n){if(b(!!n),typeof n=="string"){let e=0,t=eR.exec(n);if(b(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:se(n.seconds),nanos:se(n.nanos)}}function se(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function sn(n){return typeof n=="string"?Te.fromBase64String(n):Te.fromUint8Array(n)}function Ou(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function df(n){let e=n.mapValue.fields.__previous_value__;return Ou(e)?df(e):e}function Ps(n){let e=rn(n.mapValue.fields.__local_write_time__.timestampValue);return new ue(e.seconds,e.nanos)}var Eh=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},jr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var tn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Va={nullValue:"NULL_VALUE"};function Bn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ou(n)?4:qv(n)?9007199254740991:10:S()}function Tt(n,e){if(n===e)return!0;let t=Bn(n);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ps(n).isEqual(Ps(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=rn(i.timestampValue),a=rn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return sn(i.bytesValue).isEqual(sn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return se(i.geoPointValue.latitude)===se(s.geoPointValue.latitude)&&se(i.geoPointValue.longitude)===se(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return se(i.integerValue)===se(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=se(i.doubleValue),a=se(s.doubleValue);return o===a?bs(o)===bs(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Fr(n.arrayValue.values||[],e.arrayValue.values||[],Tt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(My(o)!==My(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Tt(o[u],a[u])))return!1;return!0}(n,e);default:return S()}}function Ds(n,e){return(n.values||[]).find(t=>Tt(t,e))!==void 0}function on(n,e){if(n===e)return 0;let t=Bn(n),r=Bn(e);if(t!==r)return O(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return O(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=se(s.integerValue||s.doubleValue),u=se(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Vy(n.timestampValue,e.timestampValue);case 4:return Vy(Ps(n),Ps(e));case 5:return O(n.stringValue,e.stringValue);case 6:return function(s,o){let a=sn(s),u=sn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=O(a[c],u[c]);if(l!==0)return l}return O(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=O(se(s.latitude),se(o.latitude));return a!==0?a:O(se(s.longitude),se(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=on(a[c],u[c]);if(l)return l}return O(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===tn.mapValue&&o===tn.mapValue)return 0;if(s===tn.mapValue)return 1;if(o===tn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=O(u[h],l[h]);if(d!==0)return d;let f=on(a[u[h]],c[l[h]]);if(f!==0)return f}return O(u.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function Vy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return O(n,e);let t=rn(n),r=rn(e),i=O(t.seconds,r.seconds);return i!==0?i:O(t.nanos,r.nanos)}function qr(n){return Th(n)}function Th(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=rn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return sn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return A.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Th(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Th(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function $n(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ah(n){return!!n&&"integerValue"in n}function xs(n){return!!n&&"arrayValue"in n}function Oy(n){return!!n&&"nullValue"in n}function Ly(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Oa(n){return!!n&&"mapValue"in n}function Is(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Jn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Is(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Is(n.arrayValue.values[t]);return e}return Object.assign({},n)}function qv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function tR(n){return"nullValue"in n?Va:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?$n(jr.empty(),A.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function nR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?$n(jr.empty(),A.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?tn:S()}function Fy(n,e){let t=on(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Uy(n,e){let t=on(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var ke=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Oa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Is(t)}setAll(e){let t=_e.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Is(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Oa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Oa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Jn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Is(this.value))}};function Bv(n){let e=[];return Jn(n.fields,(t,r)=>{let i=new _e([t]);if(Oa(r)){let s=Bv(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Ge(e)}var ye=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,C.min(),C.min(),C.min(),ke.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,C.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,C.min(),C.min(),ke.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,C.min(),C.min(),ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(C.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var At=class{constructor(e,t){this.position=e,this.inclusive=t}};function jy(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=A.comparator(A.fromName(o.referenceValue),t.key):r=on(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function qy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Tt(n.position[t],e.position[t]))return!1;return!0}var zn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function rR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Wa=class{},j=class n extends Wa{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new bh(e,t,r):t==="array-contains"?new Dh(e,r):t==="in"?new Qa(e,r):t==="not-in"?new xh(e,r):t==="array-contains-any"?new Nh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ch(e,r):new Ph(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(on(t,this.value)):t!==null&&Bn(this.value)===Bn(t)&&this.matchesComparison(on(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Y=class n extends Wa{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new n(e,t)}matches(e){return Br(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Br(n){return n.op==="and"}function Rh(n){return n.op==="or"}function ff(n){return $v(n)&&Br(n)}function $v(n){for(let e of n.filters)if(e instanceof Y)return!1;return!0}function Sh(n){if(n instanceof j)return n.field.canonicalString()+n.op.toString()+qr(n.value);if(ff(n))return n.filters.map(e=>Sh(e)).join(",");{let e=n.filters.map(t=>Sh(t)).join(",");return`${n.op}(${e})`}}function zv(n,e){return n instanceof j?function(r,i){return i instanceof j&&r.op===i.op&&r.field.isEqual(i.field)&&Tt(r.value,i.value)}(n,e):n instanceof Y?function(r,i){return i instanceof Y&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&zv(o,i.filters[a]),!0):!1}(n,e):void S()}function Gv(n,e){let t=n.filters.concat(e);return Y.create(t,n.op)}function Kv(n){return n instanceof j?function(t){return`${t.field.canonicalString()} ${t.op} ${qr(t.value)}`}(n):n instanceof Y?function(t){return t.op.toString()+" {"+t.getFilters().map(Kv).join(" ,")+"}"}(n):"Filter"}var bh=class extends j{constructor(e,t,r){super(e,t,r),this.key=A.fromName(r.referenceValue)}matches(e){let t=A.comparator(e.key,this.key);return this.matchesComparison(t)}},Ch=class extends j{constructor(e,t){super(e,"in",t),this.keys=Wv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ph=class extends j{constructor(e,t){super(e,"not-in",t),this.keys=Wv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Wv(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>A.fromName(r.referenceValue))}var Dh=class extends j{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return xs(t)&&Ds(t.arrayValue,this.value)}},Qa=class extends j{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ds(this.value.arrayValue,t)}},xh=class extends j{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ds(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ds(this.value.arrayValue,t)}},Nh=class extends j{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!xs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ds(this.value.arrayValue,r))}};var kh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Mh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new kh(n,e,t,r,i,s,o)}function Gn(n){let e=E(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Sh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Hs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>qr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>qr(r)).join(",")),e.ce=t}return e.ce}function Ys(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!rR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!zv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!qy(n.startAt,e.startAt)&&qy(n.endAt,e.endAt)}function Ha(n){return A.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ya(n,e){return n.filters.filter(t=>t instanceof j&&t.field.isEqual(e))}function By(n,e,t){let r=Va,i=!0;for(let s of Ya(n,e)){let o=Va,a=!0;switch(s.op){case"<":case"<=":o=tR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Va}Fy({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Fy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function $y(n,e,t){let r=tn,i=!0;for(let s of Ya(n,e)){let o=tn,a=!0;switch(s.op){case">=":case">":o=nR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=tn}Uy({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Uy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var at=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Qv(n,e,t,r,i,s,o,a){return new at(n,e,t,r,i,s,o,a)}function ri(n){return new at(n)}function zy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function pf(n){return n.collectionGroup!==null}function Vr(n){let e=E(n);if(e.le===null){e.le=[];let t=new Set;for(let s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new J(_e.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new zn(s,r))}),t.has(_e.keyField().canonicalString())||e.le.push(new zn(_e.keyField(),r))}return e.le}function Le(n){let e=E(n);return e.he||(e.he=iR(e,Vr(n))),e.he}function iR(n,e){if(n.limitType==="F")return Mh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new zn(i.field,s)});let t=n.endAt?new At(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new At(n.startAt.position,n.startAt.inclusive):null;return Mh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Vh(n,e){let t=n.filters.concat([e]);return new at(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Xa(n,e,t){return new at(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Xs(n,e){return Ys(Le(n),Le(e))&&n.limitType===e.limitType}function Hv(n){return`${Gn(Le(n))}|lt:${n.limitType}`}function Pr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Kv(i)).join(", ")}]`),Hs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>qr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>qr(i)).join(",")),`Target(${r})`}(Le(n))}; limitType=${n.limitType})`}function Js(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):A.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Vr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=jy(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Vr(r),i)||r.endAt&&!function(o,a,u){let c=jy(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Vr(r),i))}(n,e)}function Yv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xv(n){return(e,t)=>{let r=!1;for(let i of Vr(n)){let s=sR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function sR(n,e,t){let r=n.field.isKeyField()?A.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?on(u,c):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var Rt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Jn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return jv(this.inner)}size(){return this.innerSize}};var oR=new ee(A.comparator);function Ue(){return oR}var Jv=new ee(A.comparator);function _s(...n){let e=Jv;for(let t of n)e=e.insert(t.key,t);return e}function Zv(n){let e=Jv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function vt(){return Es()}function e_(){return Es()}function Es(){return new Rt(n=>n.toString(),(n,e)=>n.isEqual(e))}var aR=new ee(A.comparator),uR=new J(A.comparator);function L(...n){let e=uR;for(let t of n)e=e.add(t);return e}var cR=new J(O);function gf(){return cR}function t_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bs(e)?"-0":e}}function n_(n){return{integerValue:""+n}}function r_(n,e){return Vv(e)?n_(e):t_(n,e)}var $r=class{constructor(){this._=void 0}};function lR(n,e,t){return n instanceof an?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ou(s)&&(s=df(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Mt?s_(n,e):n instanceof Vt?o_(n,e):function(i,s){let o=i_(i,s),a=Gy(o)+Gy(i.Ie);return Ah(o)&&Ah(i.Ie)?n_(a):t_(i.serializer,a)}(n,e)}function hR(n,e,t){return n instanceof Mt?s_(n,e):n instanceof Vt?o_(n,e):t}function i_(n,e){return n instanceof un?function(r){return Ah(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var an=class extends $r{},Mt=class extends $r{constructor(e){super(),this.elements=e}};function s_(n,e){let t=a_(e);for(let r of n.elements)t.some(i=>Tt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Vt=class extends $r{constructor(e){super(),this.elements=e}};function o_(n,e){let t=a_(e);for(let r of n.elements)t=t.filter(i=>!Tt(i,r));return{arrayValue:{values:t}}}var un=class extends $r{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function Gy(n){return se(n.integerValue||n.doubleValue)}function a_(n){return xs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Kn=class{constructor(e,t){this.field=e,this.transform=t}};function dR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Mt&&i instanceof Mt||r instanceof Vt&&i instanceof Vt?Fr(r.elements,i.elements,Tt):r instanceof un&&i instanceof un?Tt(r.Ie,i.Ie):r instanceof an&&i instanceof an}(n.transform,e.transform)}var Oh=class{constructor(e,t){this.version=e,this.transformResults=t}},oe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function La(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var zr=class{};function u_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ln(n.key,oe.none()):new cn(n.key,n.data,oe.none());{let t=n.data,r=ke.empty(),i=new J(_e.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new ut(n.key,r,new Ge(i.toArray()),oe.none())}}function fR(n,e,t){n instanceof cn?function(i,s,o){let a=i.value.clone(),u=Wy(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ut?function(i,s,o){if(!La(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Wy(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(c_(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ts(n,e,t,r){return n instanceof cn?function(s,o,a,u){if(!La(s.precondition,o))return a;let c=s.value.clone(),l=Qy(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof ut?function(s,o,a,u){if(!La(s.precondition,o))return a;let c=Qy(s.fieldTransforms,u,o),l=o.data;return l.setAll(c_(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return La(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function pR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=i_(r.transform,i||null);s!=null&&(t===null&&(t=ke.empty()),t.set(r.field,s))}return t||null}function Ky(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Fr(r,i,(s,o)=>dR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var cn=class extends zr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ut=class extends zr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function c_(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Wy(n,e,t){let r=new Map;b(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,hR(o,a,t[i]))}return r}function Qy(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,lR(s,o,e))}return r}var ln=class extends zr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ns=class extends zr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ks=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&fR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ts(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ts(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=e_();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=u_(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(C.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&Fr(this.mutations,e.mutations,(t,r)=>Ky(t,r))&&Fr(this.baseMutations,e.baseMutations,(t,r)=>Ky(t,r))}},Lh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){b(e.mutations.length===r.length);let i=function(){return aR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Ms=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Fh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var fe,B;function l_(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function h_(n){if(n===void 0)return ae("GRPC error has no .code"),g.UNKNOWN;switch(n){case fe.OK:return g.OK;case fe.CANCELLED:return g.CANCELLED;case fe.UNKNOWN:return g.UNKNOWN;case fe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case fe.INTERNAL:return g.INTERNAL;case fe.UNAVAILABLE:return g.UNAVAILABLE;case fe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case fe.NOT_FOUND:return g.NOT_FOUND;case fe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case fe.ABORTED:return g.ABORTED;case fe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case fe.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(B=fe||(fe={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";var Hy=null;function d_(){return new TextEncoder}var gR=new kn([4294967295,4294967295],0);function Yy(n){let e=d_().encode(n),t=new Py;return t.update(e),new Uint8Array(t.digest())}function Xy(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new kn([t,r],0),new kn([i,s],0)]}var Uh=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new jn(`Invalid padding: ${t}`);if(r<0)throw new jn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new jn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new jn(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=kn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(kn.fromNumber(r)));return i.compare(gR)===1&&(i=new kn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=Yy(e),[r,i]=Xy(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let t=Yy(e),[r,i]=Xy(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},jn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vs=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Os.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(C.min(),i,new ee(O),Ue(),L())}},Os=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,L(),L(),L())}};var Or=class{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}},Ja=class{constructor(e,t){this.targetId=e,this.fe=t}},Za=class{constructor(e,t,r=Te.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},eu=class{constructor(){this.ge=0,this.pe=Zy(),this.ye=Te.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=L(),t=L(),r=L();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new Os(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Zy()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,b(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},jh=class{constructor(e){this.Be=e,this.ke=new Map,this.qe=Ue(),this.Qe=Jy(),this.Ke=new ee(O)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){let t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){let s=i.target;if(Ha(s))if(r===0){let o=new A(s.path);this.We(t,o,ye.newNoDocument(o,C.min()))}else b(r===1);else{let o=this.Ze(t);if(o!==r){let a=this.Xe(e),u=a?this.et(a,e,o):1;if(u!==0){this.He(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}Hy?.tt(function(l,h,d,f,I){var w,y,R,N,M,F;let X={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},z=h.unchangedNames;return z&&(X.bloomFilter={applied:I===0,hashCount:(w=z?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(N=(R=(y=z?.bits)===null||y===void 0?void 0:y.bitmap)===null||R===void 0?void 0:R.length)!==null&&N!==void 0?N:0,padding:(F=(M=z?.bits)===null||M===void 0?void 0:M.padding)!==null&&F!==void 0?F:0,mightContain:he=>{var ct;return(ct=f?.mightContain(he))!==null&&ct!==void 0&&ct}}),X}(o,e.fe,this.Be.nt(),a,u))}}}}Xe(e){let t=e.fe.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=sn(r).toUint8Array()}catch(u){if(u instanceof Ka)return Et("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Uh(o,i,s)}catch(u){return Et(u instanceof jn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){let r=this.Be.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){let t=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Ha(a.target)){let u=new A(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,ye.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=L();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new Vs(e,t,this.Ke,this.qe,r);return this.qe=Ue(),this.Qe=Jy(),this.Ke=new ee(O),i}Ue(e,t){if(!this.je(e))return;let r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new eu,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new J(O),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new eu),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}};function Jy(){return new ee(A.comparator)}function Zy(){return new ee(A.comparator)}var mR={asc:"ASCENDING",desc:"DESCENDING"},yR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vR={and:"AND",or:"OR"},qh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Bh(n,e){return n.useProto3Json||Hs(e)?e:{value:e}}function Gr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function f_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _R(n,e){return Gr(n,e.toTimestamp())}function ce(n){return b(!!n),C.fromTimestamp(function(t){let r=rn(t);return new ue(r.seconds,r.nanos)}(n))}function mf(n,e){return $h(n,e).canonicalString()}function $h(n,e){let t=function(i){return new $(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function p_(n){let e=$.fromString(n);return b(A_(e)),e}function Ls(n,e){return mf(n.databaseId,e.path)}function wt(n,e){let t=p_(e);if(t.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new A(y_(t))}function g_(n,e){return mf(n.databaseId,e)}function m_(n){let e=p_(n);return e.length===4?$.emptyPath():y_(e)}function zh(n){return new $(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function y_(n){return b(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function ev(n,e,t){return{name:Ls(n,e),fields:t.value.mapValue.fields}}function v_(n,e,t){let r=wt(n,e.name),i=ce(e.updateTime),s=e.createTime?ce(e.createTime):C.min(),o=new ke({mapValue:{fields:e.fields}}),a=ye.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function wR(n,e){return"found"in e?function(r,i){b(!!i.found),i.found.name,i.found.updateTime;let s=wt(r,i.found.name),o=ce(i.found.updateTime),a=i.found.createTime?ce(i.found.createTime):C.min(),u=new ke({mapValue:{fields:i.found.fields}});return ye.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){b(!!i.missing),b(!!i.readTime);let s=wt(r,i.missing),o=ce(i.readTime);return ye.newNoDocument(s,o)}(n,e):S()}function IR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(b(l===void 0||typeof l=="string"),Te.fromBase64String(l||"")):(b(l===void 0||l instanceof Uint8Array),Te.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:h_(c.code);return new _(l,c.message||"")}(o);t=new Za(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=wt(n,r.document.name),s=ce(r.document.updateTime),o=r.document.createTime?ce(r.document.createTime):C.min(),a=new ke({mapValue:{fields:r.document.fields}}),u=ye.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new Or(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=wt(n,r.document),s=r.readTime?ce(r.readTime):C.min(),o=ye.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Or([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=wt(n,r.document),s=r.removedTargetIds||[];t=new Or([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Fh(i,s),a=r.targetId;t=new Ja(a,o)}}return t}function Fs(n,e){let t;if(e instanceof cn)t={update:ev(n,e.key,e.value)};else if(e instanceof ln)t={delete:Ls(n,e.key)};else if(e instanceof ut)t={update:ev(n,e.key,e.data),updateMask:bR(e.fieldMask)};else{if(!(e instanceof Ns))return S();t={verify:Ls(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof an)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Mt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Vt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof un)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:_R(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,e.precondition)),t}function Gh(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?oe.updateTime(ce(s.updateTime)):s.exists!==void 0?oe.exists(s.exists):oe.none()}(e.currentDocument):oe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)b(a.setToServerValue==="REQUEST_TIME"),u=new an;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Mt(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Vt(l)}else"increment"in a?u=new un(o,a.increment):S();let c=_e.fromServerFormat(a.fieldPath);return new Kn(c,u)}(n,i)):[];if(e.update){e.update.name;let i=wt(n,e.update.name),s=new ke({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Ge(c.map(l=>_e.fromServerFormat(l)))}(e.updateMask);return new ut(i,s,o,t,r)}return new cn(i,s,t,r)}if(e.delete){let i=wt(n,e.delete);return new ln(i,t)}if(e.verify){let i=wt(n,e.verify);return new Ns(i,t)}return S()}function ER(n,e){return n&&n.length>0?(b(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ce(i.updateTime):ce(s);return o.isEqual(C.min())&&(o=ce(s)),new Oh(o,i.transformResults||[])}(t,e))):[]}function __(n,e){return{documents:[g_(n,e.path)]}}function w_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=g_(n,i);let s=function(c){if(c.length!==0)return T_(Y.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:Dr(d.field),direction:AR(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Bh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i}}function I_(n){let e=m_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){b(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=E_(h);return d instanceof Y&&ff(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(I){return new zn(xr(I.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Hs(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new At(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new At(f,d)}(t.endAt)),Qv(e,i,o,s,a,"F",u,c)}function TR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function E_(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=xr(t.unaryFilter.field);return j.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=xr(t.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=xr(t.unaryFilter.field);return j.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=xr(t.unaryFilter.field);return j.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(t){return j.create(xr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Y.create(t.compositeFilter.filters.map(r=>E_(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S()}function AR(n){return mR[n]}function RR(n){return yR[n]}function SR(n){return vR[n]}function Dr(n){return{fieldPath:n.canonicalString()}}function xr(n){return _e.fromServerFormat(n.fieldPath)}function T_(n){return n instanceof j?function(t){if(t.op==="=="){if(Ly(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NAN"}};if(Oy(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ly(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NAN"}};if(Oy(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dr(t.field),op:RR(t.op),value:t.value}}}(n):n instanceof Y?function(t){let r=t.getFilters().map(i=>T_(i));return r.length===1?r[0]:{compositeFilter:{op:SR(t.op),filters:r}}}(n):S()}function bR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function A_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Kr=class n{constructor(e,t,r,i,s=C.min(),o=C.min(),a=Te.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var tu=class{constructor(e){this.ct=e}};function CR(n,e){let t;if(e.document)t=v_(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=A.fromSegments(e.noDocument.path),i=Qn(e.noDocument.readTime);t=ye.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{let r=A.fromSegments(e.unknownDocument.path),i=Qn(e.unknownDocument.version);t=ye.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ue(i[0],i[1]);return C.fromTimestamp(s)}(e.readTime)),t}function tv(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:nu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ls(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Gr(s,o.version.toTimestamp()),createTime:Gr(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Wn(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:Wn(e.version)}}return r}function nu(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Wn(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Qn(n){let e=new ue(n.seconds,n.nanoseconds);return C.fromTimestamp(e)}function Ln(n,e){let t=(e.baseMutations||[]).map(s=>Gh(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Gh(n.ct,s)),i=ue.fromMillis(e.localWriteTimeMs);return new ks(e.batchId,i,t,r)}function ws(n){let e=Qn(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Qn(n.lastLimboFreeSnapshotVersion):C.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return b(s.documents.length===1),Le(ri(m_(s.documents[0])))}(n.query):function(s){return Le(I_(s))}(n.query),new Kr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Te.fromBase64String(n.resumeToken))}function R_(n,e){let t=Wn(e.snapshotVersion),r=Wn(e.lastLimboFreeSnapshotVersion),i;i=Ha(e.target)?__(n.ct,e.target):w_(n.ct,e.target).ut;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function yf(n){let e=I_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Xa(e,e.limit,"L"):e}function oh(n,e){return new Ms(e.largestBatchId,Gh(n.ct,e.overlayMutation))}function nv(n,e){let t=e.path.lastSegment();return[n,Oe(e.path.popLast()),t]}function rv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Wn(r.readTime),documentKey:Oe(r.documentKey.path),largestBatchId:r.largestBatchId}}var Kh=class{getBundleMetadata(e,t){return iv(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Qn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return iv(e).put(function(i){return{bundleId:i.id,createTime:Wn(ce(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return sv(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:yf(s.bundledQuery),readTime:Qn(s.readTime)}}(r)})}saveNamedQuery(e,t){return sv(e).put(function(i){return{name:i.name,readTime:Wn(ce(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function iv(n){return Ae(n,"bundles")}function sv(n){return Ae(n,"namedQueries")}var ru=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return gs(e).get(nv(this.userId,t)).next(r=>r?oh(this.serializer,r):null)}getOverlays(e,t){let r=vt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Ms(t,o);i.push(this.ht(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Oe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(gs(e).H("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=vt(),s=Oe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return gs(e).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=oh(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=vt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gs(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=oh(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return gs(e).put(function(i,s,o){let[a,u,c]=nv(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Fs(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function gs(n){return Ae(n,"documentOverlays")}var xt=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(se(e.integerValue));else if("doubleValue"in e){let r=se(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),bs(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(sn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?qv(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):S()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),A.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};xt.bt=new xt;function PR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function ov(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=PR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Wh=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=ov(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=ov(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Qh=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},Hh=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},Fn=class{constructor(){this.Gt=new Wh,this.zt=new Qh(this.Gt),this.jt=new Hh(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Un=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Xt(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=av(n.arrayValue,e.arrayValue),t!==0?t:(t=av(n.directionalValue,e.directionalValue),t!==0?t:A.comparator(n.documentKey,e.documentKey)))}function av(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var iu=class{constructor(e){this.Yt=new J((t,r)=>_e.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(b(e.collectionGroup===this.collectionId),this.en)return!1;let t=yh(e);if(t!==void 0&&!this.nn(t))return!1;let r=Vn(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new J(_e.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Mr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Mr(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Mr(r.field,r.dir==="asc"?0:1)));return new Ur(Ur.UNKNOWN_ID,this.collectionId,t,Ss.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function S_(n){var e,t;if(b(n instanceof j||n instanceof Y),n instanceof j){if(n instanceof Qa){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>j.create(n.field,"==",s)))||[];return Y.create(i,"or")}return n}let r=n.filters.map(i=>S_(i));return Y.create(r,n.op)}function DR(n){if(n.getFilters().length===0)return[];let e=Jh(S_(n));return b(b_(e)),Yh(e)||Xh(e)?[e]:e.getFilters()}function Yh(n){return n instanceof j}function Xh(n){return n instanceof Y&&ff(n)}function b_(n){return Yh(n)||Xh(n)||function(t){if(t instanceof Y&&Rh(t)){for(let r of t.getFilters())if(!Yh(r)&&!Xh(r))return!1;return!0}return!1}(n)}function Jh(n){if(b(n instanceof j||n instanceof Y),n instanceof j)return n;if(n.filters.length===1)return Jh(n.filters[0]);let e=n.filters.map(r=>Jh(r)),t=Y.create(e,n.op);return t=su(t),b_(t)?t:(b(t instanceof Y),b(Br(t)),b(t.filters.length>1),t.filters.reduce((r,i)=>vf(r,i)))}function vf(n,e){let t;return b(n instanceof j||n instanceof Y),b(e instanceof j||e instanceof Y),t=n instanceof j?e instanceof j?function(i,s){return Y.create([i,s],"and")}(n,e):uv(n,e):e instanceof j?uv(e,n):function(i,s){if(b(i.filters.length>0&&s.filters.length>0),Br(i)&&Br(s))return Gv(i,s.getFilters());let o=Rh(i)?i:s,a=Rh(i)?s:i,u=o.filters.map(c=>vf(c,a));return Y.create(u,"or")}(n,e),su(t)}function uv(n,e){if(Br(e))return Gv(e,n.getFilters());{let t=e.filters.map(r=>vf(n,r));return Y.create(t,"or")}}function su(n){if(b(n instanceof j||n instanceof Y),n instanceof j)return n;let e=n.getFilters();if(e.length===1)return su(e[0]);if($v(n))return n;let t=e.map(i=>su(i)),r=[];return t.forEach(i=>{i instanceof j?r.push(i):i instanceof Y&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Y.create(r,n.op)}var Zh=class{constructor(){this._n=new Us}addToCollectionParentIndex(e,t){return this._n.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(et.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(et.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Us=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new J($.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new J($.comparator)).toArray()}};var Da=new Uint8Array(0),ed=class{constructor(e,t){this.databaseId=t,this.an=new Us,this.un=new Rt(r=>Gn(r),(r,i)=>Ys(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:Oe(i)};return cv(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[xv(t),""],!1,!0);return cv(e).W(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(yt(o.parent))}return r})}addFieldIndex(e,t){let r=ms(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Sr(e);return s.next(a=>{o.put(rv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=ms(e),i=Sr(e),s=Rr(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ms(e),r=Rr(e),i=Sr(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return p.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new iu(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Rr(e),i=!0,s=new Map;return p.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=L(),a=[];return p.forEach(s,(u,c)=>{v("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(F=>`${F.fieldPath}:${F.kind}`).join(",")}`}(u)} to execute ${Gn(t)}`);let l=function(M,F){let X=yh(F);if(X===void 0)return null;for(let z of Ya(M,X.fieldPath))switch(z.op){case"array-contains-any":return z.value.arrayValue.values||[];case"array-contains":return[z.value]}return null}(c,u),h=function(M,F){let X=new Map;for(let z of Vn(F))for(let he of Ya(M,z.fieldPath))switch(he.op){case"==":case"in":X.set(z.fieldPath.canonicalString(),he.value);break;case"not-in":case"!=":return X.set(z.fieldPath.canonicalString(),he.value),Array.from(X.values())}return null}(c,u),d=function(M,F){let X=[],z=!0;for(let he of Vn(F)){let ct=he.kind===0?By(M,he.fieldPath,M.startAt):$y(M,he.fieldPath,M.startAt);X.push(ct.value),z&&(z=ct.inclusive)}return new At(X,z)}(c,u),f=function(M,F){let X=[],z=!0;for(let he of Vn(F)){let ct=he.kind===0?$y(M,he.fieldPath,M.endAt):By(M,he.fieldPath,M.endAt);X.push(ct.value),z&&(z=ct.inclusive)}return new At(X,z)}(c,u),I=this.hn(u,c,d),w=this.hn(u,c,f),y=this.Pn(u,c,h),R=this.In(u.indexId,l,I,d.inclusive,w,f.inclusive,y);return p.forEach(R,N=>r.j(N,t.limit).next(M=>{M.forEach(F=>{let X=A.fromSegments(F.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return p.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=DR(Y.create(e.filters,"and")).map(r=>Mh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.Tn(t[h/c]):Da,f=this.En(e,d,r[h%c],i),I=this.dn(e,d,s[h%c],o),w=a.map(y=>this.En(e,d,y,!0));l.push(...this.createRange(f,I,w))}return l}En(e,t,r,i){let s=new Un(e,A.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new Un(e,A.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new iu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return p.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new J(_e.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new Fn;for(let i of Vn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);xt.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new Fn;return xt.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new Fn;return xt.bt.Pt($n(this.databaseId,t),r.Ht(function(s){let o=Vn(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new Fn);let s=0;for(let o of Vn(e)){let a=r[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&xs(a))i=this.mn(i,o,a);else{let c=u.Ht(o.kind);xt.bt.Pt(a,c)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Fn;u.seed(a.Wt()),xt.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof j&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=ms(e),i=Sr(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new Ss(h.sequenceNumber,new et(Qn(h.readTime),new A(yt(h.documentKey)),h.largestBatchId)):Ss.empty(),f=l.fields.map(([I,w])=>new Mr(_e.fromServerFormat(I),w));return new Ur(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:O(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=ms(e),s=Sr(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(rv(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.pn(e,i,u).next(c=>{let l=this.yn(s,u);return c.isEqual(l)?p.resolve():this.wn(e,s,u,c,l)}))))})}Sn(e,t,r,i){return Rr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return Rr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=Rr(e),s=new J(Xt);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new Un(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new J(Xt),i=this.An(t,e);if(i==null)return r;let s=yh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(xs(o))for(let a of o.arrayValue.values||[])r=r.add(new Un(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new Un(t.indexId,e.key,Da,i));return r}wn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),I=c.getIterator(),w=Ar(f),y=Ar(I);for(;w||y;){let R=!1,N=!1;if(w&&y){let M=l(w,y);M<0?N=!0:M>0&&(R=!0)}else w!=null?N=!0:R=!0;R?(h(y),y=Ar(I)):N?(d(w),w=Ar(f)):(w=Ar(f),y=Ar(I))}}(i,s,Xt,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),p.waitFor(o)}gn(e){let t=1;return Sr(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Xt(o,a)).filter((o,a,u)=>!a||Xt(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Xt(o,e),u=Xt(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Da,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Da,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(e,t){return Xt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lv)}getMinOffset(e,t){return p.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||S())).next(lv)}};function cv(n){return Ae(n,"collectionParents")}function Rr(n){return Ae(n,"indexEntries")}function ms(n){return Ae(n,"indexConfiguration")}function Sr(n){return Ae(n,"indexState")}function lv(n){b(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;lf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new et(e.readTime,e.documentKey,t)}var hv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ze=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function C_(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{b(a===1)}));let c=[];for(let l of t.mutations){let h=Ov(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function ou(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}Ze.DEFAULT_COLLECTION_PERCENTILE=10,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ze.DEFAULT=new Ze(41943040,Ze.DEFAULT_COLLECTION_PERCENTILE,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ze.DISABLED=new Ze(-1,0,0);var au=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){b(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Nr(e),o=Jt(e);return o.add({}).next(a=>{b(typeof a=="number");let u=new ks(a,t,r,i),c=function(f,I,w){let y=w.baseMutations.map(N=>Fs(f.ct,N)),R=w.mutations.map(N=>Fs(f.ct,N));return{userId:I,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:y,mutations:R}}(this.serializer,this.userId,u),l=[],h=new J((d,f)=>O(d.canonicalString(),f.canonicalString()));for(let d of i){let f=Ov(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,L0))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Jt(e).get(t).next(r=>r?(b(r.userId===this.userId),Ln(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?p.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Jt(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),s=Ln(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Jt(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).W("userMutationsIndex",t).next(r=>r.map(i=>Ln(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ma(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Nr(e).Y({range:i},(o,a,u)=>{let[c,l,h]=o,d=yt(l);if(c===this.userId&&t.path.isEqual(d))return Jt(e).get(h).next(f=>{if(!f)throw S();b(f.userId===this.userId),s.push(Ln(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new J(O),i=[];return t.forEach(s=>{let o=Ma(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Nr(e).Y({range:a},(c,l,h)=>{let[d,f,I]=c,w=yt(f);d===this.userId&&s.path.isEqual(w)?r=r.add(I):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ma(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new J(O);return Nr(e).Y({range:o},(u,c,l)=>{let[h,d,f]=u,I=yt(d);h===this.userId&&r.isPrefixOf(I)?I.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Jt(e).get(s).next(o=>{if(o===null)throw S();b(o.userId===this.userId),r.push(Ln(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return C_(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Nr(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=yt(s[1]);i.push(u)}else a.done()}).next(()=>{b(i.length===0)})})}containsKey(e,t){return P_(e,this.userId,t)}xn(e){return D_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function P_(n,e,t){let r=Ma(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Nr(n).Y({range:s,J:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Jt(n){return Ae(n,"mutations")}function Nr(n){return Ae(n,"documentMutations")}function D_(n){return Ae(n,"mutationQueues")}var Wr=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var td=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new Wr(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>C.fromTimestamp(new ue(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>br(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return br(e).Y((o,a)=>{let u=ws(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return br(e).Y((r,i)=>{let s=ws(i);t(s)})}Bn(e){return dv(e).get("targetGlobalKey").next(t=>(b(t!==null),t))}kn(e,t){return dv(e).put("targetGlobalKey",t)}qn(e,t){return br(e).put(R_(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Gn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return br(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=ws(a);Ys(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Zt(e);return t.forEach(o=>{let a=Oe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=Zt(e);return p.forEach(t,s=>{let o=Oe(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Zt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Zt(e),s=L();return i.Y({range:r,J:!0},(o,a,u)=>{let c=yt(o[1]),l=new A(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=Oe(t.path),i=IDBKeyRange.bound([r],[xv(r)],!1,!0),s=0;return Zt(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return br(e).get(t).next(r=>r?ws(r):null)}};function br(n){return Ae(n,"targets")}function dv(n){return Ae(n,"targetGlobal")}function Zt(n){return Ae(n,"targetDocuments")}function fv([n,e],[t,r]){let i=O(n,t);return i===0?O(e,r):i}var nd=class{constructor(e){this.Kn=e,this.buffer=new J(fv),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();fv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},rd=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){mn(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield gn(t)}yield this.zn(3e5)}))}},id=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(ze._e);let r=new nd(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(hv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hv):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Cr()<=ht.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function xR(n,e){return new id(n,e)}var sd=class{constructor(e,t){this.db=e,this.garbageCollector=xR(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return xa(e,r)}removeReference(e,t,r){return xa(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return xa(e,t)}er(e,t){return function(i,s){let o=!1;return D_(i).Z(a=>P_(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,C.min()),Zt(e).delete(function(h){return[0,Oe(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return xa(e,t)}Xn(e,t){let r=Zt(e),i,s=ze._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==ze._e&&t(new A(yt(i)),s),s=c,i=u):s=ze._e}).next(()=>{s!==ze._e&&t(new A(yt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function xa(n,e){return Zt(n).put(function(r,i){return{targetId:0,path:Oe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var uu=class{constructor(){this.changes=new Rt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ye.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var od=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Mn(e).put(r)}removeEntry(e,t,r){return Mn(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],nu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=ye.newInvalidDocument(t);return Mn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ys(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:ye.newInvalidDocument(t)};return Mn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ys(t))},(i,s)=>{r={document:this.nr(t,s),size:ou(s)}}).next(()=>r)}getEntries(e,t){let r=Ue();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=Ue(),i=new ee(A.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,ou(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return p.resolve();let i=new J(mv);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ys(i.first()),ys(i.last())),o=i.getIterator(),a=o.getNext();return Mn(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=A.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&mv(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(ys(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),nu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Mn(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Ue();for(let h of c){let d=this.nr(A.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Js(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Ue(),o=gv(t,r),a=gv(t,et.max());return Mn(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.nr(A.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new ad(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return pv(e).get("remoteDocumentGlobalKey").next(t=>(b(!!t),t))}tr(e,t){return pv(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=CR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(C.min())))return r}return ye.newInvalidDocument(e)}};function x_(n){return new od(n)}var ad=class extends uu{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Rt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new J((s,o)=>O(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=tv(this.ar.serializer,o);i=i.add(s.path.popLast());let c=ou(u);r+=c-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=tv(this.ar.serializer,o.convertToNoDocument(C.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function pv(n){return Ae(n,"remoteDocumentGlobal")}function Mn(n){return Ae(n,"remoteDocumentsV14")}function ys(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function gv(n,e){let t=e.documentKey.path.toArray();return[n,nu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function mv(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=O(t[s],r[s]),i)return i;return i=O(t.length,r.length),i||(i=O(t[t.length-2],r[r.length-2]),i||O(t[t.length-1],r[r.length-1]))}var ud=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var cu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ts(r.mutation,i,Ge.empty(),ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,L()).next(()=>r))}getLocalViewOfDocuments(e,t,r=L()){let i=vt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=_s();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=vt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ue(),o=Es(),a=function(){return Es()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof ut)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),Ts(l.mutation,c,l.mutation.getFieldMask(),ue.now())):o.set(c.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new ud(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Es(),i=new ee((o,a)=>o-a),s=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||Ge.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||L()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=e_();l.forEach(d=>{if(!s.has(d)){let f=u_(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return A.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):pf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(vt()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,L())).next(l=>({batchId:a,changes:Zv(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new A(t)).next(r=>{let i=_s();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=_s();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new at(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,ye.newInvalidDocument(l)))});let a=_s();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&Ts(l.mutation,c,Ge.empty(),ue.now()),Js(t,c)&&(a=a.insert(u,c))}),a})}};var cd=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return p.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ce(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:yf(i.bundledQuery),readTime:ce(i.readTime)}}(t)),p.resolve()}};var ld=class{constructor(){this.overlays=new ee(A.comparator),this.hr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=vt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=vt(),s=t.length+1,o=new A(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ee((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=vt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=vt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ms(t,r));let s=this.hr.get(t);s===void 0&&(s=L(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var js=class{constructor(){this.Pr=new J(pe.Ir),this.Tr=new J(pe.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new pe(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new pe(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new A(new $([])),r=new pe(t,e),i=new pe(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new A(new $([])),r=new pe(t,e),i=new pe(t,e+1),s=L();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new pe(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},pe=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return A.comparator(e.key,t.key)||O(e.pr,t.pr)}static Er(e,t){return O(e.pr,t.pr)||A.comparator(e.key,t.key)}};var hd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new J(pe.Ir)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ks(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new pe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new pe(t,0),i=new pe(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new J(O);return t.forEach(i=>{let s=new pe(i,0),o=new pe(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),p.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;A.isDocumentKey(s)||(s=s.child(""));let o=new pe(new A(s),0),a=new J(O);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),p.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){b(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return p.forEach(t.mutations,i=>{let s=new pe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new pe(t,0),i=this.wr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var dd=class{constructor(e){this.vr=e,this.docs=function(){return new ee(A.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():ye.newInvalidDocument(t))}getEntries(e,t){let r=Ue();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ye.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ue(),o=t.path,a=new A(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||lf(kv(l),r)<=0||(i.has(l.key)||Js(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}Fr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new fd(this)}getSize(e){return p.resolve(this.size)}},fd=class extends uu{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var pd=class{constructor(e){this.persistence=e,this.Mr=new Rt(t=>Gn(t),Ys),this.lastRemoteSnapshotVersion=C.min(),this.highestTargetId=0,this.Or=0,this.Nr=new js,this.targetCount=0,this.Lr=Wr.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),p.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new Wr(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.qn(t),p.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Nr.containsKey(t))}};var lu=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new ze(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new pd(this),this.indexManager=new Zh,this.remoteDocumentCache=function(i){return new dd(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new tu(t),this.$r=new cd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ld,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new hd(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new gd(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return p.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},gd=class extends $a{constructor(e){super(),this.currentSequenceNumber=e}},hu=class n{constructor(e){this.persistence=e,this.zr=new js,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),p.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Jr,r=>{let i=A.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,C.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return p.or([()=>p.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var md=class{constructor(e){this.serializer=e}N(e,t,r,i){let s=new za("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ky,{unique:!0}),u.createObjectStore("documentMutations")}(e),yv(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),yv(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:C.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ky,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:H0});c.createIndex("collectionPathOverlayIndex",Y0,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",X0,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:F0});c.createIndex("documentKeyIndex",U0),c.createIndex("collectionGroupIndex",j0)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:G0}).createIndex("sequenceNumberIndex",K0,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:W0}).createIndex("documentKeyIndex",Q0,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=ou(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>p.forEach(a,u=>{b(u.userId===s.userId);let c=Ln(this.serializer,u);return C_(e,s.userId,c).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new $(o),c=function(h){return[0,Oe(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:Oe(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:z0});let r=t.store("collectionParents"),i=new Us,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Oe(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new $(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=yt(a);return s(l.popLast())}))}ri(e){let t=e.store("targets");return t.Y((r,i)=>{let s=ws(i),o=R_(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new A($.fromString(h.document.name).popFirst(5)):h.noDocument?A.fromSegments(h.noDocument.path):h.unknownDocument?A.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}si(e,t){let r=t.store("mutations"),i=x_(this.serializer),s=new lu(hu.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:L();Ln(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new ge(c),h=ru.lt(this.serializer,l),d=s.getIndexManager(l),f=au.lt(l,this.serializer,d,s.referenceDelegate);return new cu(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Cs(t,ze._e),u).next()})})}};function yv(n){n.createObjectStore("targetDocuments",{keyPath:B0}).createIndex("documentTargetsIndex",$0,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",q0,{unique:!0}),n.createObjectStore("targetGlobal")}var ah="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",yd=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sd(this,i),this.Ti=t+"main",this.serializer=new tu(u),this.Ei=new kt(this.Ti,this.ui,new md(this.serializer)),this.Qr=new td(this.referenceDelegate,this.serializer),this.remoteDocumentCache=x_(this.serializer),this.$r=new Kh,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&ae("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,ah);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new ze(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Na(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(mn(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return vs(e).get("owner").next(t=>p.resolve(this.Si(t)))}bi(e){return Na(e).delete(this.clientId)}Di(){return m(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ae(t,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?p.resolve(!0):vs(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,ah);return!1}}return!(!this.networkEnabled||!this.inForeground)||Na(e).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return m(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Cs(e,ze._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Na(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return au.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ed(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ru.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===15?Z0:u===14?Uv:u===13?Fv:u===12?J0:u===11?Lv:void S()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new Cs(a,this.kr?this.kr.next():ze._e),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw ae(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new _(g.FAILED_PRECONDITION,Mv);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return vs(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,ah)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return vs(e).put("owner",t)}static D(){return kt.D()}yi(e){let t=vs(e);return t.get("owner").next(r=>this.Si(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ae(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;hc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ae("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){ae("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function vs(n){return Ae(n,"owner")}function Na(n){return Ae(n,"clientMetadata")}function _f(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var vd=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=L(),i=L();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var _d=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var du=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return hc()?8:kt.v(mi())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new _d;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Cr()<=ht.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",Pr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),p.resolve()):(Cr()<=ht.DEBUG&&v("QueryEngine","Query:",Pr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Cr()<=ht.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",Pr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Le(t))):p.resolve())}ji(e,t){if(zy(t))return p.resolve(null);let r=Le(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Xa(t,null,"F"),r=Le(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=L(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,Xa(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return zy(t)||i.isEqual(C.min())?p.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?p.resolve(null):(Cr()<=ht.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Pr(t)),this.es(e,o,t,Nv(i,-1)).next(a=>a))})}Zi(e,t){let r=new J(Xv(e));return t.forEach((i,s)=>{Js(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Cr()<=ht.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Pr(t)),this.zi.getDocumentsMatchingQuery(e,t,et.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var wd=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ee(O),this.rs=new Rt(s=>Gn(s),Ys),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function N_(n,e,t,r){return new wd(n,e,t,r)}function k_(n,e){return m(this,null,function*(){let t=E(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=L();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function NR(n,e){let t=E(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(I=>{f=f.next(()=>l.getEntry(u,I)).next(w=>{let y=c.docVersions.get(I);b(y!==null),w.version.compareTo(y)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=L();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function M_(n){let e=E(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function kR(n,e){let t=E(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Te.EMPTY_BYTE_STRING,C.min()).withLastLimboFreeSnapshotVersion(C.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,y,R){return w.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}(d,f,l)&&a.push(t.Qr.updateTargetData(s,f))});let u=Ue(),c=L();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(V_(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(C.min())){let l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}function V_(n,e,t){let r=L(),i=L();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ue();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(C.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function MR(n,e){let t=E(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Qr(n,e){let t=E(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new Kr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Hr(n,e,t){return m(this,null,function*(){let r=E(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!mn(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function fu(n,e,t){let r=E(n),i=C.min(),s=L();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=E(u),d=h.rs.get(l);return d!==void 0?p.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,Le(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:C.min(),t?s:L())).next(a=>(F_(r,Yv(e),a),{documents:a,hs:s})))}function O_(n,e){let t=E(n),r=E(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function L_(n,e){let t=E(n),r=t.ss.get(e)||C.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,Nv(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(F_(t,e,i),i))}function F_(n,e,t){let r=n.ss.get(e)||C.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function VR(n,e,t,r){return m(this,null,function*(){let i=E(n),s=L(),o=Ue();for(let c of t){let l=e.Ps(c.metadata.name);c.document&&(s=s.add(l));let h=e.Is(c);h.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(l,h)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Qr(i,function(l){return Le(ri($.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>V_(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function OR(r,i){return m(this,arguments,function*(n,e,t=L()){let s=yield Qr(n,Le(yf(e.bundledQuery))),o=E(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ce(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,e);let c=s.withResumeToken(Te.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function vv(n,e){return`firestore_clients_${n}_${e}`}function _v(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function uh(n,e){return`firestore_targets_${n}_${e}`}var pu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new _(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(ae("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},As=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new _(r.error.code,r.error.message))),s?new n(e,r.state,i):(ae("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},gu=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=gf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Vv(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(ae("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Id=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ae("SharedClientState",`Failed to parse online state: ${e}`),null)}},qs=class{constructor(){this.activeTargetIds=gf()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Rs=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ee(O),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=vv(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new qs),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(vv(this.persistenceKey,r));if(i){let s=gu.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(uh(this.persistenceKey,e));if(r){let i=As.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(uh(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void ae("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>m(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=ze._e;if(s!=null)try{let a=JSON.parse(s);b(typeof a=="number"),o=a}catch(a){ae("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==ze._e&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new pu(this.currentUser,e,t,r),s=_v(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=_v(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=uh(this.persistenceKey,e),s=new As(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return gu.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return pu.Es(new ge(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return As.Es(i,t)}xs(e){return Id.Es(e)}Js(e){return JSON.parse(e)}zs(e){return m(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=gf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},mu=class{constructor(){this.no=new qs,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new qs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Ed=class{io(e){}shutdown(){}};var yu=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ka=null;function ch(){return ka===null?ka=function(){return 268435456+Math.round(2147483648*Math.random())}():ka++,"0x"+ka.toString(16)}var LR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Td=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var Ne="WebChannelConnection",Ad=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){let a=ch(),u=this.bo(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Et("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ni}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){let i=LR[t];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){let s=ch();return new Promise((o,a)=>{let u=new Cy;u.setWithCredentials(!0),u.listenOnce(Sy.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Pa.NO_ERROR:let l=u.getResponseJson();v(Ne,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Pa.TIMEOUT:v(Ne,`RPC '${e}' ${s} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case Pa.HTTP_ERROR:let h=u.getStatus();if(v(Ne,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let I=function(y){let R=y.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(R)>=0?R:g.UNKNOWN}(f.status);a(new _(I,f.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(Ne,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);v(Ne,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){let i=ch(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ay(),a=Ry(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");v(Ne,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,I=new Td({lo:y=>{f?v(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,y):(d||(v(Ne,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(Ne,`RPC '${e}' stream ${i} sending:`,y),h.send(y))},ho:()=>h.close()}),w=(y,R,N)=>{y.listen(R,M=>{try{N(M)}catch(F){setTimeout(()=>{throw F},0)}})};return w(h,ps.EventType.OPEN,()=>{f||v(Ne,`RPC '${e}' stream ${i} transport opened.`)}),w(h,ps.EventType.CLOSE,()=>{f||(f=!0,v(Ne,`RPC '${e}' stream ${i} transport closed`),I.Vo())}),w(h,ps.EventType.ERROR,y=>{f||(f=!0,Et(Ne,`RPC '${e}' stream ${i} transport errored:`,y),I.Vo(new _(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,ps.EventType.MESSAGE,y=>{var R;if(!f){let N=y.data[0];b(!!N);let M=N,F=M.error||((R=M[0])===null||R===void 0?void 0:R.error);if(F){v(Ne,`RPC '${e}' stream ${i} received error:`,F);let X=F.status,z=function(gw){let jf=fe[gw];if(jf!==void 0)return h_(jf)}(X),he=F.message;z===void 0&&(z=g.INTERNAL,he="Unknown error status: "+X+" with message "+F.message),f=!0,I.Vo(new _(z,he)),h.close()}else v(Ne,`RPC '${e}' stream ${i} received:`,N),I.mo(N)}}),w(a,by.STAT_EVENT,y=>{y.stat===sh.PROXY?v(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):y.stat===sh.NOPROXY&&v(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.Ro()},0),I}};function U_(){return typeof window<"u"?window:null}function Fa(){return typeof document<"u"?document:null}function Zs(n){return new qh(n,!0)}var Bs=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var vu=class{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Bs(e,t)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return m(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return m(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){return m(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ae(t.toString()),ae("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(t)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{let i=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){let r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>m(this,null,function*(){this.state=0,this.start()}))}__(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Rd=class extends vu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=IR(this.serializer,e),r=function(s){if(!("targetChange"in s))return C.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?C.min():o.readTime?ce(o.readTime):C.min()}(e);return this.listener.u_(t,r)}c_(e){let t={};t.database=zh(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Ha(u)?{documents:__(s,u)}:{query:w_(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=f_(s,o.resumeToken);let c=Bh(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(C.min())>0){a.readTime=Gr(s,o.snapshotVersion.toTimestamp());let c=Bh(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=TR(this.serializer,e);r&&(t.labels=r),this.t_(t)}l_(e){let t={};t.database=zh(this.serializer),t.removeTarget=e,this.t_(t)}},Sd=class extends vu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let t=ER(e.writeResults,e.commitTime),r=ce(e.commitTime);return this.listener.T_(r,t)}return b(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=zh(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Fs(this.serializer,r))};this.t_(t)}};var bd=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,$h(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,$h(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var Cd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ae(t),this.g_=!1):v("OnlineStateTracker",t)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Pd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>m(this,null,function*(){yn(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(u){return m(this,null,function*(){let c=E(u);c.v_.add(4),yield ii(c),c.x_.set("Unknown"),c.v_.delete(4),yield eo(c)})}(this))}))}),this.x_=new Cd(r,i)}};function eo(n){return m(this,null,function*(){if(yn(n))for(let e of n.F_)yield e(!0)})}function ii(n){return m(this,null,function*(){for(let e of n.F_)yield e(!1)})}function Lu(n,e){let t=E(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),Ef(t)?If(t):oi(t).Jo()&&wf(t,e))}function Yr(n,e){let t=E(n),r=oi(t);t.C_.delete(e),r.Jo()&&j_(t,e),t.C_.size===0&&(r.Jo()?r.Xo():yn(t)&&t.x_.set("Unknown"))}function wf(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(C.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}oi(n).c_(e)}function j_(n,e){n.O_.Oe(e),oi(n).l_(e)}function If(n){n.O_=new jh({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),oi(n).start(),n.x_.p_()}function Ef(n){return yn(n)&&!oi(n).Ho()&&n.C_.size>0}function yn(n){return E(n).v_.size===0}function q_(n){n.O_=void 0}function FR(n){return m(this,null,function*(){n.C_.forEach((e,t)=>{wf(n,e)})})}function UR(n,e){return m(this,null,function*(){q_(n),Ef(n)?(n.x_.S_(e),If(n)):n.x_.set("Unknown")})}function jR(n,e,t){return m(this,null,function*(){if(n.x_.set("Online"),e instanceof Za&&e.state===2&&e.cause)try{yield function(i,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield _u(n,r)}else if(e instanceof Or?n.O_.$e(e):e instanceof Ja?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(C.min()))try{let r=yield M_(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(Te.EMPTY_BYTE_STRING,l.snapshotVersion)),j_(s,u);let h=new Kr(l.target,u,c,l.sequenceNumber);wf(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield _u(n,r)}})}function _u(n,e,t){return m(this,null,function*(){if(!mn(e))throw e;n.v_.add(1),yield ii(n),n.x_.set("Offline"),t||(t=()=>M_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield eo(n)}))})}function B_(n,e){return e().catch(t=>_u(n,t,e))}function si(n){return m(this,null,function*(){let e=E(n),t=hn(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;qR(e);)try{let i=yield MR(e.localStore,r);if(i===null){e.D_.length===0&&t.Xo();break}r=i.batchId,BR(e,i)}catch(i){yield _u(e,i)}$_(e)&&z_(e)})}function qR(n){return yn(n)&&n.D_.length<10}function BR(n,e){n.D_.push(e);let t=hn(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function $_(n){return yn(n)&&!hn(n).Ho()&&n.D_.length>0}function z_(n){hn(n).start()}function $R(n){return m(this,null,function*(){hn(n).d_()})}function zR(n){return m(this,null,function*(){let e=hn(n);for(let t of n.D_)e.I_(t.mutations)})}function GR(n,e,t){return m(this,null,function*(){let r=n.D_.shift(),i=Lh.from(r,e,t);yield B_(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield si(n)})}function KR(n,e){return m(this,null,function*(){e&&hn(n).P_&&(yield function(r,i){return m(this,null,function*(){if(function(o){return l_(o)&&o!==g.ABORTED}(i.code)){let s=r.D_.shift();hn(r).Zo(),yield B_(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield si(r)}})}(n,e)),$_(n)&&z_(n)})}function wv(n,e){return m(this,null,function*(){let t=E(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=yn(t);t.v_.add(3),yield ii(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield eo(t)})}function Dd(n,e){return m(this,null,function*(){let t=E(n);e?(t.v_.delete(2),yield eo(t)):e||(t.v_.add(2),yield ii(t),t.x_.set("Unknown"))})}function oi(n){return n.N_||(n.N_=function(t,r,i){let s=E(t);return s.R_(),new Rd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:FR.bind(null,n),To:UR.bind(null,n),u_:jR.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.N_.Zo(),Ef(n)?If(n):n.x_.set("Unknown")):(yield n.N_.stop(),q_(n))}))),n.N_}function hn(n){return n.L_||(n.L_=function(t,r,i){let s=E(t);return s.R_(),new Sd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:$R.bind(null,n),To:KR.bind(null,n),E_:zR.bind(null,n),T_:GR.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.L_.Zo(),yield si(n)):(yield n.L_.stop(),n.D_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var xd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new me,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ai(n,e){if(ae("AsyncQueue",`${e}: ${n}`),mn(n))return new _(g.UNAVAILABLE,`${e}: ${n}`);throw n}var wu=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||A.comparator(t.key,r.key):(t,r)=>A.comparator(t.key,r.key),this.keyedMap=_s(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Iu=class{constructor(){this.B_=new ee(A.comparator)}track(e){let t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):S():this.B_=this.B_.insert(t,e)}k_(){let e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}},Xr=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,wu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Nd=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}},kd=class{constructor(){this.queries=new Rt(e=>Hv(e),Xs),this.onlineState="Unknown",this.W_=new Set}};function Tf(n,e){return m(this,null,function*(){let t=E(n),r=3,i=e.query,s=t.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Nd,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield t.onListen(i,!0);break;case 1:s.q_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=ai(o,`Initialization of query '${Pr(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Q_.push(e),e.G_(t.onlineState),s.q_&&e.z_(s.q_)&&Rf(t)})}function Af(n,e){return m(this,null,function*(){let t=E(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function WR(n,e){let t=E(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&Rf(t)}function QR(n,e,t){let r=E(n),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(t);r.queries.delete(e)}function Rf(n){n.W_.forEach(e=>{e.next()})}var Md,Iv;(Iv=Md||(Md={})).j_="default",Iv.Cache="cache";var $s=class{constructor(e,t,r){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Xr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache||!this.U_())return!0;let r=t!=="Offline";return(!this.options.ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Z_(e){if(e.docChanges.length>0)return!0;let t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ea(e){e=Xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Md.Cache}};var Vd=class{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}};var Eu=class{constructor(e){this.serializer=e}Ps(e){return wt(this.serializer,e)}Is(e){return e.metadata.exists?v_(this.serializer,e.document,!1):ye.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return ce(e)}},Od=class{constructor(e,t,r){this.ia=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=G_(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;let r=$.fromString(e.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){let t=new Map,r=new Eu(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||L()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield VR(this.localStore,new Eu(this.serializer),this.documents,this.ia.id),t=this.oa(this.documents);for(let r of this.queries)yield OR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:e}})}};function G_(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Tu=class{constructor(e){this.key=e}},Au=class{constructor(e){this.key=e}},Ru=class{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=L(),this.mutatedKeys=L(),this.ha=Xv(e),this.Pa=new wu(this.ha)}get Ia(){return this.ua}Ta(e,t){let r=t?t.Ea:new Iu,i=t?t.Pa:this.Pa,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=Js(this.query,h)?h:null,I=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),y=!1;d&&f?d.data.isEqual(f.data)?I!==w&&(r.track({type:3,doc:f}),y=!0):this.da(d,f)||(r.track({type:2,doc:f}),y=!0,(u&&this.ha(f,u)>0||c&&this.ha(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),y=!0):d&&!f&&(r.track({type:1,doc:d}),y=!0,(u||c)&&(a=!0)),y&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;let o=e.Ea.k_();o.sort((l,h)=>function(f,I){let w=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(f)-w(I)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=i!=null&&i;let a=t&&!i?this.Ra():[],u=this.la.size===0&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new Xr(this.query,e.Pa,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Iu,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(t=>this.ua=this.ua.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ua=this.ua.delete(t)),this.current=e.current)}Ra(){if(!this.current)return[];let e=this.la;this.la=L(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let t=[];return e.forEach(r=>{this.la.has(r)||t.push(new Au(r))}),this.la.forEach(r=>{e.has(r)||t.push(new Tu(r))}),t}fa(e){this.ua=e.hs,this.la=L();let t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Xr.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},Ld=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Fd=class{constructor(e){this.key=e,this.pa=!1}},Ud=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new Rt(a=>Hv(a),Xs),this.Sa=new Map,this.ba=new Set,this.Da=new ee(A.comparator),this.Ca=new Map,this.va=new js,this.Fa={},this.Ma=new Map,this.xa=Wr.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function HR(n,e,t=!0){return m(this,null,function*(){let r=Fu(n),i,s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield K_(r,e,t,!0),i})}function YR(n,e){return m(this,null,function*(){let t=Fu(n);yield K_(t,e,!0,!1)})}function K_(n,e,t,r){return m(this,null,function*(){let i=yield Qr(n.localStore,Le(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Sf(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Lu(n.remoteStore,i),a})}function Sf(n,e,t,r,i){return m(this,null,function*(){n.Na=(h,d,f)=>function(w,y,R,N){return m(this,null,function*(){let M=y.view.Ta(R);M.Xi&&(M=yield fu(w.localStore,y.query,!1).then(({documents:he})=>y.view.Ta(he,M)));let F=N&&N.targetChanges.get(y.targetId),X=N&&N.targetMismatches.get(y.targetId)!=null,z=y.view.applyChanges(M,w.isPrimaryClient,F,X);return jd(w,y.targetId,z.Va),z.snapshot})}(n,h,d,f);let s=yield fu(n.localStore,e,!0),o=new Ru(e,s.hs),a=o.Ta(s.documents),u=Os.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);jd(n,t,c.Va);let l=new Ld(e,t,o);return n.wa.set(e,l),n.Sa.has(t)?n.Sa.get(t).push(e):n.Sa.set(t,[e]),c.snapshot})}function XR(n,e,t){return m(this,null,function*(){let r=E(n),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Xs(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Hr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Yr(r.remoteStore,i.targetId),Jr(r,i.targetId)}).catch(gn))):(Jr(r,i.targetId),yield Hr(r.localStore,i.targetId,!0))})}function JR(n,e){return m(this,null,function*(){let t=E(n),r=t.wa.get(e),i=t.Sa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Yr(t.remoteStore,r.targetId))})}function ZR(n,e,t){return m(this,null,function*(){let r=Df(n);try{let i=yield function(o,a){let u=E(o),c=ue.now(),l=a.reduce((f,I)=>f.add(I.key),L()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let I=Ue(),w=L();return u.os.getEntries(f,l).next(y=>{I=y,I.forEach((R,N)=>{N.isValidDocument()||(w=w.add(R))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,I)).next(y=>{h=y;let R=[];for(let N of a){let M=pR(N,h.get(N.key).overlayedDocument);M!=null&&R.push(new ut(N.key,M,Bv(M.value.mapValue),oe.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,R,a)}).next(y=>{d=y;let R=y.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,y.batchId,R)})}).then(()=>({batchId:d.batchId,changes:Zv(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new ee(O)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Ft(r,i.changes),yield si(r.remoteStore)}catch(i){let s=ai(i,"Failed to persist write");t.reject(s)}})}function W_(n,e){return m(this,null,function*(){let t=E(n);try{let r=yield kR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Ca.get(s);o&&(b(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?b(o.pa):i.removedDocuments.size>0&&(b(o.pa),o.pa=!1))}),yield Ft(t,r,e)}catch(r){yield gn(r)}})}function Ev(n,e,t){let r=E(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=E(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(c=!0)}),c&&Rf(u)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function eS(n,e,t){return m(this,null,function*(){let r=E(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Ca.get(e),s=i&&i.key;if(s){let o=new ee(A.comparator);o=o.insert(s,ye.newNoDocument(s,C.min()));let a=L().add(s),u=new Vs(C.min(),new Map,new ee(O),o,a);yield W_(r,u),r.Da=r.Da.remove(s),r.Ca.delete(e),Pf(r)}else yield Hr(r.localStore,e,!1).then(()=>Jr(r,e,t)).catch(gn)})}function tS(n,e){return m(this,null,function*(){let t=E(n),r=e.batch.batchId;try{let i=yield NR(t.localStore,e);Cf(t,r,null),bf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ft(t,i)}catch(i){yield gn(i)}})}function nS(n,e,t){return m(this,null,function*(){let r=E(n);try{let i=yield function(o,a){let u=E(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(b(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Cf(r,e,t),bf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ft(r,i)}catch(i){yield gn(i)}})}function rS(n,e){return m(this,null,function*(){let t=E(n);yn(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=E(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Ma.get(r)||[];i.push(e),t.Ma.set(r,i)}catch(r){let i=ai(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function bf(n,e){(n.Ma.get(e)||[]).forEach(t=>{t.resolve()}),n.Ma.delete(e)}function Cf(n,e,t){let r=E(n),i=r.Fa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function Jr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Sa.get(e))n.wa.delete(r),t&&n.ya.La(r,t);n.Sa.delete(e),n.isPrimaryClient&&n.va.Vr(e).forEach(r=>{n.va.containsKey(r)||Q_(n,r)})}function Q_(n,e){n.ba.delete(e.path.canonicalString());let t=n.Da.get(e);t!==null&&(Yr(n.remoteStore,t),n.Da=n.Da.remove(e),n.Ca.delete(t),Pf(n))}function jd(n,e,t){for(let r of t)r instanceof Tu?(n.va.addReference(r.key,e),iS(n,r)):r instanceof Au?(v("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,e),n.va.containsKey(r.key)||Q_(n,r.key)):S()}function iS(n,e){let t=e.key,r=t.path.canonicalString();n.Da.get(t)||n.ba.has(r)||(v("SyncEngine","New document in limbo: "+t),n.ba.add(r),Pf(n))}function Pf(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let e=n.ba.values().next().value;n.ba.delete(e);let t=new A($.fromString(e)),r=n.xa.next();n.Ca.set(r,new Fd(t)),n.Da=n.Da.insert(t,r),Lu(n.remoteStore,new Kr(Le(ri(t.path)),r,"TargetPurposeLimboResolution",ze._e))}}function Ft(n,e,t){return m(this,null,function*(){let r=E(n),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=vd.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(u,c){return m(this,null,function*(){let l=E(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!mn(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),I=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(I);l.ns=l.ns.insert(d,w)}}})}(r.localStore,s))})}function sS(n,e){return m(this,null,function*(){let t=E(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield k_(t.localStore,e);t.currentUser=e,function(s,o){s.Ma.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,o))})}),s.Ma.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ft(t,r.us)}})}function oS(n,e){let t=E(n),r=t.Ca.get(e);if(r&&r.pa)return L().add(r.key);{let i=L(),s=t.Sa.get(e);if(!s)return i;for(let o of s){let a=t.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function aS(n,e){return m(this,null,function*(){let t=E(n),r=yield fu(t.localStore,e.query,!0),i=e.view.fa(r);return t.isPrimaryClient&&jd(t,e.targetId,i.Va),i})}function uS(n,e){return m(this,null,function*(){let t=E(n);return L_(t.localStore,e).then(r=>Ft(t,r))})}function cS(n,e,t,r){return m(this,null,function*(){let i=E(n),s=yield function(a,u){let c=E(a),l=E(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield si(i.remoteStore):t==="acknowledged"||t==="rejected"?(Cf(i,e,r||null),bf(i,e),function(a,u){E(E(a).mutationQueue).Mn(u)}(i.localStore,e)):S(),yield Ft(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function lS(n,e){return m(this,null,function*(){let t=E(n);if(Fu(t),Df(t),e===!0&&t.Oa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Tv(t,r.toArray());t.Oa=!0,yield Dd(t.remoteStore,!0);for(let s of i)Lu(t.remoteStore,s)}else if(e===!1&&t.Oa!==!1){let r=[],i=Promise.resolve();t.Sa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Jr(t,o),Hr(t.localStore,o,!0))),Yr(t.remoteStore,o)}),yield i,yield Tv(t,r),function(o){let a=E(o);a.Ca.forEach((u,c)=>{Yr(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new ee(A.comparator)}(t),t.Oa=!1,yield Dd(t.remoteStore,!1)}})}function Tv(n,e,t){return m(this,null,function*(){let r=E(n),i=[],s=[];for(let o of e){let a,u=r.Sa.get(o);if(u&&u.length!==0){a=yield Qr(r.localStore,Le(u[0]));for(let c of u){let l=r.wa.get(c),h=yield aS(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield O_(r.localStore,o);a=yield Qr(r.localStore,c),yield Sf(r,H_(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i})}function H_(n){return Qv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function hS(n){return function(t){return E(E(t).persistence).Bi()}(E(n).localStore)}function dS(n,e,t,r){return m(this,null,function*(){let i=E(n);if(i.Oa)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.Sa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield L_(i.localStore,Yv(s[0])),a=Vs.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Te.EMPTY_BYTE_STRING);yield Ft(i,o,a);break}case"rejected":yield Hr(i.localStore,e,!0),Jr(i,e,r);break;default:S()}})}function fS(n,e,t){return m(this,null,function*(){let r=Fu(n);if(r.Oa){for(let i of e){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield O_(r.localStore,i),o=yield Qr(r.localStore,s);yield Sf(r,H_(s),o.targetId,!1,o.resumeToken),Lu(r.remoteStore,o)}for(let i of t)r.Sa.has(i)&&(yield Hr(r.localStore,i,!1).then(()=>{Yr(r.remoteStore,i),Jr(r,i)}).catch(gn))}})}function Fu(n){let e=E(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=W_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eS.bind(null,e),e.ya.u_=WR.bind(null,e.eventManager),e.ya.La=QR.bind(null,e.eventManager),e}function Df(n){let e=E(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nS.bind(null,e),e}function pS(n,e,t){let r=E(n);(function(s,o,a){return m(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,I){let w=E(f),y=ce(I.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",R=>w.$r.getBundleMetadata(R,I.id)).then(R=>!!R&&R.createTime.compareTo(y)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(G_(u));let c=new Od(u,s.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield c.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield c.complete();return yield Ft(s,h.aa,void 0),yield function(f,I){let w=E(f);return w.persistence.runTransaction("Save bundle","readwrite",y=>w.$r.saveBundleMetadata(y,I))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h._a)}catch(u){return Et("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var zs=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=Zs(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return N_(this.persistence,new du,e.initialUser,this.serializer)}createPersistence(e){return new lu(hu.Hr,this.serializer)}createSharedClientState(e){return new mu}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Su=class n extends zs{constructor(e,t,r){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield Gu(n.prototype,this,"initialize").call(this,e),yield this.ka.initialize(this,e),yield Df(this.ka.syncEngine),yield si(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return N_(this.persistence,new du,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new rd(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Ih(t,this.persistence);return new wh(e.asyncQueue,r)}createPersistence(e){let t=_f(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ze.withCacheSize(this.cacheSizeBytes):Ze.DEFAULT;return new yd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,U_(),Fa(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new mu}},qd=class n extends Su{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield Gu(n.prototype,this,"initialize").call(this,e);let t=this.ka.syncEngine;this.sharedClientState instanceof Rs&&(this.sharedClientState.syncEngine={Zs:cS.bind(null,t),Xs:dS.bind(null,t),eo:fS.bind(null,t),Bi:hS.bind(null,t),Ys:uS.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>m(this,null,function*(){yield lS(this.ka.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=U_();if(!Rs.D(t))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=_f(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Rs(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Gs=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ev(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=sS.bind(null,this.syncEngine),yield Dd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new kd}()}createDatastore(e){let t=Zs(e.databaseInfo.databaseId),r=function(s){return new Ad(s)}(e.databaseInfo);return function(s,o,a,u){return new bd(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Pd(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Ev(this.syncEngine,t,0),function(){return yu.D()?new yu:new Ed}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new Ud(i,s,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield function(r){return m(this,null,function*(){let i=E(r);v("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield ii(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function Av(n,e=10240){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Zr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):ae("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Bd=class{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new me,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}Ba(){return m(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return m(this,null,function*(){let e=yield this.Wa();if(e===null)return null;let t=this.$a.decode(e),r=Number(t);isNaN(r)&&this.Ga(`length string (${t}) is not valid number`);let i=yield this.za(r);return new Vd(JSON.parse(i),e.length+r)})}ja(){return this.buffer.findIndex(e=>e===123)}Wa(){return m(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let e=this.ja();e<0&&this.Ga("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}za(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let t=this.$a.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){return m(this,null,function*(){let e=yield this.Ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var $d=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return m(this,null,function*(){let o=E(i),a={documents:s.map(h=>Ls(o.serializer,h))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,$.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=wR(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());b(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ln(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=A.fromPath(r);this.mutations.push(new Ns(i,this.precondition(i)))}),yield function(r,i){return m(this,null,function*(){let s=E(r),o={writes:i.map(a=>Fs(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,$.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=C.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(C.min())?oe.exists(!1):oe.updateTime(t):oe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(C.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return oe.updateTime(t)}return oe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var zd=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new Bs(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>m(this,null,function*(){let e=new $d(this.datastore),t=this.Xa(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.eu(i)}))}).catch(r=>{this.eu(r)})}))}Xa(e){try{let t=this.updateFunction(e);return!Hs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!l_(t)}return!1}};var Gd=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ge.UNAUTHENTICATED,this.clientId=qa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new me;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ai(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ua(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield k_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Kd(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield xf(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>wv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>wv(e.remoteStore,i)),n._onlineComponents=e})}function Y_(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function xf(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ua(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!Y_(t))throw t;Et("Error using user provided cache. Falling back to memory cache: "+t),yield Ua(n,new zs)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Ua(n,new zs);return n._offlineComponents})}function Uu(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Kd(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Kd(n,new Gs))),n._onlineComponents})}function X_(n){return xf(n).then(e=>e.persistence)}function Nf(n){return xf(n).then(e=>e.localStore)}function J_(n){return Uu(n).then(e=>e.remoteStore)}function kf(n){return Uu(n).then(e=>e.syncEngine)}function gS(n){return Uu(n).then(e=>e.datastore)}function ei(n){return m(this,null,function*(){let e=yield Uu(n),t=e.eventManager;return t.onListen=HR.bind(null,e.syncEngine),t.onUnlisten=XR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=YR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=JR.bind(null,e.syncEngine),t})}function mS(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield X_(n),t=yield J_(n);return e.setNetworkEnabled(!0),function(i){let s=E(i);return s.v_.delete(0),eo(s)}(t)}))}function yS(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield X_(n),t=yield J_(n);return e.setNetworkEnabled(!1),function(i){return m(this,null,function*(){let s=E(i);s.v_.add(0),yield ii(s),s.x_.set("Offline")})}(t)}))}function vS(n,e){let t=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield function(c,l){let h=E(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=ai(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Nf(n),e,t)})),t.promise}function Z_(n,e,t={}){let r=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Zr({next:d=>{o.enqueueAndForget(()=>Af(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new $s(ri(a.path),l,{includeMetadataChanges:!0,ta:!0});return Tf(s,h)}(yield ei(n),n.asyncQueue,e,t,r)})),r.promise}function _S(n,e){let t=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield fu(i,s,!0),u=new Ru(s,a.hs),c=u.Ta(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=ai(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Nf(n),e,t)})),t.promise}function ew(n,e,t={}){let r=new me;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Zr({next:d=>{o.enqueueAndForget(()=>Af(s,h)),d.fromCache&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new $s(a,l,{includeMetadataChanges:!0,ta:!0});return Tf(s,h)}(yield ei(n),n.asyncQueue,e,t,r)})),r.promise}function wS(n,e){let t=new Zr(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){E(i).W_.add(s),s.next()}(yield ei(n),t)})),()=>{t.Qa(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){E(i).W_.delete(s)}(yield ei(n),t)}))}}function IS(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?d_().encode(o):o,function(l,h){return new Bd(l,h)}(function(l,h){if(l instanceof Uint8Array)return Av(l,h);if(l instanceof ArrayBuffer)return Av(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Zs(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){pS(yield kf(n),i,r)}))}function ES(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return function(r,i){let s=E(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield Nf(n),e)}))}function tw(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Rv=new Map;function Mf(n,e,t){if(!t)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function TS(n,e,t,r){if(e===!0&&r===!0)throw new _(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Sv(n){if(!A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bv(n){if(A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ju(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":S()}function K(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ju(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function nw(n,e){if(e<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var bu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}TS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Hn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bu(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new lh;switch(r.type){case"firstParty":return new ph(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Rv.get(t);r&&(v("ComponentProvider","Removing Datastore"),Rv.delete(t),r.terminate())}(this),Promise.resolve()}};function AS(n,e,t,r={}){var i;let s=(n=K(n,Hn))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Et("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=ge.MOCK_USER;else{a=Bp(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ge(c)}n._authCredentials=new hh(new ja(a,u))}}var be=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},le=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new It(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},It=class n extends be{constructor(e,t,r){super(e,t,ri(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new A(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function mP(n,e,...t){if(n=ve(n),Mf("collection","path",e),n instanceof Hn){let r=$.fromString(e,...t);return bv(r),new It(n,null,r)}{if(!(n instanceof le||n instanceof It))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child($.fromString(e,...t));return bv(r),new It(n.firestore,null,r)}}function yP(n,e){if(n=K(n,Hn),Mf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new be(n,null,function(r){return new at($.emptyPath(),r)}(e))}function RS(n,e,...t){if(n=ve(n),arguments.length===1&&(e=qa.newId()),Mf("doc","path",e),n instanceof Hn){let r=$.fromString(e,...t);return Sv(r),new le(n,null,new A(r))}{if(!(n instanceof le||n instanceof It))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child($.fromString(e,...t));return Sv(r),new le(n.firestore,n instanceof It?n.converter:null,new A(r))}}function vP(n,e){return n=ve(n),e=ve(e),(n instanceof le||n instanceof It)&&(e instanceof le||e instanceof It)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function SS(n,e){return n=ve(n),e=ve(e),n instanceof be&&e instanceof be&&n.firestore===e.firestore&&Xs(n._query,e._query)&&n.converter===e.converter}var Wd=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Bs(this,"async_queue_retry"),this.cu=()=>{let t=Fa();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};let e=Fa();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;let t=Fa();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});let t=new me;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){return m(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!mn(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(e){let t=this.nu.then(()=>(this._u=!0,e().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ae("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=t,t}enqueueAfterDelay(e,t,r){this.lu(),this.uu.indexOf(e)>-1&&(t=0);let i=xd.createAndSchedule(this,e,t,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){return m(this,null,function*(){let e;do e=this.nu,yield e;while(e!==this.nu)})}Eu(e){for(let t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.su)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){let t=this.su.indexOf(e);this.su.splice(t,1)}};function Qd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Hd=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new me,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var _P=-1,ne=class extends Hn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Wd}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||rw(this),this._firestoreClient.terminate()}};function wP(n,e){let t=typeof n=="object"?n:wo(),r=typeof n=="string"?n:e||"(default)",i=Qp(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=qp("firestore");s&&AS(i,...s)}return i}function Ce(n){return n._firestoreClient||rw(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function rw(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new Eh(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,tw(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Gd(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function IP(n,e){sw(n=K(n,ne));let t=Ce(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Gs;return iw(t,i,new Su(i,r.cacheSizeBytes,e?.forceOwnership))}function EP(n){sw(n=K(n,ne));let e=Ce(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Gs;return iw(e,r,new qd(r,t.cacheSizeBytes))}function iw(n,e,t){let r=new me;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield Ua(n,t),yield Kd(n,e),r.resolve()}catch(i){let s=i;if(!Y_(s))throw s;Et("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function TP(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new me;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield function(r){return m(this,null,function*(){if(!kt.D())return Promise.resolve();let i=r+"main";yield kt.delete(i)})}(_f(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function AP(n){return function(t){let r=new me;return t.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return rS(yield kf(t),r)})),r.promise}(Ce(n=K(n,ne)))}function RP(n){return mS(Ce(n=K(n,ne)))}function SP(n){return yS(Ce(n=K(n,ne)))}function bP(n,e){let t=Ce(n=K(n,ne)),r=new Hd;return IS(t,n._databaseId,e,r),r}function CP(n,e){return ES(Ce(n=K(n,ne)),e).then(t=>t?new be(n,null,t.query):null)}function sw(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var ti=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Te.fromBase64String(e))}catch(t){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var dn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _e(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ot=class{constructor(e){this._methodName=e}};var Ks=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return O(this._lat,e._lat)||O(this._long,e._long)}};var bS=/^__.*__$/,Yd=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ut(e,this.data,this.fieldMask,t,this.fieldTransforms):new cn(e,this.data,t,this.fieldTransforms)}},Cu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ut(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ow(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Pu=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return Du(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(e.length===0)throw this.Su("Document fields must not be empty");if(ow(this.Vu)&&bS.test(e))throw this.Su('Document fields cannot begin and end with "__"')}},Xd=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Zs(e)}Cu(e,t,r,i=!1){return new Pu({Vu:e,methodName:t,Du:r,path:_e.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Zn(n){let e=n._freezeSettings(),t=Zs(n._databaseId);return new Xd(n._databaseId,!!e.ignoreUndefinedProperties,t)}function qu(n,e,t,r,i,s={}){let o=n.Cu(s.merge||s.mergeFields?2:0,e,t,i);Lf("Data must be an object, but it was:",o,r);let a=cw(r,o),u,c;if(s.merge)u=new Ge(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=nf(e,h,t);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);hw(l,d)||l.push(d)}u=new Ge(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Yd(new ke(a),u,c)}var Ws=class n extends Ot{_toFieldTransform(e){if(e.Vu!==2)throw e.Vu===1?e.Su(`${this._methodName}() can only appear at the top level of your update data`):e.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function aw(n,e,t){return new Pu({Vu:3,Du:e.settings.Du,methodName:n._methodName,gu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Jd=class n extends Ot{_toFieldTransform(e){return new Kn(e.path,new an)}isEqual(e){return e instanceof n}},Zd=class n extends Ot{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=aw(this,e,!0),r=this.vu.map(s=>er(s,t)),i=new Mt(r);return new Kn(e.path,i)}isEqual(e){return e instanceof n&&dc(this.vu,e.vu)}},ef=class n extends Ot{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=aw(this,e,!0),r=this.vu.map(s=>er(s,t)),i=new Vt(r);return new Kn(e.path,i)}isEqual(e){return e instanceof n&&dc(this.vu,e.vu)}},tf=class n extends Ot{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){let t=new un(e.serializer,r_(e.serializer,this.Fu));return new Kn(e.path,t)}isEqual(e){return e instanceof n&&this.Fu===e.Fu}};function Vf(n,e,t,r){let i=n.Cu(1,e,t);Lf("Data must be an object, but it was:",i,r);let s=[],o=ke.empty();Jn(r,(u,c)=>{let l=Ff(e,u,t);c=ve(c);let h=i.yu(l);if(c instanceof Ws)s.push(l);else{let d=er(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Ge(s);return new Cu(o,a,i.fieldTransforms)}function Of(n,e,t,r,i,s){let o=n.Cu(1,e,t),a=[nf(e,r,t)],u=[i];if(s.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(nf(e,s[d])),u.push(s[d+1]);let c=[],l=ke.empty();for(let d=a.length-1;d>=0;--d)if(!hw(c,a[d])){let f=a[d],I=u[d];I=ve(I);let w=o.yu(f);if(I instanceof Ws)c.push(f);else{let y=er(I,w);y!=null&&(c.push(f),l.set(f,y))}}let h=new Ge(c);return new Cu(l,h,o.fieldTransforms)}function uw(n,e,t,r=!1){return er(t,n.Cu(r?4:3,e))}function er(n,e){if(lw(n=ve(n)))return Lf("Unsupported field value:",e,n),cw(n,e);if(n instanceof Ot)return function(r,i){if(!ow(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.gu&&e.Vu!==4)throw e.Su("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=er(a,i.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return r_(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ue.fromDate(r);return{timestampValue:Gr(i.serializer,s)}}if(r instanceof ue){let s=new ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Gr(i.serializer,s)}}if(r instanceof Ks)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ti)return{bytesValue:f_(i.serializer,r._byteString)};if(r instanceof le){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:mf(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${ju(r)}`)}(n,e)}function cw(n,e){let t={};return jv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jn(n,(r,i)=>{let s=er(i,e.fu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function lw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof Ks||n instanceof ti||n instanceof le||n instanceof Ot)}function Lf(n,e,t){if(!lw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=ju(t);throw r==="an object"?e.Su(n+" a custom object"):e.Su(n+" "+r)}}function nf(n,e,t){if((e=ve(e))instanceof dn)return e._internalPath;if(typeof e=="string")return Ff(n,e);throw Du("Field path arguments must be of type string or ",n,!1,void 0,t)}var CS=new RegExp("[~\\*/\\[\\]]");function Ff(n,e,t){if(e.search(CS)>=0)throw Du(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new dn(...e.split("."))._internalPath}catch{throw Du(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Du(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function hw(n,e){return n.some(t=>t.isEqual(e))}var Yn=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new rf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Bu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},rf=class extends Yn{data(){return super.data()}};function Bu(n,e){return typeof e=="string"?Ff(n,e):e instanceof dn?e._internalPath:e._delegate._internalPath}function dw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Qs=class{},Xn=class extends Qs{};function PP(n,e,...t){let r=[];e instanceof Qs&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof sf).length,a=s.filter(u=>u instanceof xu).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var xu=class n extends Xn{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return pw(e._query,t),new be(e.firestore,e.converter,Vh(e._query,t))}_parse(e){let t=Zn(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Pv(h,l);let f=[];for(let I of h)f.push(Cv(u,s,I));d={arrayValue:{values:f}}}else d=Cv(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Pv(h,l),d=uw(a,o,h,l==="in"||l==="not-in");return j.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function DP(n,e,t){let r=e,i=Bu("where",n);return xu._create(i,r,t)}var sf=class n extends Qs{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Y.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)pw(o,u),o=Vh(o,u)}(e._query,t),new be(e.firestore,e.converter,Vh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var of=class n extends Xn{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zn(s,o)}(e._query,this._field,this._direction);return new be(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new at(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function xP(n,e="asc"){let t=e,r=Bu("orderBy",n);return of._create(r,t)}var Nu=class n extends Xn{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new be(e.firestore,e.converter,Xa(e._query,this._limit,this._limitType))}};function NP(n){return nw("limit",n),Nu._create("limit",n,"F")}function kP(n){return nw("limitToLast",n),Nu._create("limitToLast",n,"L")}var ku=class n extends Xn{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=fw(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new at(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function MP(...n){return ku._create("startAt",n,!0)}function VP(...n){return ku._create("startAfter",n,!1)}var Mu=class n extends Xn{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=fw(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new at(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function OP(...n){return Mu._create("endBefore",n,!1)}function LP(...n){return Mu._create("endAt",n,!0)}function fw(n,e,t,r){if(t[0]=ve(t[0]),t[0]instanceof Yn)return function(s,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Vr(s))if(h.field.isKeyField())l.push($n(o,u.key));else{let d=u.data.field(h.field);if(Ou(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new At(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Zn(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let I=0;I<l.length;I++){let w=l[I];if(d[I].field.isKeyField()){if(typeof w!="string")throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!pf(o)&&w.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let y=o.path.child($.fromString(w));if(!A.isDocumentKey(y))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${y}' is not because it contains an odd number of segments.`);let R=new A(y);f.push($n(a,R))}else{let y=uw(u,c,w);f.push(y)}}return new At(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Cv(n,e,t){if(typeof(t=ve(t))=="string"){if(t==="")throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!pf(e)&&t.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child($.fromString(t));if(!A.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $n(n,new A(r))}if(t instanceof le)return $n(n,t._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ju(t)}.`)}function Pv(n,e){if(!Array.isArray(n)||n.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function pw(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Vu=class{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return se(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Jn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ks(se(e.latitude),se(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=df(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ps(e));default:return null}}convertTimestamp(e){let t=rn(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=$.fromString(e);b(A_(r));let i=new jr(r.get(1),r.get(3)),s=new A(r.popFirst(5));return i.isEqual(t)||ae(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function $u(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var af=class extends Vu{constructor(e){super(),this.firestore=e}convertBytes(e){return new ti(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}};var Nt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},fn=class extends Yn{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Lr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Bu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Lr=class extends fn{data(e={}){return super.data(e)}},pn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Nt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Lr(this._firestore,this._userDataWriter,r.key,r,new Nt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Lr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Nt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Lr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Nt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:PS(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function PS(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function FP(n,e){return n instanceof fn&&e instanceof fn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof pn&&e instanceof pn&&n._firestore===e._firestore&&SS(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function UP(n){n=K(n,le);let e=K(n.firestore,ne);return Z_(Ce(e),n._key).then(t=>Uf(e,n,t))}var Lt=class extends Vu{constructor(e){super(),this.firestore=e}convertBytes(e){return new ti(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}};function jP(n){n=K(n,le);let e=K(n.firestore,ne),t=Ce(e),r=new Lt(e);return vS(t,n._key).then(i=>new fn(e,r,n._key,i,new Nt(i!==null&&i.hasLocalMutations,!0),n.converter))}function qP(n){n=K(n,le);let e=K(n.firestore,ne);return Z_(Ce(e),n._key,{source:"server"}).then(t=>Uf(e,n,t))}function BP(n){n=K(n,be);let e=K(n.firestore,ne),t=Ce(e),r=new Lt(e);return dw(n._query),ew(t,n._query).then(i=>new pn(e,r,n,i))}function $P(n){n=K(n,be);let e=K(n.firestore,ne),t=Ce(e),r=new Lt(e);return _S(t,n._query).then(i=>new pn(e,r,n,i))}function zP(n){n=K(n,be);let e=K(n.firestore,ne),t=Ce(e),r=new Lt(e);return ew(t,n._query,{source:"server"}).then(i=>new pn(e,r,n,i))}function GP(n,e,t){n=K(n,le);let r=K(n.firestore,ne),i=$u(n.converter,e,t);return zu(r,[qu(Zn(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,oe.none())])}function KP(n,e,t,...r){n=K(n,le);let i=K(n.firestore,ne),s=Zn(i),o;return o=typeof(e=ve(e))=="string"||e instanceof dn?Of(s,"updateDoc",n._key,e,t,r):Vf(s,"updateDoc",n._key,e),zu(i,[o.toMutation(n._key,oe.exists(!0))])}function WP(n){return zu(K(n.firestore,ne),[new ln(n._key,oe.none())])}function QP(n,e){let t=K(n.firestore,ne),r=RS(n),i=$u(n.converter,e);return zu(t,[qu(Zn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,oe.exists(!1))]).then(()=>r)}function HP(n,...e){var t,r,i;n=ve(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Qd(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Qd(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof le)c=K(n.firestore,ne),l=ri(n._key.path),u={next:h=>{e[o]&&e[o](Uf(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=K(n,be);c=K(h.firestore,ne),l=h._query;let d=new Lt(c);u={next:f=>{e[o]&&e[o](new pn(c,d,h,f))},error:e[o+1],complete:e[o+2]},dw(n._query)}return function(d,f,I,w){let y=new Zr(w),R=new $s(f,y,I);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return Tf(yield ei(d),R)})),()=>{y.Qa(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return Af(yield ei(d),R)}))}}(Ce(c),l,a,u)}function YP(n,e){return wS(Ce(n=K(n,ne)),Qd(e)?e:{next:e})}function zu(n,e){return function(r,i){let s=new me;return r.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return ZR(yield kf(r),i,s)})),s.promise}(Ce(n),e)}function Uf(n,e,t){let r=t.docs.get(e._key),i=new Lt(n);return new fn(n,i,e._key,r,new Nt(t.hasPendingWrites,t.fromCache),e.converter)}var DS={maxAttempts:5};var Dv=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Zn(e)}set(e,t,r){this._verifyNotCommitted();let i=en(e,this._firestore),s=$u(i.converter,t,r),o=qu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,oe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=en(e,this._firestore),o;return o=typeof(t=ve(t))=="string"||t instanceof dn?Of(this._dataReader,"WriteBatch.update",s._key,t,r,i):Vf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,oe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=en(e,this._firestore);return this._mutations=this._mutations.concat(new ln(t._key,oe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function en(n,e){if((n=ve(n)).firestore!==e)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var uf=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Zn(t)}get(t){let r=en(t,this._firestore),i=new af(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Yn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Yn(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){let s=en(t,this._firestore),o=$u(s.converter,r,i),a=qu(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=en(t,this._firestore),a;return a=typeof(r=ve(r))=="string"||r instanceof dn?Of(this._dataReader,"Transaction.update",o._key,r,i,s):Vf(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=en(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=en(e,this._firestore),r=new Lt(this._firestore);return super.get(e).then(i=>new fn(this._firestore,r,t._key,i._document,new Nt(!1,!1),t.converter))}};function JP(n,e,t){n=K(n,ne);let r=Object.assign(Object.assign({},DS),t);return function(s){if(s.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new me;return s.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let c=yield gS(s);new zd(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(Ce(n),i=>e(new uf(n,i)),r)}function ZP(){return new Ws("deleteField")}function eD(){return new Jd("serverTimestamp")}function tD(...n){return new Zd("arrayUnion",n)}function nD(...n){return new ef("arrayRemove",n)}function rD(n){return new tf("increment",n)}(function(e,t=!0){(function(i){ni=i})(Hp),Wp(new Gp("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new ne(new dh(r.getProvider("auth-internal")),new mh(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jr(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),rt(Dy,"4.5.1",e),rt(Dy,"4.5.1","esm2017")})();export{Rw as a,zS as b,ag as c,rb as d,ib as e,lI as f,jI as g,Ct as h,Ig as i,Tb as j,Ab as k,Qt as l,im as m,dl as n,Ho as o,Xo as p,vT as q,Zo as r,Cn as s,zi as t,zb as u,Gb as v,pl as w,FC as x,UC as y,YC as z,am as A,um as B,kA as C,XC as D,JC as E,lP as F,Et as G,hP as H,_ as I,ue as J,_e as K,A as L,fP as M,jr as N,TS as O,K as P,AS as Q,le as R,mP as S,yP as T,RS as U,vP as V,SS as W,_P as X,wP as Y,Ce as Z,IP as _,EP as $,TP as aa,AP as ba,RP as ca,SP as da,bP as ea,CP as fa,ti as ga,dn as ha,Ks as ia,PP as ja,DP as ka,xP as la,NP as ma,kP as na,MP as oa,VP as pa,OP as qa,LP as ra,Vu as sa,fn as ta,Lr as ua,pn as va,FP as wa,UP as xa,jP as ya,qP as za,BP as Aa,$P as Ba,zP as Ca,GP as Da,KP as Ea,WP as Fa,QP as Ga,HP as Ha,YP as Ia,zu as Ja,Dv as Ka,JP as La,ZP as Ma,eD as Na,tD as Oa,nD as Pa,rD as Qa};
